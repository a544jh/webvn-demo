/*! For license information please see playerIndex.js.LICENSE.txt */
(()=>{"use strict";var e={979:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(81),s=n.n(r),i=n(645),o=n.n(i)()(s());o.push([e.id,"@keyframes appear {\n  from {\n    opacity: 0;\n  }\n  to {\n    opacity: 1;\n  }\n}\n\n@keyframes vn-blink {\n  50% {\n    opacity: 0;\n  }\n}\n\n.vn-anim-blink {\n  animation-name: vn-blink;\n  animation-duration: 1s;\n  animation-iteration-count: infinite;\n  animation-timing-function: step-end;\n}\n\n@keyframes vn-bounce {\n  from {\n    transform: initial;\n  }\n  to {\n    transform: translateY(-5px);\n  }\n}\n\n.vn-anim-bounce {\n  animation-name: vn-bounce;\n  animation-duration: 400ms;\n  animation-iteration-count: infinite;\n  animation-direction: alternate;\n  animation-timing-function: linear;\n}\n\n@keyframes vn-decision-anim {\n  from {\n    background-color: rgba(0, 0, 0, 0.4);\n  }\n  to {\n    background-color: rgba(0, 0, 0, 0.2);\n  }\n}\n\n@keyframes scale-y {\n  from {\n    transform: scaleY(0);\n  }\n  to {\n    transform: scaleY(1);\n  }\n}\n",""]);const a=o},447:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(81),s=n.n(r),i=n(645),o=n.n(i)()(s());o.push([e.id,'body {\n  background-color: dimgray;\n  touch-action: manipulation;\n}\n\n#vn-state {\n  white-space: pre;\n}\n\n#vn-div {\n  overflow: hidden;\n  background: white;\n  position: relative;\n  margin: 0 auto;\n  width: 1280px;\n  height: 720px;\n}\n\n#vn-textbox-renderer {\n  font-family: "Source Code Pro";\n  font-weight: bold;\n  font-size: 32px;\n  line-height: 1;\n  text-shadow: 2px 2px 0px black;\n  color: white;\n  user-select: none;\n  -moz-user-select: none;\n  height: 100%;\n  position: relative;\n  z-index: 30;\n}\n\n.vn-arrow {\n  position: absolute;\n  right: 13.9%;\n  bottom: 2.8%;\n  width: 0;\n  height: 0;\n  border-style: solid;\n  border-width: 18px 10px 0 10px;\n  border-color: white transparent transparent transparent;\n\n  filter: drop-shadow(2.5px 2.5px 0px black);\n  z-index: 30;\n}\n\n.vn-adv-textbox {\n  position: absolute;\n  left: 13.3%;\n  bottom: 1.67%;\n  width: 73.4%;\n  height: 178px;\n  padding: 5px;\n  box-sizing: border-box;\n  background-color: rgba(0, 0, 0, 0.4);\n  overflow: hidden;\n  transition-property: transform;\n  transition-duration: 150ms;\n  transition-timing-function: linear;\n}\n\n.vn-adv-nametag {\n  position: absolute;\n  left: 14.1%;\n  bottom: 25.8%;\n  padding: 2px;\n  box-sizing: border-box;\n  text-shadow: 3px 3px 0px black;\n  background-color: rgba(0, 0, 0, 0.4);\n  overflow: hidden;\n  transition-property: transform;\n  transition-duration: 150ms;\n  transition-timing-function: linear;\n}\n\n#vn-decision-renderer {\n  height: 73.6%; /*with textbox shown TODO handle without*/\n  display: flex;\n  flex-direction: column;\n  justify-content: space-evenly;\n  font-family: "Source Code Pro";\n  font-weight: bold;\n  font-size: 32px;\n  line-height: 1;\n  text-shadow: 2px 2px 0px black;\n  color: white;\n  user-select: none;\n  -moz-user-select: none;\n  position: absolute;\n  width: 100%;\n  top: 0px;\n  left: 0px;\n  z-index: 40;\n}\n\n.vn-decision-item {\n  background-color: rgba(0, 0, 0, 0.4);\n  padding: 2px 0;\n  text-align: center;\n  transition-property: transform;\n  transition-duration: 300ms;\n}\n\n.vn-decision-item:hover {\n  background-color: rgba(0, 0, 0, 0.2);\n}\n\n.vn-decision-item-blink {\n  animation: vn-decision-anim;\n  animation-duration: 100ms;\n  animation-iteration-count: 5;\n}\n\n#vn-sprite-renderer {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0px;\n  left: 0px;\n  user-select: none;\n  -moz-user-select: none;\n  z-index: 20;\n}\n\n#vn-sprite-renderer img {\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  transition-timing-function: linear;\n}\n\n#vn-background-renderer {\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  z-index: 10;\n}\n\n#vn-actions {\n  z-index: 50;\n  position: absolute;\n  height: 183px;\n  bottom: 0px;\n  width: 100%;\n  text-transform: uppercase;\n  font-size: 28px;\n  line-height: 28px;\n  font-family: "Source Code Pro";\n  font-weight: 600;\n  text-shadow: 2px 2px 0 black;\n  color: white;\n  transition-duration: 500ms;\n  user-select: none;\n  -moz-user-select: none;\n  --ggs: 2.5;\n}\n\n@media (pointer: fine) {\n  #vn-actions {\n    opacity: 0%;\n  }\n}\n\n#vn-actions:hover {\n  opacity: 100%;\n}\n\n.vn-action {\n  height: 60px;\n  width: 11.4%;\n  display: flex;\n  align-items: center;\n  justify-content: space-evenly;\n  background-color: rgba(0, 0, 0, 0.4);\n}\n\n.vn-action:not(.vn-action-disabled):active,\n.vn-pause-menu-item:active {\n  background-color: rgba(0, 0, 0, 0.2);\n}\n\n.vn-action i {\n  filter: drop-shadow(1.5px 1.5px 0px black);\n}\n\n.vn-action-disabled {\n  color: hsl(0, 0%, 30%);\n  opacity: 0.3;\n}\n.vn-action-back {\n  position: absolute;\n  bottom: 63.7%;\n}\n\n.vn-action-menu {\n  position: absolute;\n  bottom: 18.6%;\n  --ggs: 1.5;\n}\n\n.vn-action-auto {\n  position: absolute;\n  bottom: 63.7%;\n  right: 0px;\n}\n\n.vn-action-skip {\n  position: absolute;\n  bottom: 18.6%;\n  right: 0px;\n  --ggs: 1.5;\n}\n\n.vn-menu-container {\n  position: absolute;\n  top: 0px;\n  left: 0px;\n  width: 100%;\n  height: 100%;\n  z-index: 100;\n  background-color: rgba(0, 0, 0, 0.4);\n}\n\n.vn-pause-menu-container {\n  position: absolute;\n  display: flex;\n  flex-direction: column;\n  justify-content: space-evenly;\n  top: 30%;\n  width: 30%;\n  height: 40%;\n}\n\n.vn-pause-menu-item {\n  font-size: 28px;\n  line-height: 28px;\n  font-family: "Source Code Pro";\n  font-weight: 600;\n  text-shadow: 2px 2px 0 black;\n  user-select: none;\n  -moz-user-select: none;\n  color: white;\n  background-color: rgba(0, 0, 0, 0.4);\n  height: 30px;\n  padding: 2px 2px 2px 8px;\n}\n\n.vn-saves-container {\n  position: absolute;\n  left: 25%;\n  width: 50%;\n  height: 100%;\n  overflow-y: scroll;\n}\n\n.vn-save-item {\n  position: relative;\n  height: 100px;\n  padding: 2px;\n  margin-bottom: 5px;\n}\n\n.vn-save-new {\n  height: 30px;\n}\n\n.vn-save-del {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.vn-save-return {\n  position: absolute;\n  left: 0%;\n  bottom: 12%;\n  width: 20%;\n}\n\n.vn-save-heading {\n  font-size: 32px;\n  line-height: 32px;\n  font-family: "Source Code Pro";\n  font-weight: 600;\n  text-shadow: 2px 2px 0 black;\n  user-select: none;\n  -moz-user-select: none;\n  color: white;\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n',""]);const a=o},4:(e,t,n)=>{n.d(t,{Z:()=>a});var r=n(81),s=n.n(r),i=n(645),o=n.n(i)()(s());o.push([e.id,'.gg-back-button {\n  box-sizing: border-box;\n  position: relative;\n  display: block;\n  transform: scale(var(--ggs, 1));\n  width: 22px;\n  height: 22px;\n}\n\n.gg-back-button::before {\n  content: "";\n  display: block;\n  box-sizing: border-box;\n  position: absolute;\n  width: 0;\n  height: 10px;\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid transparent;\n  border-right: 6px solid;\n  top: 6px;\n  left: 9px;\n}\n\n.gg-menu {\n  transform: scale(var(--ggs, 1));\n}\n\n.gg-menu,\n.gg-menu::after,\n.gg-menu::before {\n  box-sizing: border-box;\n  position: relative;\n  display: block;\n  width: 20px;\n  height: 3px;\n  border-radius: 0px;\n  background: currentColor;\n}\n\n.gg-menu::after,\n.gg-menu::before {\n  content: "";\n  position: absolute;\n  top: -6px;\n}\n\n.gg-menu::after {\n  top: 6px;\n}\n\n.gg-play-button {\n  box-sizing: border-box;\n  position: relative;\n  display: block;\n  transform: scale(var(--ggs, 1));\n  width: 22px;\n  height: 22px;\n}\n\n.gg-play-button::before {\n  content: "";\n  display: block;\n  box-sizing: border-box;\n  position: absolute;\n  width: 0;\n  height: 10px;\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid transparent;\n  border-left: 6px solid;\n  top: 6px;\n  left: 9px;\n}\n\n.gg-play-forwards {\n  box-sizing: border-box;\n  position: relative;\n  display: block;\n  transform: scale(var(--ggs, 1));\n  width: 3px;\n  height: 10px;\n  background: currentColor;\n}\n\n.gg-play-forwards::after,\n.gg-play-forwards::before {\n  content: "";\n  display: block;\n  box-sizing: border-box;\n  position: absolute;\n  width: 0;\n  height: 10px;\n  border-top: 5px solid transparent;\n  border-bottom: 5px solid transparent;\n  border-left: 6px solid;\n  left: -7px;\n}\n\n.gg-play-forwards::before {\n  left: -14px;\n}\n',""]);const a=o},645:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",r=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),r&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),r&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,r,s,i){"string"==typeof e&&(e=[[null,e,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var l=0;l<e.length;l++){var u=[].concat(e[l]);r&&o[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),s&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=s):u[4]="".concat(s)),t.push(u))}},t}},81:e=>{e.exports=function(e){return e[1]}},379:e=>{var t=[];function n(e){for(var n=-1,r=0;r<t.length;r++)if(t[r].identifier===e){n=r;break}return n}function r(e,r){for(var i={},o=[],a=0;a<e.length;a++){var c=e[a],l=r.base?c[0]+r.base:c[0],u=i[l]||0,h="".concat(l," ").concat(u);i[l]=u+1;var d=n(h),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)t[d].references++,t[d].updater(f);else{var p=s(f,r);r.byIndex=a,t.splice(a,0,{identifier:h,updater:p,references:1})}o.push(h)}return o}function s(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,s){var i=r(e=e||[],s=s||{});return function(e){e=e||[];for(var o=0;o<i.length;o++){var a=n(i[o]);t[a].references--}for(var c=r(e,s),l=0;l<i.length;l++){var u=n(i[l]);0===t[u].references&&(t[u].updater(),t.splice(u,1))}i=c}}},569:e=>{var t={};e.exports=function(e,n){var r=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},565:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},795:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var s=void 0!==n.layer;s&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,s&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(r,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},589:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={id:r,exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e;n.g.importScripts&&(e=n.g.location+"");var t=n.g.document;if(!e&&t&&(t.currentScript&&(e=t.currentScript.src),!e)){var r=t.getElementsByTagName("script");if(r.length)for(var s=r.length-1;s>-1&&!e;)e=r[s--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=e})(),n.nc=void 0,(()=>{class e{constructor(e){this.path=e}static emptyPath(){return new e([])}advance(){const t=this.path[this.path.length-1];if(t instanceof r){const n=new r(t.times+1),s=this.path.slice(0,-1);return s.push(n),new e(s)}return new e([...this.path,new r(1)])}makeDecision(t){return new e([...this.path,new s(t)])}goToCommand(t){return new e([...this.path,new i(t)])}undo(t){let n=t;const s=[...this.path];for(;0!==n;){const t=s[s.length-1];if(t instanceof r)t.times<=n?(s.pop(),n-=t.times):t.times>n&&(s.pop(),s.push(new r(t.times-n)),n-=n);else{if(void 0===t)return new e([]);s.pop(),n-=1}}return new e(s)}getActions(){return this.path}getDecisions(){return this.path.filter((e=>e instanceof s)).map((e=>e.id))}getRemainingAdvances(){const e=this.path[this.path.length-1];return e instanceof r?e.times:0}toShorthandPath(){if(void 0!==this.path.find((e=>e instanceof i)))throw new Error("Can't get shorthand of path containing goto action");return[...this.getDecisions(),this.getRemainingAdvances()]}}class t{}class r extends t{constructor(e){super(),this.times=e}perform(e){for(let t=0;t<this.times;t++)e=u.advanceUntilStop(e);return e}}class s extends t{constructor(e){super(),this.id=e}perform(e){return e=u.makeDecision(this.id,e),u.advanceUntilStop(e)}}class i extends t{constructor(e){super(),this.id=e}perform(e){return u.goToCommandDirect(this.id,e)}}const o="narrator";function a(e){if(null!==e.decision)return e;let t=Object.assign({},e);return t.animatableState=Object.assign(Object.assign({},e.animatableState),{background:Object.assign(Object.assign({},e.animatableState.background),{shouldTransition:!1}),audio:Object.assign(Object.assign({},e.animatableState.audio),{sfx:null})}),t.stopAfterRender=!1,t.commandIndex<t.commands.length&&(t.seenCommands.add(t.commandIndex),t=t.commands[t.commandIndex].apply(t),t.commandIndex===e.commandIndex&&t.commandIndex++),t.commandIndex==t.commands.length&&(t.stopAfterRender=!0),t}function c(e,t){if(null===t.decision)return t;if(e<0||e>t.decision.length-1)return t;const n=t.decision[e],r=Object.assign({},t);if(void 0===t.labels[n.jumpLabel])throw new Error("Target label does not exist.");return r.commandIndex=t.labels[n.jumpLabel],r.stopAfterRender=!1,r.decision=null,r}function l(e){let t=0;for(e=a(e);!e.stopAfterRender;)if(e=a(e),t++,t>1e4)throw alert("Looks like we're stuck in an infinite loop"),new Error("Got stuck in infinite loop while replaying path");return e}const u={advance:a,makeDecision:c,goToCommandDirect:function(e,t){return e<1||e>t.commands.length?t:a(t=Object.assign(Object.assign({},t),{commandIndex:e-1,decision:null}))},advanceUntilStop:l,fromShorthandPath:function(t,n,r){let s=e.emptyPath(),i=t,o=0;for(;o<n.length;){let e=0;for(;null===i.decision;)if(i=a(i),i.stopAfterRender&&(s=s.advance()),e++,e>1e4)throw alert("Looks like we're stuck in an infinite loop"),new Error("Got stuck in infinite loop while replaying path");i=c(n[o],i),s=s.makeDecision(n[o]),o++}for(i=l(i),s=s.advance();r>0;)i=l(i),s=s.advance(),r--;return[i,s]},fromPath:function(e,t){let n=e;for(const e of t.getActions())n=e.perform(n);return n}};class h{constructor(e){this.location=e}getSourceLocation(){return this.location}apply(e){return e}}var d;!function(e){e[e.WARNING=0]="WARNING",e[e.ERROR=1]="ERROR"}(d||(d={}));class f{constructor(e,t,n){this.message=e,this.location=t,this.level=n}}const p={},m=(e,t)=>{if(e[0]!==e[0].toLowerCase())throw new Error(`Command ${e} must be non-capitalized. Capitalized keys are reserved for actors.`);if(void 0!==p[e])throw new Error(`Command ${e} already registered`);p[e]=t};function g(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function y(e,t){return(n,r)=>{try{const s=e.parse(n);return new t(r,s)}catch(e){return new f(e.message,r,d.WARNING)}}}class v extends h{constructor(e,t){super(e),this.items=t}apply(e){return Object.assign(Object.assign({},e),{stopAfterRender:!0,decision:this.items})}}m("decision",((e,t)=>{const n=[];if(!Array.isArray(e))return new f("Decisions must be a seq.",t,d.WARNING);for(const r of e){if("object"!=typeof r)return new f("Decision must be a single-keyed map.",t,d.WARNING);if(1!==Object.keys(r).length)return new f("Decision must be a single-keyed map.",t,d.WARNING);const e=Object.keys(r)[0],s=r[e];if("object"!=typeof s)return new f(`Decision "${e}"'s value must be a map.`,t,d.WARNING);const i=s.jump;if("string"!=typeof i)return new f(`Decision "${e}" must have a jump label`,t,d.WARNING);const o={title:e,jumpLabel:i};n.push(o)}return new v(t,n)}));class b extends h{apply(e){return Object.assign(Object.assign({},e),{animatableState:Object.assign(Object.assign({},e.animatableState),{text:null}),stopAfterRender:!0})}}m("textbox",((e,t)=>"close"===e?new b(t):new f("Not a valid textbox command.",t,d.WARNING)));class w{constructor(e){this.value=e}evaluate(e){if("string"==typeof this.value&&"$"===this.value.charAt(0)){if("$"===this.value.charAt(1))return this.value.slice(1);const t=this.value.slice(1);if(void 0===e.variables[t])throw new Error(`VN variable ${t} not set.`);return e.variables[t]}return this.value}}class k extends h{constructor(e,t,n){super(e),this.identifier=t,this.expr=n}apply(e){const t=Object.assign({},e),n=this.expr.evaluate(e);return t.variables=Object.assign(Object.assign({},e.variables),{[this.identifier]:n}),t.stopAfterRender=!1,t}}const x=(e,t)=>{if("string"==typeof e&&"string"==typeof t)return e+t;if("number"==typeof e&&"number"==typeof t)return e+t;throw new Error("Values to be added must be of the same type.")},S=(e,t)=>{if("number"==typeof e&&"number"==typeof t)return e-t;throw new Error("Values to be subtracted must be numbers.")},E=(e,t)=>{if("number"==typeof e&&"number"==typeof t)return e*t;throw new Error("Values to be multiplied must be numbers.")},N=(e,t)=>{if("number"==typeof e&&"number"==typeof t)return e/t;throw new Error("Values to be divided must be numbers.")};class T extends h{constructor(e,t,n,r){super(e),this.identifier=t,this.expr=n,this.operator=r}apply(e){const t=Object.assign({},e),n=e.variables[this.identifier];if(void 0===n)throw new Error(`VN variable ${this.identifier} not set`);const r=this.expr.evaluate(e);return t.variables=Object.assign(Object.assign({},e.variables),{[this.identifier]:this.operator(n,r)}),t.stopAfterRender=!1,t}}m("set",((e,t)=>{if(!Array.isArray(e)||3!==e.length)return new f("set command must be a seq of format [<identifier>, <operator>, <value>].",t,d.WARNING);if("string"!=typeof e[0])return new f("Identifier must be a string.",t,d.WARNING);if("$"!==e[0].charAt(0))return new f("Identifier must begin with a dollar sign.",t,d.WARNING);const n=e[0].slice(1);if("string"!=typeof e[1])return new f("Operator must be a string.",t,d.WARNING);const r=e[1];if(!O(e[2]))return new f("Value must be a string, number or boolean.",t,d.WARNING);const s=new w(e[2]);switch(r){case"=":return new k(t,n,s);case"+=":return new T(t,n,s,x);case"-=":return new T(t,n,s,S);case"*=":return new T(t,n,s,E);case"/=":return new T(t,n,s,N);default:return new f(`${r} is not a valid operator.`,t,d.WARNING)}}));const O=e=>["string","number","boolean"].includes(typeof e);class I extends h{constructor(e,t){super(e),this.cmd=t}apply(e){const t={actor:this.cmd.actor,sprite:this.cmd.sprite,x:void 0===this.cmd.x?.5:this.cmd.x,y:void 0===this.cmd.y?.5:this.cmd.y,anchorX:void 0===this.cmd.anchorX?.5:this.cmd.anchorX,anchorY:void 0===this.cmd.anchorY?.5:this.cmd.anchorY},n=Object.assign(Object.assign({},e.animatableState.sprites),{[this.cmd.actor]:t}),r=Object.assign(Object.assign({},e),{stopAfterRender:!1});return r.animatableState=Object.assign(Object.assign({},e.animatableState),{sprites:n}),r}}function A(e,t,n){if(!g(e,t))return new f(`Show command must have ${t} property.`,n,d.WARNING);const r=e[t];return"string"!=typeof r?new f(`${t} must be a string.`,n,d.WARNING):r}function _(e,t){if(!g(e,t))return;const n=e[t];if("number"==typeof n||void 0===n)return n;throw new Error(`${t} must be a number.`)}m("show",((e,t)=>{if("object"!=typeof e||null===e)return new f("Show command must be a map",t,d.WARNING);if(!g(e,"actor"))return new f("Show command must have actor property",t,d.WARNING);const n=A(e,"actor",t);if(n instanceof f)return n;const r=A(e,"sprite",t);if(r instanceof f)return r;try{return new I(t,{actor:n,sprite:r,x:_(e,"x"),y:_(e,"y"),anchorX:_(e,"anchorX"),anchorY:_(e,"anchorY")})}catch(e){const n=e.message;return new f(n,t,d.WARNING)}}));class L extends h{constructor(e,t){super(e),this.id=t}apply(e){const t=Object.assign({},e.animatableState.sprites);delete t[this.id];const n=Object.assign(Object.assign({},e),{stopAfterRender:!1});return n.animatableState=Object.assign(Object.assign({},e.animatableState),{sprites:t}),n}}m("hide",((e,t)=>"string"!=typeof e?new f("Sprite id must be a string.",t,d.WARNING):new L(t,e)));var j=function(e,t){return j=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},j(e,t)};function $(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}j(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var C=function(){return C=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var s in t=arguments[n])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e},C.apply(this,arguments)};function P(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))}function R(e,t){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function B(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function D(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,s,i=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)o.push(r.value)}catch(e){s={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(s)throw s.error}}return o}function F(e,t){for(var n=0,r=t.length,s=e.length;n<r;n++,s++)e[s]=t[n];return e}var M,q=Object.freeze({invalid_data:!0});!function(e){e.assertNever=function(e){throw new Error},e.arrayToEnum=function(e){var t,n,r={};try{for(var s=B(e),i=s.next();!i.done;i=s.next()){var o=i.value;r[o]=o}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return r},e.getValidEnumValues=function(t){var n,r,s=Object.keys(t).filter((function(e){return"number"!=typeof t[t[e]]})),i={};try{for(var o=B(s),a=o.next();!a.done;a=o.next()){var c=a.value;i[c]=t[c]}}catch(e){n={error:e}}finally{try{a&&!a.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return e.getValues(i)},e.getValues=function(e){return Object.keys(e).map((function(t){return e[t]}))},e.objectValues=function(e){return Object.keys(e).map((function(t){return e[t]}))},e.find=function(e,t){var n,r;try{for(var s=B(e),i=s.next();!i.done;i=s.next()){var o=i.value;if(t(o))return o}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}}}(M||(M={}));var U,W=M.arrayToEnum(["invalid_type","custom","invalid_union","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types"]),K=function(e){function t(t){var n=this.constructor,r=e.call(this)||this;r.issues=[],r.format=function(){var e={_errors:[]},t=function(n){var r,s;try{for(var i=B(n.issues),o=i.next();!o.done;o=i.next()){var a=o.value;if("invalid_union"===a.code)a.unionErrors.map(t);else if("invalid_return_type"===a.code)t(a.returnTypeError);else if("invalid_arguments"===a.code)t(a.argumentsError);else if(0===a.path.length)e._errors.push(a.message);else for(var c=e,l=0;l<a.path.length;){var u=a.path[l];if(l===a.path.length-1)c[u]=c[u]||{_errors:[]},c[u]._errors.push(a.message);else if("string"==typeof u)c[u]=c[u]||{_errors:[]};else if("number"==typeof u){var h=[];h._errors=[],c[u]=c[u]||h}c=c[u],l++}}}catch(e){r={error:e}}finally{try{o&&!o.done&&(s=i.return)&&s.call(i)}finally{if(r)throw r.error}}};return t(r),e},r.addIssue=function(e){r.issues=F(F([],D(r.issues)),[e])},r.addIssues=function(e){void 0===e&&(e=[]),r.issues=F(F([],D(r.issues)),D(e))},r.flatten=function(){var e,t,n={},s=[];try{for(var i=B(r.issues),o=i.next();!o.done;o=i.next()){var a=o.value;a.path.length>0?(n[a.path[0]]=n[a.path[0]]||[],n[a.path[0]].push(a.message)):s.push(a.message)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return{formErrors:s,fieldErrors:n}};var s=n.prototype;return Object.setPrototypeOf(r,s),r.issues=t,r}return $(t,e),Object.defineProperty(t.prototype,"errors",{get:function(){return this.issues},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return"ZodError: "+JSON.stringify(this.issues,null,2)},Object.defineProperty(t.prototype,"message",{get:function(){return JSON.stringify(this.issues,null,2)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isEmpty",{get:function(){return 0===this.issues.length},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"formErrors",{get:function(){return this.flatten()},enumerable:!1,configurable:!0}),t.create=function(e){return new t(e)},t}(Error),Y=function(e,t){var n;switch(e.code){case W.invalid_type:n="undefined"===e.received?"Required":"Expected "+e.expected+", received "+e.received;break;case W.unrecognized_keys:n="Unrecognized key(s) in object: "+e.keys.map((function(e){return"'"+e+"'"})).join(", ");break;case W.invalid_union:n="Invalid input";break;case W.invalid_enum_value:n="Invalid enum value. Expected "+e.options.map((function(e){return"string"==typeof e?"'"+e+"'":e})).join(" | ")+", received "+("string"==typeof t.data?"'"+t.data+"'":t.data);break;case W.invalid_arguments:n="Invalid function arguments";break;case W.invalid_return_type:n="Invalid function return type";break;case W.invalid_date:n="Invalid date";break;case W.invalid_string:n="regex"!==e.validation?"Invalid "+e.validation:"Invalid";break;case W.too_small:n="array"===e.type?"Should have "+(e.inclusive?"at least":"more than")+" "+e.minimum+" items":"string"===e.type?"Should be "+(e.inclusive?"at least":"over")+" "+e.minimum+" characters":"number"===e.type?"Value should be greater than "+(e.inclusive?"or equal to ":"")+e.minimum:"Invalid input";break;case W.too_big:n="array"===e.type?"Should have "+(e.inclusive?"at most":"less than")+" "+e.maximum+" items":"string"===e.type?"Should be "+(e.inclusive?"at most":"under")+" "+e.maximum+" characters long":"number"===e.type?"Value should be less than "+(e.inclusive?"or equal to ":"")+e.maximum:"Invalid input";break;case W.custom:n="Invalid input";break;case W.invalid_intersection_types:n="Intersections only support objects";break;default:n=t.defaultError,M.assertNever(e)}return{message:n}},V=Y,Z=M.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),z=function(e){return"string"==typeof e?Z.string:"number"==typeof e?Number.isNaN(e)?Z.nan:Z.number:"boolean"==typeof e?Z.boolean:"bigint"==typeof e?Z.bigint:"symbol"==typeof e?Z.symbol:e instanceof Date?Z.date:"function"==typeof e?Z.function:void 0===e||void 0===e?Z.undefined:"object"==typeof e?Array.isArray(e)?Z.array:null===e?Z.null:e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch?Z.promise:e instanceof Map?Z.map:e instanceof Set?Z.set:Z.object:Z.unknown},G=function(e,t){var n=function(e){var n=C(C({},e),{path:F(F([],D(t.path)),D(e.path||[]))}),r=Y(n,{data:t.data,defaultError:"Invalid input"});return C(C({},e),{path:F(F([],D(t.path)),D(e.path||[])),message:e.message||t.errorMap(n,{data:t.data,defaultError:r.message}).message})};return{makeIssue:n,addIssue:function(t){var r=n(t);e.addIssue(r)}}};!function(e){e.errToObj=function(e){return"string"==typeof e?{message:e}:e||{}},e.toString=function(e){return"string"==typeof e?e:null==e?void 0:e.message}}(U||(U={}));var J,H=Object.freeze({no_set:!0}),Q=function(){function e(t){var n=this;void 0===t&&(t=[]),this.all=function(e){return n.then((function(t,r){var s=e(t,r);if(r.async){var i=Promise.all(s.map((function(e){return P(n,void 0,void 0,(function(){return R(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.getValueAsync()];case 1:return[2,t.sent()];case 2:return t.sent(),[2,q];case 3:return[2]}}))}))}))).then((function(e){return e}));return i}return s.map((function(e){return e.getValueSync()}))}))},this.then=function(t){return new e(F(F([],D(n.items)),[{type:"function",function:t}]))},this.catch=function(t){return new e(F(F([],D(n.items)),[{type:"catcher",catcher:t}]))},this.getValueSync=function(){for(var e,t=void 0,r=function(r){try{var s=n.items[r];"function"===s.type&&(t=s.function(t,{async:!1}))}catch(e){var i=n.items.findIndex((function(e,t){return"catcher"===e.type&&t>r})),o=n.items[i];if(!o||"catcher"!==o.type)throw e;r=i,t=o.catcher(e,{async:!1})}e=r},s=0;s<n.items.length;s++)r(s),s=e;return t},this.getValueAsync=function(){return P(n,void 0,void 0,(function(){var t,n,r,s,i;return R(this,(function(o){switch(o.label){case 0:t=void 0,n=function(n){var i,o,a,c;return R(this,(function(l){switch(l.label){case 0:i=r.items[n],l.label=1;case 1:return l.trys.push([1,4,,8]),"function"!==i.type?[3,3]:[4,i.function(t,{async:!0})];case 2:t=l.sent(),l.label=3;case 3:return[3,8];case 4:if(o=l.sent(),a=r.items.findIndex((function(e,t){return"catcher"===e.type&&t>n})),(c=r.items[a])&&"catcher"===c.type)return[3,5];throw o;case 5:return n=a,[4,c.catcher(o,{async:!0})];case 6:t=l.sent(),l.label=7;case 7:return[3,8];case 8:if(t instanceof e)throw new Error("ASYNC: DO NOT RETURN PSEUDOPROMISE FROM FUNCTIONS");if(t instanceof Promise)throw new Error("ASYNC: DO NOT RETURN PROMISE FROM FUNCTIONS");return s=n,[2]}}))},r=this,i=0,o.label=1;case 1:return i<this.items.length?[5,n(i)]:[3,4];case 2:o.sent(),i=s,o.label=3;case 3:return i++,[3,1];case 4:return[2,t]}}))}))},this.items=t}return e.all=function(t){return(new e).all((function(){return t}))},e.object=function(t){return(new e).then((function(e,n){var r,s,i={},o=new K([]);if(n.async)return P(void 0,void 0,void 0,(function(){var e,n,r,s,a,c;return R(this,(function(l){switch(l.label){case 0:return[4,Promise.all(Object.keys(t).map((function(e){return P(void 0,void 0,void 0,(function(){var n,r;return R(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,t[e].getValueAsync()];case 1:return n=s.sent(),[2,[e,n]];case 2:if((r=s.sent())instanceof K)return o.addIssues(r.issues),[2,[e,q]];throw r;case 3:return[2]}}))}))})))];case 1:if(e=l.sent(),!o.isEmpty)throw o;try{for(n=B(e),r=n.next();!r.done;r=n.next())(s=r.value)[1]!==H&&(i[s[0]]=s[1])}catch(e){a={error:e}}finally{try{r&&!r.done&&(c=n.return)&&c.call(n)}finally{if(a)throw a.error}}return[2,i]}}))}));var a=Object.keys(t).map((function(e){try{return[e,t[e].getValueSync()]}catch(t){if(t instanceof K)return o.addIssues(t.issues),[e,q];throw t}}));if(!o.isEmpty)throw o;try{for(var c=B(a),l=c.next();!l.done;l=c.next()){var u=l.value;u[1]!==H&&(i[u[0]]=u[1])}}catch(e){r={error:e}}finally{try{l&&!l.done&&(s=c.return)&&s.call(c)}finally{if(r)throw r.error}}return i}))},e.resolve=function(t){if(t instanceof e)throw new Error("Do not pass PseudoPromise into PseudoPromise.resolve");return(new e).then((function(){return t}))},e}(),X=function(){function e(e){var t=this;this._parseInternalOptionalParams=function(e){var n,r={data:e.data,path:e.path||[],parentError:e.parentError||new K([]),errorMap:e.errorMap||V,async:null!==(n=e.async)&&void 0!==n&&n};return t._parseInternal(r)},this.parse=function(e,n){var r=t._parseInternalOptionalParams(C({data:e},n));if(r instanceof Promise)throw new Error("You can't use .parse() on a schema containing async elements. Use .parseAsync instead.");if(r.success)return r.data;throw r.error},this.safeParse=function(e,n){var r=t._parseInternalOptionalParams(C({data:e},n));if(r instanceof Promise)throw new Error("You can't use .safeParse() on a schema containing async elements. Use .parseAsync instead.");return r},this.parseAsync=function(e,n){return P(t,void 0,void 0,(function(){var t;return R(this,(function(r){switch(r.label){case 0:return[4,this._parseInternalOptionalParams(C(C({data:e},n),{async:!0}))];case 1:if((t=r.sent()).success)return[2,t.data];throw t.error}}))}))},this.safeParseAsync=function(e,n){return P(t,void 0,void 0,(function(){return R(this,(function(t){switch(t.label){case 0:return[4,this._parseInternalOptionalParams(C(C({data:e},n),{async:!0}))];case 1:return[2,t.sent()]}}))}))},this.spa=this.safeParseAsync,this._parseWithInvalidFallback=function(e,n){var r=t._parseInternal(C(C({},n),{data:e}));return r instanceof Promise?r.then((function(e){return e.success?e.data:q})):r.success?r.data:q},this.refine=function(e,n){return"string"==typeof n||void 0===n?t._refinement((function(t,r){var s=e(t),i=function(){return r.addIssue({code:W.custom,message:n})};return s instanceof Promise?s.then((function(e){e||i()})):s?void 0:(i(),s)})):"function"==typeof n?t._refinement((function(t,r){var s=e(t),i=function(){return r.addIssue(C({code:W.custom},n(t)))};return s instanceof Promise?s.then((function(e){e||i()})):s?void 0:(i(),s)})):t._refinement((function(t,r){var s=e(t),i=function(){return r.addIssue(C({code:W.custom},n))};return s instanceof Promise?s.then((function(e){e||i()})):s?void 0:(i(),s)}))},this.refinement=function(e,n){return t._refinement((function(t,r){e(t)||r.addIssue("function"==typeof n?n(t,r):n)}))},this.superRefine=this._refinement,this.optional=function(){return Le.create(t)},this.nullable=function(){return je.create(t)},this.nullish=function(){return t.optional().nullable()},this.array=function(){return pe.create(t)},this.isOptional=function(){return t.safeParse(void 0).success},this.isNullable=function(){return t.safeParse(null).success},this._def=e,this.transform=this.transform.bind(this),this.default=this.default.bind(this)}return e.prototype._parseInternal=function(e){var t,n=e.data,r=new K([]),s=G(r,C({},e)),i=s.makeIssue,o=s.addIssue,a=z(n);try{var c=this._parse(C(C({},e),{currentError:r,makeIssue:i,addIssue:o,parsedType:a}));t=c instanceof Q?c:Q.resolve(c)}catch(e){t=Q.resolve(q)}var l=!1===e.async||this instanceof Ae;return t=t.then((function(e){if(!r.isEmpty)throw r;return e})).then((function(e){return{success:!0,data:e}})).catch((function(t){if(e.parentError.addIssues(r.issues),t instanceof K)return{success:!1,error:t};throw t})),l?t.getValueSync():t.getValueAsync()},e.prototype._refinement=function(e){return new _e(this instanceof _e?C(C({},this._def),{effects:F(F([],D(this._def.effects||[])),[{type:"refinement",refinement:e}])}):{schema:this,effects:[{type:"refinement",refinement:e}]})},e.prototype.or=function(e){return this instanceof ve?ve.create(F(F([],D(this.options)),[e])):ve.create([this,e])},e.prototype.and=function(e){return be.create(this,e)},e.prototype.transform=function(e){return new _e(this instanceof _e?C(C({},this._def),{effects:F(F([],D(this._def.effects||[])),[{type:"transform",transform:e}])}):{schema:this,effects:[{type:"transform",transform:e}]})},e.prototype.default=function(e){return new $e({innerType:this,defaultValue:"function"==typeof e?e:function(){return e}})},e}(),ee=/^[a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$/i,te=/^(([^<>()[\]\.,;:\s@\"]+(\.[^<>()[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i,ne=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n._regex=function(e,t,r){return n.refinement((function(t){return e.test(t)}),C({validation:t,code:W.invalid_string},U.errToObj(r)))},n.email=function(e){return new t(C(C({},n._def),{isEmail:U.errToObj(e)}))},n.url=function(e){return new t(C(C({},n._def),{isURL:U.errToObj(e)}))},n.uuid=function(e){return new t(C(C({},n._def),{isUUID:U.errToObj(e)}))},n.regex=function(e,t){return n._regex(e,"regex",t)},n.min=function(e,r){return new t(C(C({},n._def),{minLength:{value:e,message:U.errToObj(r).message}}))},n.max=function(e,r){return new t(C(C({},n._def),{maxLength:{value:e,message:U.errToObj(r).message}}))},n.nonempty=function(e){return n.min(1,U.errToObj(e))},n}return $(t,e),t.prototype._parse=function(e){if(e.parsedType!==Z.string)return e.addIssue({code:W.invalid_type,expected:Z.string,received:e.parsedType}),q;if(null!==this._def.minLength&&e.data.length<this._def.minLength.value&&e.addIssue({code:W.too_small,minimum:this._def.minLength.value,type:"string",inclusive:!0,message:this._def.minLength.message}),null!==this._def.maxLength&&e.data.length>this._def.maxLength.value&&e.addIssue({code:W.too_big,maximum:this._def.maxLength.value,type:"string",inclusive:!0,message:this._def.maxLength.message}),this._def.isEmail&&!te.test(e.data)&&e.addIssue({validation:"email",code:W.invalid_string,message:this._def.isEmail.message}),this._def.isURL)try{new URL(e.data)}catch(t){e.addIssue({validation:"url",code:W.invalid_string,message:this._def.isURL.message})}return this._def.isUUID&&!ee.test(e.data)&&e.addIssue({validation:"uuid",code:W.invalid_string,message:this._def.isUUID.message}),e.data},t.prototype.length=function(e,t){return this.min(e,t).max(e,t)},t.create=function(){return new t({isEmail:!1,isURL:!1,isUUID:!1,minLength:null,maxLength:null})},t}(X),re=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.min=function(e,r){return new t(C(C({},n._def),{minimum:{value:e,inclusive:!0,message:U.toString(r)}}))},n.max=function(e,r){return new t(C(C({},n._def),{maximum:{value:e,inclusive:!0,message:U.toString(r)}}))},n.int=function(e){return new t(C(C({},n._def),{isInteger:{message:U.toString(e)}}))},n.positive=function(e){return new t(C(C({},n._def),{minimum:{value:0,inclusive:!1,message:U.toString(e)}}))},n.negative=function(e){return new t(C(C({},n._def),{maximum:{value:0,inclusive:!1,message:U.toString(e)}}))},n.nonpositive=function(e){return new t(C(C({},n._def),{maximum:{value:0,inclusive:!0,message:U.toString(e)}}))},n.nonnegative=function(e){return new t(C(C({},n._def),{minimum:{value:0,inclusive:!0,message:U.toString(e)}}))},n}return $(t,e),t.prototype._parse=function(e){if(e.parsedType!==Z.number)return e.addIssue({code:W.invalid_type,expected:Z.number,received:e.parsedType}),q;if(Number.isNaN(e.data))return e.addIssue({code:W.invalid_type,expected:Z.number,received:Z.nan}),q;if(this._def.isInteger&&(Number.isInteger(e.data)||e.addIssue({code:W.invalid_type,expected:"integer",received:"float",message:this._def.isInteger.message})),this._def.minimum){var t=this._def.minimum;(t.inclusive?e.data<t.value:e.data<=t.value)&&e.addIssue({code:W.too_small,minimum:t.value,type:"number",inclusive:t.inclusive,message:t.message})}if(this._def.maximum){var n=this._def.maximum;(n.inclusive?e.data>n.value:e.data>=n.value)&&e.addIssue({code:W.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,message:n.message})}return e.data},t.create=function(){return new t({minimum:null,maximum:null,isInteger:!1})},t}(X),se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(e.parsedType===Z.bigint)return e.data;e.addIssue({code:W.invalid_type,expected:Z.bigint,received:e.parsedType})},t.create=function(){return new t({})},t}(X),ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(e.parsedType===Z.boolean)return e.data;e.addIssue({code:W.invalid_type,expected:Z.boolean,received:e.parsedType})},t.create=function(){return new t({})},t}(X),oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(e.parsedType===Z.date){if(!isNaN(e.data.getTime()))return new Date(e.data.getTime());e.addIssue({code:W.invalid_date})}else e.addIssue({code:W.invalid_type,expected:Z.date,received:e.parsedType})},t.create=function(){return new t({})},t}(X),ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(e.parsedType===Z.undefined)return e.data;e.addIssue({code:W.invalid_type,expected:Z.undefined,received:e.parsedType})},t.create=function(){return new t({})},t}(X),ce=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(e.parsedType===Z.null)return e.data;e.addIssue({code:W.invalid_type,expected:Z.null,received:e.parsedType})},t.create=function(){return new t({})},t}(X),le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){return e.data},t.create=function(){return new t({})},t}(X),ue=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){return e.data},t.create=function(){return new t({})},t}(X),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){e.addIssue({code:W.invalid_type,expected:Z.never,received:e.parsedType})},t.create=function(){return new t({})},t}(X),de=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(e.parsedType===Z.undefined||e.parsedType===Z.null)return e.data;e.addIssue({code:W.invalid_type,expected:Z.void,received:e.parsedType})},t.create=function(){return new t({})},t}(X),fe=function(e,t){return e.parsedType!==Z.array?(e.addIssue({code:W.invalid_type,expected:Z.array,received:e.parsedType}),!1):(null!==t.minLength&&e.data.length<t.minLength.value&&e.addIssue({code:W.too_small,minimum:t.minLength.value,type:"array",inclusive:!0,message:t.minLength.message}),null!==t.maxLength&&e.data.length>t.maxLength.value&&e.addIssue({code:W.too_big,maximum:t.maxLength.value,type:"array",inclusive:!0,message:t.maxLength.message}),!0)},pe=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.min=function(e,r){return new t(C(C({},n._def),{minLength:{value:e,message:U.toString(r)}}))},n.max=function(e,r){return new t(C(C({},n._def),{maxLength:{value:e,message:U.toString(r)}}))},n.length=function(e,t){return n.min(e,t).max(e,t)},n.nonempty=function(){return new me(C({},n._def))},n}return $(t,e),t.prototype._parse=function(e){var t=this;if(fe(e,this._def))return Q.all(e.data.map((function(n,r){return(new Q).then((function(){return t._def.type._parseWithInvalidFallback(n,C(C({},e),{path:F(F([],D(e.path)),[r]),parentError:e.currentError}))}))})))},Object.defineProperty(t.prototype,"element",{get:function(){return this._def.type},enumerable:!1,configurable:!0}),t.create=function(e){return new t({type:e,minLength:null,maxLength:null})},t}(X),me=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.min=function(e,r){return new t(C(C({},n._def),{minLength:{value:e,message:U.toString(r)}}))},n.max=function(e,r){return new t(C(C({},n._def),{maxLength:{value:e,message:U.toString(r)}}))},n.length=function(e,t){return n.min(e,t).max(e,t)},n}return $(t,e),t.prototype._parse=function(e){var t=this;if(fe(e,this._def))return e.data.length<1&&e.addIssue({code:W.too_small,minimum:1,type:"array",inclusive:!0}),Q.all(e.data.map((function(n,r){return(new Q).then((function(){return t._def.type._parseWithInvalidFallback(n,C(C({},e),{path:F(F([],D(e.path)),[r]),parentError:e.currentError}))}))})))},t.create=function(e){return new t({type:e,minLength:null,maxLength:null})},t}(X);!function(e){e.mergeShapes=function(e,t){return C(C({},e),t)},e.intersectShapes=function(e,t){var n,r,s=Object.keys(e),i=Object.keys(t),o=s.filter((function(e){return-1!==i.indexOf(e)})),a={};try{for(var c=B(o),l=c.next();!l.done;l=c.next()){var u=l.value;a[u]=be.create(e[u],t[u])}}catch(e){n={error:e}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return C(C(C({},e),t),a)}}(J||(J={}));var ge=function(e){return function(t){return new ye(C(C({},e),{shape:function(){return C(C({},e.shape()),t)}}))}},ye=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.strict=function(){return new t(C(C({},n._def),{unknownKeys:"strict"}))},n.strip=function(){return new t(C(C({},n._def),{unknownKeys:"strip"}))},n.passthrough=function(){return new t(C(C({},n._def),{unknownKeys:"passthrough"}))},n.nonstrict=n.passthrough,n.augment=ge(n._def),n.extend=ge(n._def),n.setKey=function(e,t){var r;return n.augment(((r={})[e]=t,r))},n.merge=function(e){var r=J.mergeShapes(n._def.shape(),e._def.shape());return new t({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:function(){return r}})},n.catchall=function(e){return new t(C(C({},n._def),{catchall:e}))},n.pick=function(e){var r={};return Object.keys(e).map((function(e){r[e]=n.shape[e]})),new t(C(C({},n._def),{shape:function(){return r}}))},n.omit=function(e){var r={};return Object.keys(n.shape).map((function(t){-1===Object.keys(e).indexOf(t)&&(r[t]=n.shape[t])})),new t(C(C({},n._def),{shape:function(){return r}}))},n.partial=function(){var e={};for(var r in n.shape){var s=n.shape[r];e[r]=s.isOptional()?s:s.optional()}return new t(C(C({},n._def),{shape:function(){return e}}))},n.deepPartial=function(){var e={};for(var r in n.shape){var s=n.shape[r];e[r]=s instanceof t?s.isOptional()?s:s.deepPartial().optional():s.isOptional()?s:s.optional()}return new t(C(C({},n._def),{shape:function(){return e}}))},n.required=function(){var e={};for(var r in n.shape){for(var s=n.shape[r];s instanceof Le;)s=s._def.innerType;e[r]=s}return new t(C(C({},n._def),{shape:function(){return e}}))},n}return $(t,e),t.prototype._parse=function(e){var t,n,r,s,i,o,a=this;if(e.parsedType===Z.object){var c={},l=this._def.shape(),u=Object.keys(l),h=Object.keys(e.data),d=h.filter((function(e){return-1===u.indexOf(e)})),f=function(t){var n=u.includes(t)?l[t]:p._def.catchall instanceof he?void 0:p._def.catchall;return n?void 0!==e.data[t]||h.includes(t)?void(c[t]=(new Q).then((function(){return n._parseWithInvalidFallback(e.data[t],C(C({},e),{path:F(F([],D(e.path)),[t]),parentError:e.currentError}))})).then((function(e){return e}))):(c[t]=(new Q).then((function(){return n._parseWithInvalidFallback(void 0,C(C({},e),{path:F(F([],D(e.path)),[t]),parentError:e.currentError}))})).then((function(e){return void 0===e?H:e})),"continue"):"continue"},p=this;try{for(var m=B(u),g=m.next();!g.done;g=m.next())f(w=g.value)}catch(e){t={error:e}}finally{try{g&&!g.done&&(n=m.return)&&n.call(m)}finally{if(t)throw t.error}}if(this._def.catchall instanceof he){var y=this._def.unknownKeys;if("passthrough"===y)try{for(var v=B(d),b=v.next();!b.done;b=v.next()){var w=b.value;c[w]=Q.resolve(e.data[w])}}catch(e){r={error:e}}finally{try{b&&!b.done&&(s=v.return)&&s.call(v)}finally{if(r)throw r.error}}else if("strict"===y)d.length>0&&e.addIssue({code:W.unrecognized_keys,keys:d});else if("strip"!==y)throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{var k=function(t){c[t]=(new Q).then((function(){return a._def.catchall._parseWithInvalidFallback(e.data[t],C(C({},e),{path:F(F([],D(e.path)),[t]),parentError:e.currentError}))}))};try{for(var x=B(d),S=x.next();!S.done;S=x.next())k(w=S.value)}catch(e){i={error:e}}finally{try{S&&!S.done&&(o=x.return)&&o.call(x)}finally{if(i)throw i.error}}}return Q.object(c).then((function(e){return e}))}e.addIssue({code:W.invalid_type,expected:Z.object,received:e.parsedType})},Object.defineProperty(t.prototype,"shape",{get:function(){return this._def.shape()},enumerable:!1,configurable:!0}),t.create=function(e){return new t({shape:function(){return e},unknownKeys:"strip",catchall:he.create()})},t.strictCreate=function(e){return new t({shape:function(){return e},unknownKeys:"strict",catchall:he.create()})},t.lazycreate=function(e){return new t({shape:e,unknownKeys:"strip",catchall:he.create()})},t}(X),ve=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=F([],D(Array(this._def.options.length))).map((function(){return new K([])}));return Q.all(this._def.options.map((function(n,r){return(new Q).then((function(){return n._parseWithInvalidFallback(e.data,C(C({},e),{parentError:t[r]}))}))}))).then((function(n){return!!t.find((function(e){return e.isEmpty}))||e.addIssue({code:W.invalid_union,unionErrors:t}),n})).then((function(e){return e[t.indexOf(t.find((function(e){return e.isEmpty})))]}))},Object.defineProperty(t.prototype,"options",{get:function(){return this._def.options},enumerable:!1,configurable:!0}),t.create=function(e){return new t({options:e})},t}(X),be=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this;return Q.all([(new Q).then((function(){return t._def.left._parseWithInvalidFallback(e.data,C(C({},e),{parentError:e.currentError}))})),(new Q).then((function(){return t._def.right._parseWithInvalidFallback(e.data,C(C({},e),{parentError:e.currentError}))}))]).then((function(t){var n=D(t,2),r=n[0],s=n[1];if(r===q||s===q)return q;var i=z(r),o=z(s);return r===s?r:i===Z.object&&o===Z.object?C(C({},r),s):void e.addIssue({code:W.invalid_intersection_types})}))},t.create=function(e,n){return new t({left:e,right:n})},t}(X),we=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this;if(e.parsedType===Z.array){e.data.length>this._def.items.length?e.addIssue({code:W.too_big,maximum:this._def.items.length,inclusive:!0,type:"array"}):e.data.length<this._def.items.length&&e.addIssue({code:W.too_small,minimum:this._def.items.length,inclusive:!0,type:"array"});var n=e.data;return Q.all(n.map((function(n,r){var s=t._def.items[r];return s?(new Q).then((function(){return s._parseWithInvalidFallback(n,C(C({},e),{path:F(F([],D(e.path)),[r]),parentError:e.currentError}))})).then((function(e){return e})):Q.resolve(n)})))}e.addIssue({code:W.invalid_type,expected:Z.array,received:e.parsedType})},Object.defineProperty(t.prototype,"items",{get:function(){return this._def.items},enumerable:!1,configurable:!0}),t.create=function(e){return new t({items:e})},t}(X),ke=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this;if(e.parsedType===Z.object){var n={},r=function(r){n[r]=(new Q).then((function(){return t._def.valueType._parseWithInvalidFallback(e.data[r],C(C({},e),{path:F(F([],D(e.path)),[r]),parentError:e.currentError}))}))};for(var s in e.data)r(s);return Q.object(n)}e.addIssue({code:W.invalid_type,expected:Z.object,received:e.parsedType})},t.create=function(e){return new t({valueType:e})},t}(X),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this;if(e.parsedType===Z.map){var n=e.data,r=new Map;return Q.all(F([],D(n.entries())).map((function(n,s){var i=D(n,2),o=i[0],a=i[1];return Q.all([(new Q).then((function(){return t._def.keyType._parseWithInvalidFallback(o,C(C({},e),{path:F(F([],D(e.path)),[s,"key"]),parentError:e.currentError}))})),(new Q).then((function(){return t._def.valueType._parseWithInvalidFallback(a,C(C({},e),{path:F(F([],D(e.path)),[s,"value"]),parentError:e.currentError}))}))]).then((function(e){r.set(e[0],e[1])}))}))).then((function(){return r}))}e.addIssue({code:W.invalid_type,expected:Z.map,received:e.parsedType})},t.create=function(e,n){return new t({valueType:n,keyType:e})},t}(X),Se=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this;if(e.parsedType===Z.set){var n=e.data,r=new Set;return Q.all(F([],D(n.values())).map((function(n,s){return(new Q).then((function(){return t._def.valueType._parseWithInvalidFallback(n,C(C({},e),{path:F(F([],D(e.path)),[s]),parentError:e.currentError}))})).then((function(e){r.add(e)}))}))).then((function(){return r}))}e.addIssue({code:W.invalid_type,expected:Z.set,received:e.parsedType})},t.create=function(e){return new t({valueType:e})},t}(X),Ee=function(e){function t(){var n=null!==e&&e.apply(this,arguments)||this;return n.args=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return new t(C(C({},n._def),{args:we.create(e)}))},n.returns=function(e){return new t(C(C({},n._def),{returns:e}))},n.implement=function(e){return n.parse(e)},n.strictImplement=function(e){return n.parse(e)},n.validate=n.implement,n}return $(t,e),t.prototype._parse=function(e){var t=this;if(e.parsedType===Z.function){var n=this._def.returns instanceof Ae;return function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];var i=new K([]),o=new K([]),a=(new Q).then((function(){return t._def.args._parseWithInvalidFallback(r,C(C({},e),{parentError:i,async:n}))})).then((function(t){if(!i.isEmpty){var n=new K([]),r=e.makeIssue({code:W.invalid_arguments,argumentsError:i});throw n.addIssue(r),n}return t})).then((function(t){return e.data.apply(e,F([],D(t)))})).then((function(r){return t._def.returns._parseWithInvalidFallback(r,C(C({},e),{parentError:o,async:n}))})).then((function(t){if(!o.isEmpty){var n=new K([]),r=e.makeIssue({code:W.invalid_return_type,returnTypeError:o});throw n.addIssue(r),n}return t}));return n?a.getValueAsync():a.getValueSync()}}e.addIssue({code:W.invalid_type,expected:Z.function,received:e.parsedType})},t.prototype.parameters=function(){return this._def.args},t.prototype.returnType=function(){return this._def.returns},t.create=function(e,n){return new t({args:e||we.create([]),returns:n||ue.create()})},t}(X),Ne=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),Object.defineProperty(t.prototype,"schema",{get:function(){return this._def.getter()},enumerable:!1,configurable:!0}),t.prototype._parse=function(e){var t=this._def.getter();return Q.resolve(t._parseWithInvalidFallback(e.data,C(C({},e),{parentError:e.currentError})))},t.create=function(e){return new t({getter:e})},t}(X),Te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(e.data===this._def.value)return e.data;e.addIssue({code:W.invalid_type,expected:this._def.value,received:e.data})},t.create=function(e){return new t({value:e})},t}(X),Oe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){if(-1!==this._def.values.indexOf(e.data))return e.data;e.addIssue({code:W.invalid_enum_value,options:this._def.values})},Object.defineProperty(t.prototype,"options",{get:function(){return this._def.values},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"enum",{get:function(){var e,t,n={};try{for(var r=B(this._def.values),s=r.next();!s.done;s=r.next()){var i=s.value;n[i]=i}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Values",{get:function(){var e,t,n={};try{for(var r=B(this._def.values),s=r.next();!s.done;s=r.next()){var i=s.value;n[i]=i}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Enum",{get:function(){var e,t,n={};try{for(var r=B(this._def.values),s=r.next();!s.done;s=r.next()){var i=s.value;n[i]=i}}catch(t){e={error:t}}finally{try{s&&!s.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},enumerable:!1,configurable:!0}),t.create=function(e){return new t({values:e})},t}(X),Ie=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=M.getValidEnumValues(this._def.values);if(-1!==t.indexOf(e.data))return e.data;e.addIssue({code:W.invalid_enum_value,options:M.objectValues(t)})},t.create=function(e){return new t({values:e})},t}(X),Ae=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this;if(e.parsedType===Z.promise||!1!==e.async){var n=e.parsedType===Z.promise?e.data:Promise.resolve(e.data),r=new K([]);return Q.resolve(n.then((function(n){return t._def.type._parseWithInvalidFallback(n,C(C({},e),{parentError:r}))})).then((function(e){if(!r.isEmpty)throw r;return e})))}e.addIssue({code:W.invalid_type,expected:Z.promise,received:e.parsedType})},t.create=function(e){return new t({type:e})},t}(X),_e=function(e){function t(n){var r=e.call(this,n)||this;if(n.schema instanceof t)throw new Error("ZodEffectss cannot be nested.");return r}return $(t,e),t.prototype.innerType=function(){return this._def.schema},t.prototype._parse=function(e){var n,r,s=this,i=!1===e.async||this instanceof Ae,o=this._def.effects||[],a={addIssue:function(t){e.addIssue(t)},path:e.path},c=function(t){return function(t){if(!e.currentError.isEmpty)throw e.currentError;return t}},l=(new Q).then((function(){return s._def.schema._parseWithInvalidFallback(e.data,C(C({},e),{parentError:e.currentError}))})).then(c()),u=function(e){if("refinement"===e.type)l=l.all((function(t){return[Q.resolve(t),Q.resolve(t).then((function(){var n=e.refinement(t,a);if(i&&n instanceof Promise)throw new Error("You can't use .parse() on a schema containing async refinements. Use .parseAsync instead.");return n}))]})).then((function(e){var t=D(e,2),n=t[0];return t[1],n}));else{if("transform"!==e.type)throw new Error("Invalid effect type.");l=l.then(c()).then((function(n){if(!(s instanceof t))throw new Error("Only transformers can contain transformation functions.");return e.transform(n)})).then((function(e){if(i&&e instanceof Promise)throw new Error("You can't use .parse() on a schema containing async transformations. Use .parseAsync instead.");return e}))}};try{for(var h=B(o),d=h.next();!d.done;d=h.next())u(d.value)}catch(e){n={error:e}}finally{try{d&&!d.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}return l},t.create=function(e){return new t({schema:e})},t}(X),Le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this,n=e.data;if(e.parsedType!==Z.undefined)return(new Q).then((function(){return t._def.innerType._parseWithInvalidFallback(n,C(C({},e),{parentError:e.currentError}))}))},t.prototype.unwrap=function(){return this._def.innerType},t.create=function(e){return new t({innerType:e})},t}(X),je=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this;return e.parsedType===Z.null?null:(new Q).then((function(){return t._def.innerType._parseWithInvalidFallback(e.data,C(C({},e),{parentError:e.currentError}))}))},t.prototype.unwrap=function(){return this._def.innerType},t.create=function(e){return new t({innerType:e})},t}(X),$e=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return $(t,e),t.prototype._parse=function(e){var t=this,n=e.data;return e.parsedType===Z.undefined&&(n=this._def.defaultValue()),(new Q).then((function(){return t._def.innerType._parseWithInvalidFallback(n,C(C({},e),{parentError:e.currentError}))}))},t.prototype.removeDefault=function(){return this._def.innerType},t.create=function(e){return new Le({innerType:e})},t}(X),Ce=function(e,t){return e?le.create().refine(e,t):le.create()},Pe={object:ye.lazycreate},Re=ne.create,Be=re.create,De=se.create,Fe=ie.create,Me=oe.create,qe=ae.create,Ue=ce.create,We=le.create,Ke=ue.create,Ye=he.create,Ve=de.create,Ze=pe.create,ze=ye.create,Ge=ye.strictCreate,Je=ve.create,He=be.create,Qe=we.create,Xe=ke.create,et=xe.create,tt=Se.create,nt=Ee.create,rt=Ne.create,st=Te.create,it=Oe.create,ot=Ie.create,at=Ae.create,ct=_e.create,lt=Le.create,ut=je.create,ht=Object.freeze({__proto__:null,ZodParsedType:Z,getParsedType:z,issueHelpers:G,ZodType:X,ZodString:ne,ZodNumber:re,ZodBigInt:se,ZodBoolean:ie,ZodDate:oe,ZodUndefined:ae,ZodNull:ce,ZodAny:le,ZodUnknown:ue,ZodNever:he,ZodVoid:de,ZodArray:pe,ZodNonEmptyArray:me,get objectUtil(){return J},mergeObjects:function(e){return function(t){var n=J.mergeShapes(e._def.shape(),t._def.shape());return new ye({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:function(){return n}})}},ZodObject:ye,ZodUnion:ve,ZodIntersection:be,ZodTuple:we,ZodRecord:ke,ZodMap:xe,ZodSet:Se,ZodFunction:Ee,ZodLazy:Ne,ZodLiteral:Te,ZodEnum:Oe,ZodNativeEnum:Ie,ZodPromise:Ae,ZodEffects:_e,ZodTransformer:_e,ZodOptional:Le,ZodNullable:je,ZodDefault:$e,custom:Ce,Schema:X,ZodSchema:X,late:Pe,any:We,array:Ze,bigint:De,boolean:Fe,date:Me,effect:ct,enum:it,function:nt,instanceof:function(e,t){return void 0===t&&(t={message:"Input not instance of "+e.name}),Ce((function(t){return t instanceof e}),t)},intersection:He,lazy:rt,literal:st,map:et,nativeEnum:ot,never:Ye,null:Ue,nullable:ut,number:Be,object:ze,oboolean:function(){return Fe().optional()},onumber:function(){return Be().optional()},optional:lt,ostring:function(){return Re().optional()},promise:at,record:Xe,set:tt,strictObject:Ge,string:Re,transformer:ct,tuple:Qe,undefined:qe,union:Je,unknown:Ke,void:Ve,ZodIssueCode:W,quotelessJson:function(e){return JSON.stringify(e,null,2).replace(/"([^"]+)":/g,"$1:")},ZodError:K,defaultErrorMap:Y,get overrideErrorMap(){return V},setErrorMap:function(e){V=e}});class dt extends h{constructor(e,t){super(e),this.cmd=t}apply(e){var t,n,r,s,i,o;const a={image:this.cmd.image,panDuration:null!==(n=null===(t=this.cmd.pan)||void 0===t?void 0:t.duration)&&void 0!==n?n:0,panFrom:yt(null===(r=this.cmd.pan)||void 0===r?void 0:r.from),panTo:yt(null===(s=this.cmd.pan)||void 0===s?void 0:s.to),waitForPan:null!==(o=null===(i=this.cmd.pan)||void 0===i?void 0:i.wait)&&void 0!==o&&o,transition:this.cmd.transition,transitonDuration:this.cmd.duration,transitionOptions:this.cmd.options,shouldTransition:!0};return Object.assign(Object.assign({},e),{animatableState:Object.assign(Object.assign({},e.animatableState),{background:a})})}}const ft={},pt=Object.keys(ft),mt=ht.number().array().length(4);let gt=ht.object({transition:ht.enum(pt),options:ht.optional(ht.unknown()),duration:ht.number(),image:ht.string(),pan:ht.optional(ht.object({from:ht.optional(mt),to:ht.optional(mt),duration:ht.optional(ht.number()),wait:ht.optional(ht.boolean())}))});function yt(e){if(void 0===e)return;const[t,n,r,s]=e;return{x:t,y:n,w:r,h:s}}m("bg",(function(e,t){try{const n=gt.parse(e);if(void 0===n.options)return new dt(t,n);const r=ft[n.transition],s=gt.extend({options:r}).parse(e);return new dt(t,s)}catch(e){return new f(e.message,t,d.WARNING)}}));m("bgPan",y(ht.object({to:mt,duration:ht.number(),wait:ht.optional(ht.boolean())}),class extends h{constructor(e,t){super(e),this.cmd=t}apply(e){var t;return Object.assign(Object.assign({},e),{animatableState:Object.assign(Object.assign({},e.animatableState),{background:Object.assign(Object.assign({},e.animatableState.background),{panFrom:e.animatableState.background.panTo,panTo:yt(this.cmd.to),panDuration:this.cmd.duration,waitForPan:null!==(t=this.cmd.wait)&&void 0!==t&&t})})})}})),m("bgm",y(ht.union([ht.object({audio:ht.string(),loop:ht.boolean().optional().default(!0)}),ht.string()]),class extends h{constructor(e,t){super(e),this.cmd=t}apply(e){let t,n;return"string"==typeof this.cmd?(t=this.cmd,n=!0):(t=this.cmd.audio,n=this.cmd.loop),"stop"===t&&(t=null),Object.assign(Object.assign({},e),{animatableState:Object.assign(Object.assign({},e.animatableState),{audio:Object.assign(Object.assign({},e.animatableState.audio),{bgm:t,loopBgm:n})})})}}));m("sfx",y(ht.string(),class extends h{constructor(e,t){super(e),this.cmd=t}apply(e){return Object.assign(Object.assign({},e),{animatableState:Object.assign(Object.assign({},e.animatableState),{audio:Object.assign(Object.assign({},e.animatableState.audio),{sfx:this.cmd})})})}}));const vt=ht.array(ht.union([ht.number(),ht.tuple([ht.number(),ht.number()])]));class bt{constructor(){this.arr=[]}add(e){if(0===this.arr.length)return this.arr.push(e),this;for(let t=0;t<this.arr.length;t++){const n=this.arr[t],r="number"==typeof n?n:n[0],s="number"==typeof n?n:n[1];if(e<r-1)return this.arr.splice(t,0,e),this;if(e===r-1)return"number"==typeof n?this.arr[t]=[e,n]:n[0]=e,this;if(e>=r&&e<=s)return this;if(t<this.arr.length-1&&e===s+1&&e===wt(this.arr[t+1])-1)return"number"==typeof n?this.arr[t]=[n,kt(this.arr[t+1])]:n[1]=kt(this.arr[t+1]),this.arr.splice(t+1,1),this;if(e===s+1)return"number"==typeof n?this.arr[t]=[n,e]:n[1]=e,this}return this.arr.push(e),this}contains(e){for(const t of this.arr){if("number"==typeof t&&e<t||Array.isArray(t)&&e<t[0])return!1;if(t===e)return!0;if(Array.isArray(t)&&e>=t[0]&&e<=t[1])return!0}return!1}toJSON(){return this.arr}static fromJSON(e){const t=new bt;return t.arr=vt.parse(e),t}}function wt(e){return"number"==typeof e?e:e[0]}function kt(e){return"number"==typeof e?e:e[1]}const xt={actors:{default:{textColor:"white",nameTagColor:"white"},[o]:{}},backgrounds:[],audioAssets:[],commandIndex:0,commands:[],labels:{},stopAfterRender:!1,animatableState:{text:null,sprites:{},background:{image:"#FFFFFF",panDuration:0,panFrom:{x:0,y:0,w:0,h:0},panTo:{x:0,y:0,w:0,h:0},waitForPan:!1,transition:"fade",transitonDuration:0,shouldTransition:!1},audio:{bgm:null,loopBgm:!0,sfx:null}},decision:null,variables:{},seenCommands:new bt};var St=function(e,t,n,r){return new(n||(n=Promise))((function(s,i){function o(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?s(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}c((r=r.apply(e,t||[])).next())}))};class Et{constructor(e){this.root=document.createElement("div"),this.root.id="vn-textbox-renderer",e.appendChild(this.root),this.advTextBox=document.createElement("div"),this.advTextBox.classList.add("vn-adv-textbox"),this.advNameTag=document.createElement("div"),this.advNameTag.classList.add("vn-adv-nametag")}render(e,t,n){return St(this,void 0,void 0,(function*(){if(n&&t===e)return Promise.resolve();if(!n){const e=this.advTextBox.cloneNode();this.advTextBox.replaceWith(e),this.advTextBox=e,this.advTextBox.style.transform=""}if(null===t){if(n&&"adv"===(null==e?void 0:e.type)&&this.root.contains(this.advTextBox)){const[e,t]=fn();yield this.renderAdvNameTag(void 0,void 0,!0),this.advTextBox.style.transform="scaleY(0)";const n=()=>{this.advTextBox.removeEventListener("transitionend",n),this.root.innerHTML="",t()};return this.advTextBox.addEventListener("transitionend",n),e}return this.root.innerHTML="",Promise.resolve()}return"adv"===t.type?this.renderAdv(e,t,n):Promise.resolve()}))}renderAdv(e,t,n){return St(this,void 0,void 0,(function*(){const[r,s]=fn();if(this.advTextBox.innerHTML="",!this.root.contains(this.advTextBox)&&(this.root.appendChild(this.advTextBox),n)){const[e,t]=fn();this.advTextBox.style.transform="scaleY(0)",this.advTextBox.offsetHeight,this.advTextBox.style.transform="scaleY(1)";const n=()=>{this.advTextBox.removeEventListener("transitionend",n),t()};this.advTextBox.addEventListener("transitionend",n),yield e}const i=null===e?void 0:e.nameTag;yield this.renderAdvNameTag(i,t.nameTag,n);const o=document.createDocumentFragment();let a=0;return t.textNodes.forEach((e=>{const t=e.text;for(let r=0;r<t.length;r++){const i=document.createElement("span");i.innerText=t.charAt(r),n&&(i.style.animation="appear",i.style.animationTimingFunction="step-end",i.style.animationDuration=a+"ms",r===t.length-1&&i.addEventListener("animationend",(()=>s()))),i.style.color=e.color,o.appendChild(i),a+=e.characterDelay}})),this.advTextBox.appendChild(o),n?r:void 0}))}renderAdvNameTag(e,t,n){return St(this,void 0,void 0,(function*(){const[r,s]=fn(),i=()=>{this.advNameTag.removeEventListener("transitionend",i),this.root.removeChild(this.advNameTag),s()},o=()=>{this.advNameTag.removeEventListener("transitionend",o),c(),this.advNameTag.style.transform="scaleY(1)",this.advNameTag.addEventListener("transitionend",a)},a=()=>{this.advNameTag.removeEventListener("transitionend",a),s()};if(!n){const e=this.advNameTag.cloneNode(!0);this.advNameTag.replaceWith(e),this.advNameTag=e}if(void 0===t)return this.root.contains(this.advNameTag)?(n?(this.advNameTag.style.transform="scaleY(0)",this.advNameTag.addEventListener("transitionend",i)):(this.root.removeChild(this.advNameTag),s()),r):void 0;const c=()=>{this.advNameTag.textContent=t.name,this.advNameTag.style.color=t.color};if(this.root.contains(this.advNameTag)||this.root.appendChild(this.advNameTag),!n)return c(),void(this.advNameTag.style.transform="");if(void 0===e)this.advNameTag.style.transform="scaleY(0)",c(),this.advNameTag.offsetHeight,this.advNameTag.style.transform="scaleY(1)",this.advNameTag.addEventListener("transitionend",a);else{if(e.name===t.name&&e.color===t.color)return;this.advNameTag.style.transform="scaleY(0)",this.advNameTag.addEventListener("transitionend",o)}return r}))}}var Nt=n(379),Tt=n.n(Nt),Ot=n(795),It=n.n(Ot),At=n(569),_t=n.n(At),Lt=n(565),jt=n.n(Lt),$t=n(216),Ct=n.n($t),Pt=n(589),Rt=n.n(Pt),Bt=n(979),Dt={};Dt.styleTagTransform=Rt(),Dt.setAttributes=jt(),Dt.insert=_t().bind(null,"head"),Dt.domAPI=It(),Dt.insertStyleElement=Ct(),Tt()(Bt.Z,Dt),Bt.Z&&Bt.Z.locals&&Bt.Z.locals;var Ft=n(447),Mt={};Mt.styleTagTransform=Rt(),Mt.setAttributes=jt(),Mt.insert=_t().bind(null,"head"),Mt.domAPI=It(),Mt.insertStyleElement=Ct(),Tt()(Ft.Z,Mt),Ft.Z&&Ft.Z.locals&&Ft.Z.locals;var qt=n(4),Ut={};Ut.styleTagTransform=Rt(),Ut.setAttributes=jt(),Ut.insert=_t().bind(null,"head"),Ut.domAPI=It(),Ut.insertStyleElement=Ct(),Tt()(qt.Z,Ut),qt.Z&&qt.Z.locals&&qt.Z.locals;class Wt{constructor(e,t){this.TRANSITION_DELAY=300,this.renderer=t,this.root=document.createElement("div"),this.root.id="vn-decision-renderer",e.appendChild(this.root)}render(e,t){var n,r,s,i,o;return r=this,s=void 0,o=function*(){if(t&&(null===(n=this.renderer.getCommittedState())||void 0===n?void 0:n.decision)===e)return Promise.resolve();if(null===e){if(!t)return this.root.innerHTML="",Promise.resolve();const[e,n]=fn(),r=this.root.children;for(let e=0;e<r.length;e++){const t=r[e];e===r.length-1&&(Yt(t,n),t.addEventListener("transitionend",(()=>this.root.innerHTML=""))),t.style.transform="scaleY(0)",t.style.transitionDelay=e*this.TRANSITION_DELAY+"ms"}return e}const r=[];if(e.forEach(((e,t)=>{const n=Kt(t,e.title);n.addEventListener("click",(()=>{var e;null!==(null===(e=this.renderer.getCommittedState())||void 0===e?void 0:e.decision)&&(this.renderer.ignoreInputs||(this.renderer.ignoreInputs=!0,n.addEventListener("animationend",(()=>{this.renderer.makeDecision(t)})),n.classList.add("vn-decision-item-blink")))})),r.push(n)})),t){for(const[e,t]of r.entries())t.style.transform="scaleY(0)",t.style.transitionDelay=e*this.TRANSITION_DELAY+"ms",this.root.appendChild(t);this.root.offsetHeight;const[e,t]=fn();for(const[e,n]of r.entries())e===r.length-1&&Yt(n,t),n.style.transform="scaleY(1)";return e}this.root.innerHTML="";for(const e of r)this.root.appendChild(e);return Promise.resolve()},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,a)}c((o=o.apply(r,s||[])).next())}))}}const Kt=(e,t)=>{const n=document.createElement("div");return n.classList.add("vn-decision-item"),n.innerText=t,n},Yt=(e,t)=>{const n=()=>{e.removeEventListener("transitionend",n),t()};e.addEventListener("transitionend",n)};class Vt{constructor(){this.assets={}}registerAsset(e){this.assets[e]=null}getAsset(e){const t=this.assets[e];return null==t?t:t.cloneNode()}loadAsset(e){if(void 0!==this.assets[e]&&null!==this.assets[e])return Promise.resolve();const t=new Image;t.src=e;const n=t.decode();return n.then((()=>{this.assets[e]=t})),n}loadAll(){const e=[];for(const t in this.assets)e.push(this.loadAsset(t));return Promise.all(e)}}class Zt{constructor(e,t,n){this.renderer=t,this.assetLoader=n,this.TRANSITION_DURATION="500ms",this.root=document.createElement("div"),this.root.id="vn-sprite-renderer",e.appendChild(this.root),this.sceneWidth=this.root.clientWidth,this.sceneHeight=this.root.clientHeight}render(e,t){var n,r,s,i,o;return r=this,s=void 0,o=function*(){const r=[];for(const s in e){let i=this.getSpriteElem(s);if(null!==i){const o=null===(n=this.renderer.getCommittedState())||void 0===n?void 0:n.animatableState.sprites[s];if(void 0!==o&&e[s]!==o||!t){if((null==o?void 0:o.x)!==e[s].x||(null==o?void 0:o.y)!==e[s].y||(null==o?void 0:o.anchorX)!==e[s].anchorX||(null==o?void 0:o.anchorY)!==e[s].anchorY){if(t)i.style.transitionDuration=this.TRANSITION_DURATION,this.addTransitionEndPromise(r,i);else{i.style.transitionDuration="";const e=i.cloneNode();i.replaceWith(e),i=e}this.setPosition(i,e[s])}if(void 0!==o&&zt(o)!==zt(e[s])){const n=this.assetLoader.getAsset(zt(e[s]));if(!n)throw new Error("Can't render unloaded sprite");n.dataset.vnSpriteId=s,t?(delete i.dataset.vnSpriteId,i.addEventListener("transitionend",(()=>{i.remove()})),i.style.opacity="0",i.style.transitionDuration=this.TRANSITION_DURATION,this.addTransitionEndPromise(r,n),n.style.opacity="0",n.style.transitionDuration=this.TRANSITION_DURATION,this.setPosition(n,o),this.root.appendChild(n),n.offsetHeight,n.style.opacity="1",this.setPosition(n,e[s])):(this.setPosition(n,e[s]),i.replaceWith(n))}}continue}const o=e[s],a=this.assetLoader.getAsset(zt(o));if(!a)throw new Error("Can't render unloaded sprite");a.dataset.vnSpriteId=s,this.setPosition(a,o),this.root.appendChild(a),t&&(this.addTransitionEndPromise(r,a),a.style.opacity="0",a.style.transitionDuration=this.TRANSITION_DURATION,a.offsetHeight,a.style.opacity="1")}const s=[...this.root.children];for(const n of s){const s=n.dataset.vnSpriteId;if(void 0===s||void 0!==s&&void 0===e[s])if(t){const[e,t]=fn();r.push(e),delete n.dataset.vnSpriteId,n.style.transitionDuration=this.TRANSITION_DURATION,n.style.opacity="0",n.addEventListener("transitionend",(()=>{n.remove(),t()}))}else n.remove()}return Promise.all(r)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(o.next(e))}catch(e){t(e)}}function a(e){try{c(o.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,a)}c((o=o.apply(r,s||[])).next())}))}getSpriteElem(e){return this.root.querySelector(`[data-vn-sprite-id=${e}]`)}setPosition(e,t){const n=this.sceneWidth*t.x-e.width*t.anchorX,r=this.sceneHeight*t.y-e.height*t.anchorY,s=`translate(${Math.round(n)}px, ${Math.round(r)}px)`;e.style.transform=s}addTransitionEndPromise(e,t){const[n,r]=fn();e.push(n);const s=()=>{t.removeEventListener("transitionend",s),r()};t.addEventListener("transitionend",s)}}function zt(e){return`sprites/${e.actor}/${e.sprite}`}const Gt={};function Jt(e,t,n){Gt[e]=t,function(e,t){ft[e]=t;const n=Object.keys(ft);gt=gt.extend({transition:ht.enum(n)})}(e,n)}class Ht{constructor(e,t){this.startTime=e,this.duration=t,this.onFinishCallbacks=[],this.finished=!1}render(e,t){let n=(t-this.startTime)/this.duration;return n>=1&&(n=1,this.animationFinished()),this.renderFrame(e,n,t)}onFinish(e){this.onFinishCallbacks.push(e)}animationFinished(){if(!this.finished){this.finished=!0;for(const e of this.onFinishCallbacks)e()}}}class Qt extends Ht{constructor(e,t,n,r,s,i){super(n,r),this.from=e,this.to=t,this.slices=s,this.staggerFactor=i}renderFrame(e,t,n){this.from.render(e,n);const r=e.canvas.width/this.slices;e.save(),e.beginPath();for(let n=0;n<this.slices;n++){const s=pn(0,n/this.slices,this.staggerFactor);let i=(t-s)/(pn(1,(n+1)/this.slices,this.staggerFactor)-s);i>1&&(i=1),i<0&&(i=0);const o=r*i;e.rect(n*r,0,o,e.canvas.height)}e.clip();const s=this.to.render(e,n);return e.restore(),t<1||s}}Jt("blinds",(function(e,t,n,r,s){var i,o;const a=ft.blinds.optional().parse(s),c=null!==(i=null==a?void 0:a.slices)&&void 0!==i?i:16,l=null!==(o=null==a?void 0:a.staggerFactor)&&void 0!==o?o:.5;return new Qt(e,t,n,r,c,l)}),ht.object({slices:ht.number().optional(),staggerFactor:ht.number().optional()}));class Xt extends Ht{constructor(e,t,n,r){super(n,r),this.from=e,this.to=t}renderFrame(e,t,n){e.save(),this.from.render(e,n),e.globalAlpha=t;const r=this.to.render(e,n);return e.restore(),t<1||r}}Jt("fade",(function(e,t,n,r){return new Xt(e,t,n,r)}),ht.undefined());class en{constructor(e,t,n){this.renderer=t,this.assetLoader=n,this.sceneWidth=e.clientWidth,this.sceneHeight=e.clientHeight,this.root=document.createElement("canvas"),this.root.id="vn-background-renderer",this.root.width=this.sceneWidth,this.root.height=this.sceneHeight,this.lastTick=0;const r=this.root.getContext("2d");if(null===r)throw new Error("Counld not create 2d rendering context");this.rootContext=r,this.currentRenderable=new tn(0,0),this.needMoreFrames=!1,e.appendChild(this.root)}render(e,t){var n,r,s,i,o,a,c;return i=this,o=void 0,c=function*(){const i=null===(n=this.renderer.getCommittedState())||void 0===n?void 0:n.animatableState.background;if(e.shouldTransition||e.panTo!==(null==i?void 0:i.panTo)){if(this.lastTick=yield new Promise((e=>{window.requestAnimationFrame((t=>{e(t),window.requestAnimationFrame(this.renderFrame.bind(this))}))})),!t){const t=this.getLastFrame(e);return t.onFinish((()=>this.needMoreFrames=!1)),this.currentRenderable=t,Promise.resolve()}if(e.shouldTransition){const[t,n]=fn(),[r,s]=this.getTransition(e);return r.onFinish((()=>{this.currentRenderable=s})),e.waitForPan?s.onFinish(n):r.onFinish(n),this.currentRenderable=r,t}{let t;if("#"===e.image.charAt(0))t=new rn(e.image,e.panDuration,this.lastTick);else{const n=this.assetLoader.getAsset("backgrounds/"+e.image);if(!n)throw new Error(`Could not load ${e.image}`);const i={x:0,y:0,w:this.sceneWidth,h:this.sceneHeight};t=new nn(n,null!==(r=e.panFrom)&&void 0!==r?r:i,null!==(s=e.panTo)&&void 0!==s?s:i,e.panDuration,this.lastTick)}if(this.currentRenderable=t,e.waitForPan){const[e,n]=fn();return t.onFinish(n),e}return Promise.resolve()}}return Promise.resolve()},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{s(c.next(e))}catch(e){t(e)}}function r(e){try{s(c.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):(s=t.value,s instanceof a?s:new a((function(e){e(s)}))).then(n,r)}s((c=c.apply(i,o||[])).next())}))}renderFrame(e){this.lastTick=e,this.rootContext.clearRect(0,0,this.sceneWidth,this.sceneHeight);try{this.needMoreFrames=this.currentRenderable.render(this.rootContext,e)}catch(e){console.error(e)}this.needMoreFrames&&window.requestAnimationFrame(this.renderFrame.bind(this))}getTransition(e){var t,n;let r;if("#"===e.image.charAt(0))r=new rn(e.image,e.panDuration,this.lastTick);else{const s=this.assetLoader.getAsset("backgrounds/"+e.image);if(!s)throw new Error(`Could not load ${e.image}`);const i={x:0,y:0,w:this.sceneWidth,h:this.sceneHeight},o=null!==(t=e.panFrom)&&void 0!==t?t:i,a=null!==(n=e.panTo)&&void 0!==n?n:i;r=new nn(s,o,a,e.panDuration,this.lastTick)}return[(0,Gt[e.transition])(this.currentRenderable,r,this.lastTick,e.transitonDuration,e.transitionOptions),r]}getLastFrame(e){var t,n;if("#"===e.image.charAt(0))return new rn(e.image,0,this.lastTick);const r=this.assetLoader.getAsset("backgrounds/"+e.image);if(!r)throw new Error(`Could not load ${e.image}`);const s={x:0,y:0,w:this.sceneWidth,h:this.sceneHeight},i=null!==(t=e.panFrom)&&void 0!==t?t:s,o=null!==(n=e.panTo)&&void 0!==n?n:s;return new nn(r,i,o,0,this.lastTick)}}class tn extends Ht{renderFrame(){return!1}}class nn extends Ht{constructor(e,t,n,r,s){super(s,r),this.image=e,this.from=t,this.to=n}renderFrame(e,t){const n=pn(this.from.x,this.to.x,t),r=pn(this.from.y,this.to.y,t),s=pn(this.from.w,this.to.w,t),i=pn(this.from.h,this.to.h,t);return e.drawImage(this.image,n,r,s,i,0,0,e.canvas.width,e.canvas.height),t<1}}class rn extends Ht{constructor(e,t,n){super(n,t),this.color=e}renderFrame(e,t){return e.save(),e.fillStyle=this.color,e.fillRect(0,0,e.canvas.width,e.canvas.height),e.restore(),t<1}}class sn{constructor(){this.assets={}}registerAsset(e){this.assets[e]=null}getAsset(e){const t=this.assets[e];return null==t?t:t.cloneNode()}loadAsset(e){if(void 0!==this.assets[e]&&null!==this.assets[e])return Promise.resolve();const t=new Audio(e);return new Promise((n=>{t.addEventListener("canplaythrough",(()=>{this.assets[e]=t,n()}))}))}loadAll(){const e=[];for(const t in this.assets)e.push(this.loadAsset(t));return Promise.all(e)}}class on{constructor(e,t){this.renderer=e,this.assetLoader=t,this.bgmElem=null}render(e){var t,n,r,s,i;return n=this,r=void 0,i=function*(){const n=null===(t=this.renderer.getCommittedState())||void 0===t?void 0:t.animatableState.audio;if(null!==e.sfx){const t=this.assetLoader.getAsset("audio/"+e.sfx);if(!t)throw new Error("Could not play audio "+e.sfx);t.play()}if(null!=this.bgmElem&&null===e.bgm)this.fadeOut(this.bgmElem),this.bgmElem=null;else if(null===e.bgm||e.bgm===(null==n?void 0:n.bgm)&&null!==this.bgmElem)null!==e.bgm&&null!==this.bgmElem&&e.loopBgm!==(null==n?void 0:n.loopBgm)&&(this.bgmElem.loop=e.loopBgm);else{const t=this.assetLoader.getAsset("audio/"+e.bgm);if(!t)throw new Error("Could not play audio "+e.bgm);let n=!1;null!==this.bgmElem&&(n=!0,this.fadeOut(this.bgmElem).then((()=>{null!==this.bgmElem&&this.fadeIn(this.bgmElem)}))),this.bgmElem=t,this.bgmElem.addEventListener("ended",(()=>{this.bgmElem=null})),this.bgmElem.loop=e.loopBgm,n||this.fadeIn(this.bgmElem)}},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,a)}c((i=i.apply(n,r||[])).next())}))}fadeOut(e){e.dataset.cancelFadeIn="true";const t=e.volume;let n=0;const[r,s]=fn(),i=()=>{let r=n/1500;r>1&&(r=1);const o=pn(t,0,r);e.volume=o,r<1?(n+=20,setTimeout(i,20)):(e.pause(),s())};return setTimeout(i,20),r}fadeIn(e){e.volume=0,e.play();let t=0;const n=()=>{let r=t/1500;r>1&&(r=1);const s=pn(0,1,r);e.volume=s,r<1&&"true"!==e.dataset.cancelFadeIn&&(t+=20,setTimeout(n,20))};setTimeout(n,20)}}function an(e,t){const n=`vn-${e}`,r=JSON.stringify(t);window.localStorage.setItem(n,r)}function cn(e,t){return un(e,t,!0)}function ln(e,t){return un(e,t,!1)}function un(e,t,n){const r=document.createElement("div");r.innerText=n?"Save":"Load",r.classList.add("vn-save-heading"),e.appendChild(r);const s=document.createElement("div");s.classList.add("vn-saves-container");const i=document.createElement("div");if(i.classList.add("vn-pause-menu-item","vn-save-return"),i.innerText="Return",i.addEventListener("click",(()=>{t.showMenu(hn)})),e.appendChild(i),t.getSaves().forEach(((e,r)=>{const i=function(e,t,n,r){const s=document.createElement("div");s.classList.add("vn-pause-menu-item","vn-save-item"),s.innerText=new Date(e.timestamp).toISOString()+"\n"+e.path.join(" "),r?s.addEventListener("click",(e=>{window.confirm("Are you sure you want to overwrite?")&&(n.closeMenu(),n.saveToSlot(t))})):s.addEventListener("click",(e=>{window.confirm("Are you sure you want to load?")&&(n.loadFromSlot(t),n.closeMenu())}));const i=document.createElement("div");return i.innerText="DEL",i.classList.add("vn-save-del"),i.addEventListener("click",(e=>{e.stopPropagation(),window.confirm("Are you sure you want to delete the save?")&&(n.deleteSave(t),n.showMenu(r?cn:ln))})),s.appendChild(i),s}(e,r,t,n);s.appendChild(i)})),n){const e=document.createElement("div");e.classList.add("vn-pause-menu-item","vn-save-item","vn-save-new"),e.innerText="Create new",e.addEventListener("click",(e=>{t.closeMenu(),t.saveToSlot(t.getSaves().length)})),s.appendChild(e)}e.appendChild(s)}function hn(e,t){const n=document.createElement("div");n.classList.add("vn-pause-menu-container"),n.appendChild(dn("Return",(()=>{t.closeMenu()}))),n.appendChild(dn("Save",(()=>{t.showMenu(cn)}))),n.appendChild(dn("Load",(()=>{t.showMenu(ln)}))),e.appendChild(n)}function dn(e,t){const n=document.createElement("div");return n.setAttribute("role","button"),n.classList.add("vn-pause-menu-item"),n.innerText=e,n.addEventListener("click",t),n}const fn=()=>{let e;const t=new Promise((t=>{e=t}));if(void 0===e)throw Error("This shouldn't happen...");return[t,e]};function pn(e,t,n){return e*(1-n)+t*n}n.p;const mn=Symbol.for("yaml.alias"),gn=Symbol.for("yaml.document"),yn=Symbol.for("yaml.map"),vn=Symbol.for("yaml.pair"),bn=Symbol.for("yaml.scalar"),wn=Symbol.for("yaml.seq"),kn=Symbol.for("yaml.node.type"),xn=e=>!!e&&"object"==typeof e&&e[kn]===mn,Sn=e=>!!e&&"object"==typeof e&&e[kn]===gn,En=e=>!!e&&"object"==typeof e&&e[kn]===yn,Nn=e=>!!e&&"object"==typeof e&&e[kn]===vn,Tn=e=>!!e&&"object"==typeof e&&e[kn]===bn,On=e=>!!e&&"object"==typeof e&&e[kn]===wn;function In(e){if(e&&"object"==typeof e)switch(e[kn]){case yn:case wn:return!0}return!1}function An(e){if(e&&"object"==typeof e)switch(e[kn]){case mn:case yn:case bn:case wn:return!0}return!1}class _n{constructor(e){Object.defineProperty(this,kn,{value:e})}}const Ln=Symbol("break visit"),jn=Symbol("skip children"),$n=Symbol("remove node");function Cn(e,t){Sn(e)?Pn(null,e.contents,t,Object.freeze([e]))===$n&&(e.contents=null):Pn(null,e,t,Object.freeze([]))}function Pn(e,t,n,r){let s;if("function"==typeof n?s=n(e,t,r):En(t)?n.Map&&(s=n.Map(e,t,r)):On(t)?n.Seq&&(s=n.Seq(e,t,r)):Nn(t)?n.Pair&&(s=n.Pair(e,t,r)):Tn(t)?n.Scalar&&(s=n.Scalar(e,t,r)):xn(t)&&n.Alias&&(s=n.Alias(e,t,r)),An(s)||Nn(s)){const t=r[r.length-1];if(In(t))t.items[e]=s;else if(Nn(t))"key"===e?t.key=s:t.value=s;else{if(!Sn(t)){const e=xn(t)?"alias":"scalar";throw new Error(`Cannot replace node with ${e} parent`)}t.contents=s}return Pn(e,s,n,r)}if("symbol"!=typeof s)if(In(t)){r=Object.freeze(r.concat(t));for(let e=0;e<t.items.length;++e){const s=Pn(e,t.items[e],n,r);if("number"==typeof s)e=s-1;else{if(s===Ln)return Ln;s===$n&&(t.items.splice(e,1),e-=1)}}}else if(Nn(t)){r=Object.freeze(r.concat(t));const e=Pn("key",t.key,n,r);if(e===Ln)return Ln;e===$n&&(t.key=null);const s=Pn("value",t.value,n,r);if(s===Ln)return Ln;s===$n&&(t.value=null)}return s}Cn.BREAK=Ln,Cn.SKIP=jn,Cn.REMOVE=$n;const Rn={"!":"%21",",":"%2C","[":"%5B","]":"%5D","{":"%7B","}":"%7D"};class Bn{constructor(e,t){this.marker=null,this.yaml=Object.assign({},Bn.defaultYaml,e),this.tags=Object.assign({},Bn.defaultTags,t)}atDocument(){const e=new Bn(this.yaml,this.tags);switch(this.yaml.version){case"1.1":this.atNextDocument=!0;break;case"1.2":this.atNextDocument=!1,this.yaml={explicit:Bn.defaultYaml.explicit,version:"1.2"},this.tags=Object.assign({},Bn.defaultTags)}return e}add(e,t){this.atNextDocument&&(this.yaml={explicit:Bn.defaultYaml.explicit,version:"1.1"},this.tags=Object.assign({},Bn.defaultTags),this.atNextDocument=!1);const n=e.trim().split(/[ \t]+/),r=n.shift();switch(r){case"%TAG":{if(2!==n.length&&(t(0,"%TAG directive should contain exactly two parts"),n.length<2))return!1;const[e,r]=n;return this.tags[e]=r,!0}case"%YAML":{if(this.yaml.explicit=!0,n.length<1)return t(0,"%YAML directive should contain exactly one part"),!1;const[e]=n;return"1.1"===e||"1.2"===e?(this.yaml.version=e,!0):(t(6,`Unsupported YAML version ${e}`,!0),!1)}default:return t(0,`Unknown directive ${r}`,!0),!1}}tagName(e,t){if("!"===e)return"!";if("!"!==e[0])return t(`Not a valid tag: ${e}`),null;if("<"===e[1]){const n=e.slice(2,-1);return"!"===n||"!!"===n?(t(`Verbatim tags aren't resolved, so ${e} is invalid.`),null):(">"!==e[e.length-1]&&t("Verbatim tags must end with a >"),n)}const[,n,r]=e.match(/^(.*!)([^!]*)$/);r||t(`The ${e} tag has no suffix`);const s=this.tags[n];return s?s+decodeURIComponent(r):"!"===n?e:(t(`Could not resolve tag: ${e}`),null)}tagString(e){for(const[t,n]of Object.entries(this.tags))if(e.startsWith(n))return t+e.substring(n.length).replace(/[!,[\]{}]/g,(e=>Rn[e]));return"!"===e[0]?e:`!<${e}>`}toString(e){const t=this.yaml.explicit?[`%YAML ${this.yaml.version||"1.2"}`]:[],n=Object.entries(this.tags);let r;if(e&&n.length>0&&An(e.contents)){const t={};Cn(e.contents,((e,n)=>{An(n)&&n.tag&&(t[n.tag]=!0)})),r=Object.keys(t)}else r=[];for(const[s,i]of n)"!!"===s&&"tag:yaml.org,2002:"===i||e&&!r.some((e=>e.startsWith(i)))||t.push(`%TAG ${s} ${i}`);return t.join("\n")}}function Dn(e,t,n){if(Array.isArray(e))return e.map(((e,t)=>Dn(e,String(t),n)));if(e&&"function"==typeof e.toJSON){if(!n)return e.toJSON(t);const r=n.anchors&&n.anchors.get(e);r&&(n.onCreate=e=>{r.res=e,delete n.onCreate});const s=e.toJSON(t,n);return r&&n.onCreate&&n.onCreate(s),s}return n&&n.keep||"bigint"!=typeof e?e:Number(e)}Bn.defaultYaml={explicit:!1,version:"1.2"},Bn.defaultTags={"!!":"tag:yaml.org,2002:"};class Fn extends _n{constructor(e){super(mn),this.source=e,Object.defineProperty(this,"tag",{set(){throw new Error("Alias nodes cannot have tags")}})}toJSON(e,t){if(!t)return Dn(this.source,"string"==typeof e?e:null,t);const{anchors:n,maxAliasCount:r}=t,s=n&&n.get(this.source);if(!s||void 0===s.res)throw new ReferenceError("This should not happen: Alias anchor was not resolved?");if(r>=0&&(s.count+=1,0===s.aliasCount&&(s.aliasCount=Mn(this.source,n)),s.count*s.aliasCount>r))throw new ReferenceError("Excessive alias count indicates a resource exhaustion attack");return s.res}toString({anchors:e,doc:t,implicitKey:n,inStringifyKey:r},s,i){let o=Object.keys(e).find((t=>e[t]===this.source));if(!o&&r&&(o=t.anchors.getName(this.source)||t.anchors.newName()),o)return`*${o}${n?" ":""}`;const a=t.anchors.getName(this.source)?"Alias node must be after source node":"Source node not found for alias node";throw new Error(`${a} [${this.range}]`)}}function Mn(e,t){if(xn(e)){const n=t&&t.get(e.source);return n?n.count*n.aliasCount:0}if(In(e)){let n=0;for(const r of e.items){const e=Mn(r,t);e>n&&(n=e)}return n}if(Nn(e)){const n=Mn(e.key,t),r=Mn(e.value,t);return Math.max(n,r)}return 1}const qn=e=>!e||"function"!=typeof e&&"object"!=typeof e;class Un extends _n{constructor(e){super(bn),this.value=e}toJSON(e,t){return t&&t.keep?this.value:Dn(this.value,e,t)}toString(){return String(this.value)}}Un.BLOCK_FOLDED="BLOCK_FOLDED",Un.BLOCK_LITERAL="BLOCK_LITERAL",Un.PLAIN="PLAIN",Un.QUOTE_DOUBLE="QUOTE_DOUBLE",Un.QUOTE_SINGLE="QUOTE_SINGLE";const Wn="tag:yaml.org,2002:";function Kn(e,t,n){var r,s;if(An(e))return e;if(Nn(e)){const t=null===(s=(r=n.schema.map).createNode)||void 0===s?void 0:s.call(r,n.schema,null,n);return t.items.push(e),t}(e instanceof String||e instanceof Number||e instanceof Boolean||"function"==typeof BigInt&&e instanceof BigInt)&&(e=e.valueOf());const{onAlias:i,onTagObj:o,prevObjects:a}=n,{map:c,seq:l,tags:u}=n.schema;t&&t.startsWith("!!")&&(t=Wn+t.slice(2));let h=function(e,t,n){if(t){const e=n.filter((e=>e.tag===t)),r=e.find((e=>!e.format))||e[0];if(!r)throw new Error(`Tag ${t} not found`);return r}return n.find((t=>t.identify&&t.identify(e)&&!t.format))}(e,t,u);if(!h){if(e&&"function"==typeof e.toJSON&&(e=e.toJSON()),!e||"object"!=typeof e)return new Un(e);h=e instanceof Map?c:Symbol.iterator in Object(e)?l:c}o&&(o(h),delete n.onTagObj);const d={value:void 0,node:void 0};if(e&&"object"==typeof e){const t=a.get(e);if(t)return i(t);d.value=e,a.set(e,d)}const f=(null==h?void 0:h.createNode)?h.createNode(n.schema,e,n):new Un(e);return t&&(f.tag=t),d.node=f,f}function Yn(e,t,n){return n?n.includes("\n")?`${e}\n`+n.replace(/^/gm,`${t||""}#`):e.endsWith(" ")?`${e}#${n}`:`${e} #${n}`:e}const Vn="flow",Zn="block",zn="quoted";function Gn(e,t,n="flow",{indentAtStart:r,lineWidth:s=80,minContentWidth:i=20,onFold:o,onOverflow:a}={}){if(!s||s<0)return e;const c=Math.max(1+i,1+s-t.length);if(e.length<=c)return e;const l=[],u={};let h,d,f=s-t.length;"number"==typeof r&&(r>s-Math.max(2,i)?l.push(0):f=s-r);let p=!1,m=-1,g=-1,y=-1;n===Zn&&(m=Jn(e,m),-1!==m&&(f=m+c));for(let t;t=e[m+=1];){if(n===zn&&"\\"===t){switch(g=m,e[m+1]){case"x":m+=3;break;case"u":m+=5;break;case"U":m+=9;break;default:m+=1}y=m}if("\n"===t)n===Zn&&(m=Jn(e,m)),f=m+c,h=void 0;else{if(" "===t&&d&&" "!==d&&"\n"!==d&&"\t"!==d){const t=e[m+1];t&&" "!==t&&"\n"!==t&&"\t"!==t&&(h=m)}if(m>=f)if(h)l.push(h),f=h+c,h=void 0;else if(n===zn){for(;" "===d||"\t"===d;)d=t,t=e[m+=1],p=!0;const n=m>y+1?m-2:g-1;if(u[n])return e;l.push(n),u[n]=!0,f=n+c,h=void 0}else p=!0}d=t}if(p&&a&&a(),0===l.length)return e;o&&o();let v=e.slice(0,l[0]);for(let r=0;r<l.length;++r){const s=l[r],i=l[r+1]||e.length;0===s?v=`\n${t}${e.slice(0,i)}`:(n===zn&&u[s]&&(v+=`${e[s]}\\`),v+=`\n${t}${e.slice(s+1,i)}`)}return v}function Jn(e,t){let n=e[t+1];for(;" "===n||"\t"===n;){do{n=e[t+=1]}while(n&&"\n"!==n);n=e[t+1]}return t}const Hn=e=>({indentAtStart:e.indentAtStart,lineWidth:e.options.lineWidth,minContentWidth:e.options.minContentWidth}),Qn=e=>/^(%|---|\.\.\.)/m.test(e);function Xn(e,t){const n=JSON.stringify(e);if(t.options.doubleQuotedAsJSON)return n;const{implicitKey:r}=t,s=t.options.doubleQuotedMinMultiLineLength,i=t.indent||(Qn(e)?"  ":"");let o="",a=0;for(let e=0,t=n[e];t;t=n[++e])if(" "===t&&"\\"===n[e+1]&&"n"===n[e+2]&&(o+=n.slice(a,e)+"\\ ",e+=1,a=e,t="\\"),"\\"===t)switch(n[e+1]){case"u":{o+=n.slice(a,e);const t=n.substr(e+2,4);switch(t){case"0000":o+="\\0";break;case"0007":o+="\\a";break;case"000b":o+="\\v";break;case"001b":o+="\\e";break;case"0085":o+="\\N";break;case"00a0":o+="\\_";break;case"2028":o+="\\L";break;case"2029":o+="\\P";break;default:"00"===t.substr(0,2)?o+="\\x"+t.substr(2):o+=n.substr(e,6)}e+=5,a=e+1}break;case"n":if(r||'"'===n[e+2]||n.length<s)e+=1;else{for(o+=n.slice(a,e)+"\n\n";"\\"===n[e+2]&&"n"===n[e+3]&&'"'!==n[e+4];)o+="\n",e+=2;o+=i," "===n[e+2]&&(o+="\\"),e+=1,a=e+1}break;default:e+=1}return o=a?o+n.slice(a):n,r?o:Gn(o,i,zn,Hn(t))}function er(e,t){if(t.implicitKey){if(/\n/.test(e))return Xn(e,t)}else if(/[ \t]\n|\n[ \t]/.test(e))return Xn(e,t);const n=t.indent||(Qn(e)?"  ":""),r="'"+e.replace(/'/g,"''").replace(/\n+/g,`$&\n${n}`)+"'";return t.implicitKey?r:Gn(r,n,Vn,Hn(t))}function tr({comment:e,type:t,value:n},r,s,i){if(/\n[\t ]+$/.test(n)||/^\s*$/.test(n))return Xn(n,r);const o=r.indent||(r.forceBlockIndent||Qn(n)?"  ":""),a=o?"2":"1",c=t!==Un.BLOCK_FOLDED&&(t===Un.BLOCK_LITERAL||!function(e,t,n){if(!t||t<0)return!1;const r=t-n,s=e.length;if(s<=r)return!1;for(let t=0,n=0;t<s;++t)if("\n"===e[t]){if(t-n>r)return!0;if(n=t+1,s-n<=r)return!1}return!0}(n,r.options.lineWidth,o.length));let l=c?"|":">";if(!n)return l+"\n";let u="",h="";if(n=n.replace(/[\n\t ]*$/,(e=>{const t=e.indexOf("\n");return-1===t?l+="-":n!==e&&t===e.length-1||(l+="+",i&&i()),h=e.replace(/\n$/,""),""})).replace(/^[\n ]*/,(e=>{-1!==e.indexOf(" ")&&(l+=a);const t=e.match(/ +$/);return t?(u=e.slice(0,-t[0].length),t[0]):(u=e,"")})),h&&(h=h.replace(/\n+(?!\n|$)/g,`$&${o}`)),u&&(u=u.replace(/\n+/g,`$&${o}`)),e&&(l+=" #"+e.replace(/ ?[\r\n]+/g," "),s&&s()),!n)return`${l}${a}\n${o}${h}`;if(c)return n=n.replace(/\n+/g,`$&${o}`),`${l}\n${o}${u}${n}${h}`;n=n.replace(/\n+/g,"\n$&").replace(/(?:^|\n)([\t ].*)(?:([\n\t ]*)\n(?![\n\t ]))?/g,"$1$2").replace(/\n+/g,`$&${o}`);const d=Gn(`${u}${n}${h}`,o,Zn,Hn(r));return`${l}\n${o}${d}`}function nr(e,t,n,r){const{implicitKey:s,inFlow:i}=t,o="string"==typeof e.value?e:Object.assign({},e,{value:String(e.value)});let{type:a}=e;a!==Un.QUOTE_DOUBLE&&/[\x00-\x08\x0b-\x1f\x7f-\x9f\u{D800}-\u{DFFF}]/u.test(o.value)&&(a=Un.QUOTE_DOUBLE);const c=e=>{switch(e){case Un.BLOCK_FOLDED:case Un.BLOCK_LITERAL:return s||i?Xn(o.value,t):tr(o,t,n,r);case Un.QUOTE_DOUBLE:return Xn(o.value,t);case Un.QUOTE_SINGLE:return er(o.value,t);case Un.PLAIN:return function(e,t,n,r){var s;const{comment:i,type:o,value:a}=e,{actualString:c,implicitKey:l,indent:u,inFlow:h}=t;if(l&&/[\n[\]{},]/.test(a)||h&&/[[\]{},]/.test(a))return Xn(a,t);if(!a||/^[\n\t ,[\]{}#&*!|>'"%@`]|^[?-]$|^[?-][ \t]|[\n:][ \t]|[ \t]\n|[\n\t ]#|[\n\t :]$/.test(a)){const s=-1!==a.indexOf('"'),i=-1!==a.indexOf("'");let o;return o=s&&!i?er:i&&!s?Xn:t.options.singleQuote?er:Xn,l||h||-1===a.indexOf("\n")?o(a,t):tr(e,t,n,r)}if(!l&&!h&&o!==Un.PLAIN&&-1!==a.indexOf("\n"))return tr(e,t,n,r);if(""===u&&Qn(a))return t.forceBlockIndent=!0,tr(e,t,n,r);const d=a.replace(/\n+/g,`$&\n${u}`);if(c)for(const e of t.doc.schema.tags)if(e.default&&"tag:yaml.org,2002:str"!==e.tag&&(null===(s=e.test)||void 0===s?void 0:s.test(d)))return Xn(a,t);const f=l?d:Gn(d,u,Vn,Hn(t));return!i||h||-1===f.indexOf("\n")&&-1===i.indexOf("\n")?f:(n&&n(),function(e,t,n){return n?`#${n.replace(/[\s\S]^/gm,`$&${t}#`)}\n${t}${e}`:e}(f,u,i))}(o,t,n,r);default:return null}};let l=c(a);if(null===l){const{defaultKeyType:e,defaultStringType:n}=t.options,r=s&&e||n;if(l=c(r),null===l)throw new Error(`Unsupported default string type ${r}`)}return l}const rr=(e,t)=>({anchors:Object.create(null),doc:e,indent:"",indentStep:"number"==typeof t.indent?" ".repeat(t.indent):"  ",options:Object.assign({defaultKeyType:null,defaultStringType:"PLAIN",directives:null,doubleQuotedAsJSON:!1,doubleQuotedMinMultiLineLength:40,falseStr:"false",indentSeq:!0,lineWidth:80,minContentWidth:20,nullStr:"null",simpleKeys:!1,singleQuote:!1,trueStr:"true"},t)});function sr(e,t,n,r){if(Nn(e))return e.toString(t,n,r);if(xn(e))return e.toString(t);let s;const i=An(e)?e:t.doc.createNode(e,{onTagObj:e=>s=e});s||(s=function(e,t){if(t.tag){const n=e.filter((e=>e.tag===t.tag));if(n.length>0)return n.find((e=>e.format===t.format))||n[0]}let n,r;if(Tn(t)){r=t.value;const s=e.filter((e=>e.identify&&e.identify(r)));n=s.find((e=>e.format===t.format))||s.find((e=>!e.format))}else r=t,n=e.find((e=>e.nodeClass&&r instanceof e.nodeClass));if(!n){const e=r&&r.constructor?r.constructor.name:typeof r;throw new Error(`Tag not resolved for ${e} value`)}return n}(t.doc.schema.tags,i));const o=function(e,t,{anchors:n,doc:r}){const s=[],i=r.anchors.getName(e);return i&&(n[i]=e,s.push(`&${i}`)),e.tag?s.push(r.directives.tagString(e.tag)):t.default||s.push(r.directives.tagString(t.tag)),s.join(" ")}(i,s,t);o.length>0&&(t.indentAtStart=(t.indentAtStart||0)+o.length+1);const a="function"==typeof s.stringify?s.stringify(i,t,n,r):Tn(i)?nr(i,t,n,r):i.toString(t,n,r);return o?Tn(i)||"{"===a[0]||"["===a[0]?`${o} ${a}`:`${o}\n${t.indent}${a}`:a}function ir(e,t,n){let r=n;for(let e=t.length-1;e>=0;--e){const n=t[e];if("number"==typeof n&&Number.isInteger(n)&&n>=0){const e=[];e[n]=r,r=e}else{const e={};Object.defineProperty(e,"symbol"==typeof n?n:String(n),{value:r,writable:!0,enumerable:!0,configurable:!0}),r=e}}return Kn(r,void 0,{onAlias(){throw new Error("Repeated objects are not supported here")},prevObjects:new Map,schema:e})}const or=e=>null==e||"object"==typeof e&&!!e[Symbol.iterator]().next().done;class ar extends _n{constructor(e,t){super(e),Object.defineProperty(this,"schema",{value:t,configurable:!0,enumerable:!1,writable:!0})}addIn(e,t){if(or(e))this.add(t);else{const[n,...r]=e,s=this.get(n,!0);if(In(s))s.addIn(r,t);else{if(void 0!==s||!this.schema)throw new Error(`Expected YAML collection at ${n}. Remaining path: ${r}`);this.set(n,ir(this.schema,r,t))}}}deleteIn([e,...t]){if(0===t.length)return this.delete(e);const n=this.get(e,!0);if(In(n))return n.deleteIn(t);throw new Error(`Expected YAML collection at ${e}. Remaining path: ${t}`)}getIn([e,...t],n){const r=this.get(e,!0);return 0===t.length?!n&&Tn(r)?r.value:r:In(r)?r.getIn(t,n):void 0}hasAllNullValues(e){return this.items.every((t=>{if(!t||An(t))return!1;const n=t.value;return null==n||e&&Tn(n)&&null==n.value&&!n.commentBefore&&!n.comment&&!n.tag}))}hasIn([e,...t]){if(0===t.length)return this.has(e);const n=this.get(e,!0);return!!In(n)&&n.hasIn(t)}setIn([e,...t],n){if(0===t.length)this.set(e,n);else{const r=this.get(e,!0);if(In(r))r.setIn(t,n);else{if(void 0!==r||!this.schema)throw new Error(`Expected YAML collection at ${e}. Remaining path: ${t}`);this.set(e,ir(this.schema,t,n))}}}_toString(e,{blockItem:t,flowChars:n,itemIndent:r},s,i){const{indent:o,indentStep:a}=e,c=this.flow||e.inFlow;c&&(r+=a),e=Object.assign({},e,{indent:r,inFlow:c,type:null});let l=!1,u=!1;const h=this.items.reduce(((t,n,s)=>{let i=null;if(An(n)||Nn(n)){if(!l&&n.spaceBefore&&t.push({type:"comment",str:""}),n.commentBefore)for(const e of n.commentBefore.match(/^.*$/gm))t.push({type:"comment",str:`#${e}`});n.comment&&(i=n.comment);const e=n;c&&(!l&&n.spaceBefore||n.commentBefore||n.comment||e.key&&(e.key.commentBefore||e.key.comment)||e.value&&(e.value.commentBefore||e.value.comment))&&(u=!0)}l=!1;let o=sr(n,e,(()=>i=null),(()=>l=!0));return c&&!u&&o.includes("\n")&&(u=!0),c&&s<this.items.length-1&&(o+=","),o=Yn(o,r,i),l&&(i||c)&&(l=!1),t.push({type:"item",str:o}),t}),[]);let d;if(0===h.length)d=n.start+n.end;else if(c){const{start:e,end:t}=n,r=h.map((e=>e.str));if(u||r.reduce(((e,t)=>e+t.length+2),2)>ar.maxFlowStringSingleLineLength){d=e;for(const e of r)d+=e?`\n${a}${o}${e}`:"\n";d+=`\n${o}${t}`}else d=`${e} ${r.join(" ")} ${t}`}else{const e=h.map(t);d=e.shift()||"";for(const t of e)d+=t?`\n${o}${t}`:"\n"}return this.comment?(d+="\n"+this.comment.replace(/^/gm,`${o}#`),s&&s()):l&&i&&i(),d}}function cr(e,t,n){const r=Kn(e,void 0,n),s=Kn(t,void 0,n);return new ur(r,s)}function lr(e,t,n){if(!xn(n)||!En(n.source))throw new Error("Merge sources must be map aliases");const r=n.source.toJSON(null,e,Map);for(const[e,n]of r)t instanceof Map?t.has(e)||t.set(e,n):t instanceof Set?t.add(e):Object.prototype.hasOwnProperty.call(t,e)||Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0});return t}ar.maxFlowStringSingleLineLength=60;class ur extends _n{constructor(e,t=null){super(vn),this.key=e,this.value=t}get commentBefore(){return An(this.key)?this.key.commentBefore:void 0}set commentBefore(e){if(null==this.key&&(this.key=new Un(null)),!An(this.key))throw new Error("Pair.commentBefore is an alias for Pair.key.commentBefore. To set it, the key must be a Node.");this.key.commentBefore=e}get spaceBefore(){return An(this.key)?this.key.spaceBefore:void 0}set spaceBefore(e){if(null==this.key&&(this.key=new Un(null)),!An(this.key))throw new Error("Pair.spaceBefore is an alias for Pair.key.spaceBefore. To set it, the key must be a Node.");this.key.spaceBefore=e}addToJSMap(e,t){if(e&&e.doc.schema.merge&&((n=this.key)===ur.MERGE_KEY||Tn(n)&&n.value===ur.MERGE_KEY&&(!n.type||n.type===Un.PLAIN)))if(On(this.value))for(const n of this.value.items)lr(e,t,n);else if(Array.isArray(this.value))for(const n of this.value)lr(e,t,n);else lr(e,t,this.value);else{const n=Dn(this.key,"",e);if(t instanceof Map){const r=Dn(this.value,n,e);t.set(n,r)}else if(t instanceof Set)t.add(n);else{const r=function(e,t,n){if(null===t)return"";if("object"!=typeof t)return String(t);if(An(e)&&n&&n.doc){const t=rr(n.doc,{});t.inFlow=!0,t.inStringifyKey=!0;const i=e.toString(t);if(!n.mapKeyWarned){let e=JSON.stringify(i);e.length>40&&(e=e.substring(0,36)+'..."'),s=`Keys with collection values will be stringified due to JS Object restrictions: ${e}. Set mapAsMap: true to use object keys.`,"debug"!==(r=n.doc.options.logLevel)&&"warn"!==r||("undefined"!=typeof process&&process.emitWarning?process.emitWarning(s):console.warn(s)),n.mapKeyWarned=!0}return i}var r,s;return JSON.stringify(t)}(this.key,n,e),s=Dn(this.value,r,e);r in t?Object.defineProperty(t,r,{value:s,writable:!0,enumerable:!0,configurable:!0}):t[r]=s}}var n;return t}toJSON(e,t){const n=t&&t.mapAsMap?new Map:{};return this.addToJSMap(t,n)}toString(e,t,n){if(!e||!e.doc)return JSON.stringify(this);const{allNullValues:r,doc:s,indent:i,indentStep:o,options:{indentSeq:a,simpleKeys:c}}=e;let{key:l,value:u}=this,h=An(l)&&l.comment||null;if(c){if(h)throw new Error("With simple keys, key nodes cannot have comments");if(In(l))throw new Error("With simple keys, collection cannot be used as a key value")}let d=!c&&(!l||h&&null==u||In(l)||(Tn(l)?l.type===Un.BLOCK_FOLDED||l.type===Un.BLOCK_LITERAL:"object"==typeof l));e=Object.assign({},e,{allNullValues:!1,implicitKey:!d&&(c||!r),indent:i+o});let f=!1,p=sr(l,e,(()=>h=null),(()=>f=!0));if(!d&&!e.inFlow&&p.length>1024){if(c)throw new Error("With simple keys, single line scalar must not span more than 1024 characters");d=!0}if(r&&(!c||e.inFlow)||null==u&&(d||e.inFlow))return p=Yn(p,e.indent,h),this.comment?(h&&!this.comment.includes("\n")?p+=`\n${e.indent||""}#${this.comment}`:p=Yn(p,e.indent,this.comment),t&&t()):f&&!h&&n&&n(),e.inFlow&&!d?p:`? ${p}`;p=d?`? ${Yn(p,e.indent,h)}\n${i}:`:Yn(`${p}:`,e.indent,h),this.comment&&(!h||d||this.comment.includes("\n")?p=Yn(p,e.indent,this.comment):p+=`\n${e.indent||""}#${this.comment}`,t&&t());let m="",g=null;An(u)?(u.spaceBefore&&(m="\n"),u.commentBefore&&(m+=`\n${u.commentBefore.replace(/^/gm,`${e.indent}#`)}`),g=u.comment):u&&"object"==typeof u&&(u=s.createNode(u)),e.implicitKey=!1,d||h||this.comment||!Tn(u)||(e.indentAtStart=p.length+1),f=!1,a||!(o.length>=2)||e.inFlow||d||!On(u)||u.flow||u.tag||s.anchors.getName(u)||(e.indent=e.indent.substr(2));const y=sr(u,e,(()=>g=null),(()=>f=!0));let v=" ";return m||h||this.comment?v=`${m}\n${e.indent}`:!d&&In(u)?("["===y[0]||"{"===y[0])&&!y.includes("\n")||(v=`\n${e.indent}`):"\n"===y[0]&&(v=""),f&&!g&&n&&n(),Yn(p+v+y,e.indent,g)}}ur.MERGE_KEY="<<";const hr={anchorPrefix:"a",intAsBigInt:!1,keepUndefined:!1,logLevel:"warn",prettyErrors:!0,strict:!0,version:"1.2"};class dr extends ar{constructor(e){super(wn,e),this.items=[]}static get tagName(){return"tag:yaml.org,2002:seq"}add(e){this.items.push(e)}delete(e){const t=fr(e);return"number"==typeof t&&this.items.splice(t,1).length>0}get(e,t){const n=fr(e);if("number"!=typeof n)return;const r=this.items[n];return!t&&Tn(r)?r.value:r}has(e){const t=fr(e);return"number"==typeof t&&t<this.items.length}set(e,t){const n=fr(e);if("number"!=typeof n)throw new Error(`Expected a valid index, not ${e}.`);const r=this.items[n];Tn(r)&&qn(t)?r.value=t:this.items[n]=t}toJSON(e,t){const n=[];t&&t.onCreate&&t.onCreate(n);let r=0;for(const e of this.items)n.push(Dn(e,String(r++),t));return n}toString(e,t,n){return e?super._toString(e,{blockItem:e=>"comment"===e.type?e.str:`- ${e.str}`,flowChars:{start:"[",end:"]"},itemIndent:(e.indent||"")+"  "},t,n):JSON.stringify(this)}}function fr(e){let t=Tn(e)?e.value:e;return t&&"string"==typeof t&&(t=Number(t)),"number"==typeof t&&Number.isInteger(t)&&t>=0?t:null}class pr{constructor(e){this.map=Object.create(null),this.prefix=e}createAlias(e,t){return this.setAnchor(e,t),new Fn(e)}createMergePair(...e){const t=new Un(ur.MERGE_KEY),n=e.map((e=>{if(xn(e)){if(En(e.source))return e}else if(En(e))return this.createAlias(e);throw new Error("Merge sources must be Map nodes or their Aliases")}));if(1===n.length)return new ur(t,n[0]);const r=new dr;return r.items=n,new ur(t,r)}getName(e){return Object.keys(this.map).find((t=>this.map[t]===e))}getNames(){return Object.keys(this.map)}getNode(e){return this.map[e]}newName(e){e||(e=this.prefix);const t=Object.keys(this.map);for(let n=1;;++n){const r=`${e}${n}`;if(!t.includes(r))return r}}setAnchor(e,t){const{map:n}=this;if(!e)return t?(delete n[t],t):null;if(!Tn(e)&&!In(e))throw new Error("Anchors may only be set for Scalar, Seq and Map nodes");if(t){if(/[\x00-\x19\s,[\]{}]/.test(t))throw new Error("Anchor names must not contain whitespace or control characters");const r=n[t];r&&r!==e&&(n[this.newName(t)]=r)}const r=Object.keys(n).find((t=>n[t]===e));if(r){if(!t||r===t)return r;delete n[r]}else t||(t=this.newName());return n[t]=e,t}}function mr({format:e,minFractionDigits:t,tag:n,value:r}){if("bigint"==typeof r)return String(r);const s="number"==typeof r?r:Number(r);if(!isFinite(s))return isNaN(s)?".nan":s<0?"-.inf":".inf";let i=JSON.stringify(r);if(!e&&t&&(!n||"tag:yaml.org,2002:float"===n)&&/^\d/.test(i)){let e=i.indexOf(".");e<0&&(e=i.length,i+=".");let n=t-(i.length-e-1);for(;n-- >0;)i+="0"}return i}function gr(e,t){const n=Tn(t)?t.value:t;for(const r of e)if(Nn(r)){if(r.key===t||r.key===n)return r;if(Tn(r.key)&&r.key.value===n)return r}}class yr extends ar{constructor(e){super(yn,e),this.items=[]}static get tagName(){return"tag:yaml.org,2002:map"}add(e,t){let n;n=Nn(e)?e:new ur(e&&"object"==typeof e&&"key"in e?e.key:e,e.value);const r=gr(this.items,n.key),s=this.schema&&this.schema.sortMapEntries;if(r){if(!t)throw new Error(`Key ${n.key} already set`);Tn(r.value)&&qn(n.value)?r.value.value=n.value:r.value=n.value}else if(s){const e=this.items.findIndex((e=>s(n,e)<0));-1===e?this.items.push(n):this.items.splice(e,0,n)}else this.items.push(n)}delete(e){const t=gr(this.items,e);return!!t&&this.items.splice(this.items.indexOf(t),1).length>0}get(e,t){const n=gr(this.items,e),r=n&&n.value;return!t&&Tn(r)?r.value:r}has(e){return!!gr(this.items,e)}set(e,t){this.add(new ur(e,t),!0)}toJSON(e,t,n){const r=n?new n:t&&t.mapAsMap?new Map:{};t&&t.onCreate&&t.onCreate(r);for(const e of this.items)e.addToJSMap(t,r);return r}toString(e,t,n){if(!e)return JSON.stringify(this);for(const e of this.items)if(!Nn(e))throw new Error(`Map items must all be pairs; found ${JSON.stringify(e)} instead`);return!e.allNullValues&&this.hasAllNullValues(!1)&&(e=Object.assign({},e,{allNullValues:!0})),super._toString(e,{blockItem:e=>e.str,flowChars:{start:"{",end:"}"},itemIndent:e.indent||""},t,n)}}const vr={collection:"map",createNode:function(e,t,n){const{keepUndefined:r,replacer:s}=n,i=new yr(e),o=(e,o)=>{if("function"==typeof s)o=s.call(t,e,o);else if(Array.isArray(s)&&!s.includes(e))return;(void 0!==o||r)&&i.items.push(cr(e,o,n))};if(t instanceof Map)for(const[e,n]of t)o(e,n);else if(t&&"object"==typeof t)for(const e of Object.keys(t))o(e,t[e]);return"function"==typeof e.sortMapEntries&&i.items.sort(e.sortMapEntries),i},default:!0,nodeClass:yr,tag:"tag:yaml.org,2002:map",resolve:(e,t)=>(En(e)||t("Expected a mapping for this tag"),e)},br={collection:"seq",createNode:function(e,t,n){const{replacer:r}=n,s=new dr(e);if(t&&Symbol.iterator in Object(t)){let e=0;for(let i of t){if("function"==typeof r){const n=t instanceof Set?i:String(e++);i=r.call(t,n,i)}s.items.push(Kn(i,void 0,n))}}return s},default:!0,nodeClass:dr,tag:"tag:yaml.org,2002:seq",resolve:(e,t)=>(On(e)||t("Expected a sequence for this tag"),e)},wr=[vr,br,{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:(e,t,n,r)=>nr(e,t=Object.assign({actualString:!0},t),n,r)}],kr=e=>"bigint"==typeof e||Number.isInteger(e),xr=(e,t,n,{intAsBigInt:r})=>r?BigInt(e):parseInt(e.substring(t),n);function Sr(e,t,n){const{value:r}=e;return kr(r)&&r>=0?n+r.toString(t):mr(e)}const Er={identify:e=>null==e,createNode:()=>new Un(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Un(null),stringify:({source:e},t)=>e&&Er.test.test(e)?e:t.options.nullStr},Nr={identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:[Tt]rue|TRUE|[Ff]alse|FALSE)$/,resolve:e=>new Un("t"===e[0]||"T"===e[0]),stringify:({source:e,value:t},n)=>e&&Nr.test.test(e)&&t===("t"===e[0]||"T"===e[0])?e:t?n.options.trueStr:n.options.falseStr},Tr={identify:e=>kr(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^0o[0-7]+$/,resolve:(e,t,n)=>xr(e,2,8,n),stringify:e=>Sr(e,8,"0o")},Or={identify:kr,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9]+$/,resolve:(e,t,n)=>xr(e,0,10,n),stringify:mr},Ir={identify:e=>kr(e)&&e>=0,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^0x[0-9a-fA-F]+$/,resolve:(e,t,n)=>xr(e,2,16,n),stringify:e=>Sr(e,16,"0x")},Ar={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^(?:[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN))$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:mr},_r={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:\.[0-9]+|[0-9]+(?:\.[0-9]*)?)[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e),stringify:({value:e})=>Number(e).toExponential()},Lr={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:\.[0-9]+|[0-9]+\.[0-9]*)$/,resolve(e){const t=new Un(parseFloat(e)),n=e.indexOf(".");return-1!==n&&"0"===e[e.length-1]&&(t.minFractionDigits=e.length-n-1),t},stringify:mr},jr=wr.concat([Er,Nr,Tr,Or,Ir,Ar,_r,Lr]);function $r(e){return"bigint"==typeof e||Number.isInteger(e)}const Cr=({value:e})=>JSON.stringify(e),Pr=[vr,br].concat([{identify:e=>"string"==typeof e,default:!0,tag:"tag:yaml.org,2002:str",resolve:e=>e,stringify:Cr},{identify:e=>null==e,createNode:()=>new Un(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^null$/,resolve:()=>null,stringify:Cr},{identify:e=>"boolean"==typeof e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^true|false$/,resolve:e=>"true"===e,stringify:Cr},{identify:$r,default:!0,tag:"tag:yaml.org,2002:int",test:/^-?(?:0|[1-9][0-9]*)$/,resolve:(e,t,{intAsBigInt:n})=>n?BigInt(e):parseInt(e,10),stringify:({value:e})=>$r(e)?e.toString():JSON.stringify(e)},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^-?(?:0|[1-9][0-9]*)(?:\.[0-9]*)?(?:[eE][-+]?[0-9]+)?$/,resolve:e=>parseFloat(e),stringify:Cr}],{default:!0,tag:"",test:/^/,resolve:(e,t)=>(t(`Unresolved plain scalar ${JSON.stringify(e)}`),e)}),Rr={identify:e=>e instanceof Uint8Array,default:!1,tag:"tag:yaml.org,2002:binary",resolve(e,t){if("function"==typeof Buffer)return Buffer.from(e,"base64");if("function"==typeof atob){const t=atob(e.replace(/[\n\r]/g,"")),n=new Uint8Array(t.length);for(let e=0;e<t.length;++e)n[e]=t.charCodeAt(e);return n}return t("This environment does not support reading binary tags; either Buffer or atob is required"),e},stringify({comment:e,type:t,value:n},r,s,i){const o=n;let a;if("function"==typeof Buffer)a=o instanceof Buffer?o.toString("base64"):Buffer.from(o.buffer).toString("base64");else{if("function"!=typeof btoa)throw new Error("This environment does not support writing binary tags; either Buffer or btoa is required");{let e="";for(let t=0;t<o.length;++t)e+=String.fromCharCode(o[t]);a=btoa(e)}}if(t||(t=Un.BLOCK_LITERAL),t!==Un.QUOTE_DOUBLE){const e=Math.max(r.options.lineWidth-r.indent.length,r.options.minContentWidth),n=Math.ceil(a.length/e),s=new Array(n);for(let t=0,r=0;t<n;++t,r+=e)s[t]=a.substr(r,e);a=s.join(t===Un.BLOCK_LITERAL?"\n":" ")}return nr({comment:e,type:t,value:a},r,s,i)}};function Br(e,t){if(On(e))for(let n=0;n<e.items.length;++n){let r=e.items[n];if(!Nn(r)){if(En(r)){r.items.length>1&&t("Each pair must have its own sequence indicator");const e=r.items[0]||new ur(null);r.commentBefore&&(e.commentBefore=e.commentBefore?`${r.commentBefore}\n${e.commentBefore}`:r.commentBefore),r.comment&&(e.comment=e.comment?`${r.comment}\n${e.comment}`:r.comment),r=e}e.items[n]=Nn(r)?r:new ur(r)}}else t("Expected a sequence for this tag");return e}function Dr(e,t,n){const{replacer:r}=n,s=new dr(e);s.tag="tag:yaml.org,2002:pairs";let i=0;if(t&&Symbol.iterator in Object(t))for(let e of t){let o,a;if("function"==typeof r&&(e=r.call(t,String(i++),e)),Array.isArray(e)){if(2!==e.length)throw new TypeError(`Expected [key, value] tuple: ${e}`);o=e[0],a=e[1]}else if(e&&e instanceof Object){const t=Object.keys(e);if(1!==t.length)throw new TypeError(`Expected { key: value } tuple: ${e}`);o=t[0],a=e[o]}else o=e;s.items.push(cr(o,a,n))}return s}const Fr={collection:"seq",default:!1,tag:"tag:yaml.org,2002:pairs",resolve:Br,createNode:Dr};class Mr extends dr{constructor(){super(),this.add=yr.prototype.add.bind(this),this.delete=yr.prototype.delete.bind(this),this.get=yr.prototype.get.bind(this),this.has=yr.prototype.has.bind(this),this.set=yr.prototype.set.bind(this),this.tag=Mr.tag}toJSON(e,t){if(!t)return super.toJSON(e);const n=new Map;t&&t.onCreate&&t.onCreate(n);for(const e of this.items){let r,s;if(Nn(e)?(r=Dn(e.key,"",t),s=Dn(e.value,r,t)):r=Dn(e,"",t),n.has(r))throw new Error("Ordered maps must not include duplicate keys");n.set(r,s)}return n}}Mr.tag="tag:yaml.org,2002:omap";const qr={collection:"seq",identify:e=>e instanceof Map,nodeClass:Mr,default:!1,tag:"tag:yaml.org,2002:omap",resolve(e,t){const n=Br(e,t),r=[];for(const{key:e}of n.items)Tn(e)&&(r.includes(e.value)?t(`Ordered maps must not include duplicate keys: ${e.value}`):r.push(e.value));return Object.assign(new Mr,n)},createNode(e,t,n){const r=Dr(e,t,n),s=new Mr;return s.items=r.items,s}};class Ur extends yr{constructor(e){super(e),this.tag=Ur.tag}add(e){let t;t=Nn(e)?e:"object"==typeof e&&"key"in e&&"value"in e&&null===e.value?new ur(e.key,null):new ur(e,null),gr(this.items,t.key)||this.items.push(t)}get(e,t){const n=gr(this.items,e);return!t&&Nn(n)?Tn(n.key)?n.key.value:n.key:n}set(e,t){if("boolean"!=typeof t)throw new Error("Expected boolean value for set(key, value) in a YAML set, not "+typeof t);const n=gr(this.items,e);n&&!t?this.items.splice(this.items.indexOf(n),1):!n&&t&&this.items.push(new ur(e))}toJSON(e,t){return super.toJSON(e,t,Set)}toString(e,t,n){if(!e)return JSON.stringify(this);if(this.hasAllNullValues(!0))return super.toString(Object.assign({},e,{allNullValues:!0}),t,n);throw new Error("Set items must all have null values")}}Ur.tag="tag:yaml.org,2002:set";const Wr={collection:"map",identify:e=>e instanceof Set,nodeClass:Ur,default:!1,tag:"tag:yaml.org,2002:set",resolve(e,t){if(En(e)){if(e.hasAllNullValues(!0))return Object.assign(new Ur,e);t("Set items must all have null values")}else t("Expected a mapping for this tag");return e},createNode(e,t,n){const{replacer:r}=n,s=new Ur(e);if(t&&Symbol.iterator in Object(t))for(let e of t)"function"==typeof r&&(e=r.call(t,e,e)),s.items.push(cr(e,null,n));return s}};function Kr(e,t){const n=e[0],r="-"===n||"+"===n?e.substring(1):e,s=e=>t?BigInt(e):Number(e),i=r.replace(/_/g,"").split(":").reduce(((e,t)=>e*s(60)+s(t)),s(0));return"-"===n?s(-1)*i:i}function Yr(e){let{value:t}=e,n=e=>e;if("bigint"==typeof t)n=e=>BigInt(e);else if(isNaN(t)||!isFinite(t))return mr(e);let r="";t<0&&(r="-",t*=n(-1));const s=n(60),i=[t%s];return t<60?i.unshift(0):(t=(t-i[0])/s,i.unshift(t%s),t>=60&&(t=(t-i[0])/s,i.unshift(t))),r+i.map((e=>e<10?"0"+String(e):String(e))).join(":").replace(/000000\d*$/,"")}const Vr={identify:e=>"bigint"==typeof e||Number.isInteger(e),default:!0,tag:"tag:yaml.org,2002:int",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+$/,resolve:(e,t,{intAsBigInt:n})=>Kr(e,n),stringify:Yr},Zr={identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"TIME",test:/^[-+]?[0-9][0-9_]*(?::[0-5]?[0-9])+\.[0-9_]*$/,resolve:e=>Kr(e,!1),stringify:Yr},zr={identify:e=>e instanceof Date,default:!0,tag:"tag:yaml.org,2002:timestamp",test:RegExp("^([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})(?:(?:t|T|[ \\t]+)([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2}(\\.[0-9]+)?)(?:[ \\t]*(Z|[-+][012]?[0-9](?::[0-9]{2})?))?)?$"),resolve(e){const t=e.match(zr.test);if(!t)throw new Error("!!timestamp expects a date, starting with yyyy-mm-dd");const[,n,r,s,i,o,a]=t.map(Number),c=t[7]?Number((t[7]+"00").substr(1,3)):0;let l=Date.UTC(n,r-1,s,i||0,o||0,a||0,c);const u=t[8];if(u&&"Z"!==u){let e=Kr(u,!1);Math.abs(e)<30&&(e*=60),l-=6e4*e}return new Date(l)},stringify:({value:e})=>e.toISOString().replace(/((T00:00)?:00)?\.000Z$/,"")},Gr={identify:e=>null==e,createNode:()=>new Un(null),default:!0,tag:"tag:yaml.org,2002:null",test:/^(?:~|[Nn]ull|NULL)?$/,resolve:()=>new Un(null),stringify:({source:e},t)=>e&&Gr.test.test(e)?e:t.options.nullStr};function Jr({value:e,source:t},n){return t&&(e?Hr:Qr).test.test(t)?t:e?n.options.trueStr:n.options.falseStr}const Hr={identify:e=>!0===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:Y|y|[Yy]es|YES|[Tt]rue|TRUE|[Oo]n|ON)$/,resolve:()=>new Un(!0),stringify:Jr},Qr={identify:e=>!1===e,default:!0,tag:"tag:yaml.org,2002:bool",test:/^(?:N|n|[Nn]o|NO|[Ff]alse|FALSE|[Oo]ff|OFF)$/i,resolve:()=>new Un(!1),stringify:Jr},Xr=e=>"bigint"==typeof e||Number.isInteger(e);function es(e,t,n,{intAsBigInt:r}){const s=e[0];if("-"!==s&&"+"!==s||(t+=1),e=e.substring(t).replace(/_/g,""),r){switch(n){case 2:e=`0b${e}`;break;case 8:e=`0o${e}`;break;case 16:e=`0x${e}`}const t=BigInt(e);return"-"===s?BigInt(-1)*t:t}const i=parseInt(e,n);return"-"===s?-1*i:i}function ts(e,t,n){const{value:r}=e;if(Xr(r)){const e=r.toString(t);return r<0?"-"+n+e.substr(1):n+e}return mr(e)}const ns=wr.concat([Gr,Hr,Qr,{identify:Xr,default:!0,tag:"tag:yaml.org,2002:int",format:"BIN",test:/^[-+]?0b[0-1_]+$/,resolve:(e,t,n)=>es(e,2,2,n),stringify:e=>ts(e,2,"0b")},{identify:Xr,default:!0,tag:"tag:yaml.org,2002:int",format:"OCT",test:/^[-+]?0[0-7_]+$/,resolve:(e,t,n)=>es(e,1,8,n),stringify:e=>ts(e,8,"0")},{identify:Xr,default:!0,tag:"tag:yaml.org,2002:int",test:/^[-+]?[0-9][0-9_]*$/,resolve:(e,t,n)=>es(e,0,10,n),stringify:mr},{identify:Xr,default:!0,tag:"tag:yaml.org,2002:int",format:"HEX",test:/^[-+]?0x[0-9a-fA-F_]+$/,resolve:(e,t,n)=>es(e,2,16,n),stringify:e=>ts(e,16,"0x")},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?\.(?:inf|Inf|INF|nan|NaN|NAN)$/,resolve:e=>"nan"===e.slice(-3).toLowerCase()?NaN:"-"===e[0]?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,stringify:mr},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",format:"EXP",test:/^[-+]?(?:[0-9][0-9_]*)?(?:\.[0-9_]*)?[eE][-+]?[0-9]+$/,resolve:e=>parseFloat(e.replace(/_/g,"")),stringify:({value:e})=>Number(e).toExponential()},{identify:e=>"number"==typeof e,default:!0,tag:"tag:yaml.org,2002:float",test:/^[-+]?(?:[0-9][0-9_]*)?\.[0-9_]*$/,resolve(e){const t=new Un(parseFloat(e.replace(/_/g,""))),n=e.indexOf(".");if(-1!==n){const r=e.substring(n+1).replace(/_/g,"");"0"===r[r.length-1]&&(t.minFractionDigits=r.length)}return t},stringify:mr}],Rr,qr,Fr,Wr,Vr,Zr,zr),rs={core:jr,failsafe:wr,json:Pr,yaml11:ns},ss={binary:Rr,bool:Nr,float:Lr,floatExp:_r,floatNaN:Ar,floatTime:Zr,int:Or,intHex:Ir,intOct:Tr,intTime:Vr,map:vr,null:Er,omap:qr,pairs:Fr,seq:br,set:Wr,timestamp:zr},is=(e,t)=>e.key<t.key?-1:e.key>t.key?1:0,os={"tag:yaml.org,2002:binary":ss.binary,"tag:yaml.org,2002:omap":ss.omap,"tag:yaml.org,2002:pairs":ss.pairs,"tag:yaml.org,2002:set":ss.set,"tag:yaml.org,2002:timestamp":ss.timestamp};class as{constructor({customTags:e,merge:t,resolveKnownTags:n,schema:r,sortMapEntries:s}){this.map=ss.map,this.seq=ss.seq,this.merge=!!t,this.name=r||"core",this.knownTags=n?os:{},this.tags=function(e,t,n,r){let s=e[r.replace(/\W/g,"")];if(!s){const t=Object.keys(e).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown schema "${r}"; use one of ${t}`)}if(Array.isArray(n))for(const e of n)s=s.concat(e);else"function"==typeof n&&(s=n(s.slice()));return s.map((e=>{if("string"!=typeof e)return e;const n=t[e];if(n)return n;const r=Object.keys(t).map((e=>JSON.stringify(e))).join(", ");throw new Error(`Unknown custom tag "${e}"; use one of ${r}`)}))}(rs,ss,e,this.name),this.sortMapEntries=!0===s?is:s||null}}function cs(e,t,n,r){if(r&&"object"==typeof r)if(Array.isArray(r))for(let t=0,n=r.length;t<n;++t){const n=r[t],s=cs(e,r,String(t),n);void 0===s?delete r[t]:s!==n&&(r[t]=s)}else if(r instanceof Map)for(const t of Array.from(r.keys())){const n=r.get(t),s=cs(e,r,t,n);void 0===s?r.delete(t):s!==n&&r.set(t,s)}else if(r instanceof Set)for(const t of Array.from(r)){const n=cs(e,r,t,t);void 0===n?r.delete(t):n!==t&&(r.delete(t),r.add(n))}else for(const[t,n]of Object.entries(r)){const s=cs(e,r,t,n);void 0===s?delete r[t]:s!==n&&(r[t]=s)}return e.call(t,n,r)}class ls{constructor(e,t,n){let r;this.commentBefore=null,this.comment=null,this.errors=[],this.warnings=[],Object.defineProperty(this,kn,{value:gn}),"function"==typeof t||Array.isArray(t)?r=t:void 0===n&&t&&(n=t,t=void 0);const s=Object.assign({},hr,n);this.options=s,this.anchors=new pr(this.options.anchorPrefix);let{version:i}=s;(null==n?void 0:n.directives)?(this.directives=n.directives.atDocument(),this.directives.yaml.explicit&&(i=this.directives.yaml.version)):this.directives=new Bn({version:i}),this.setSchema(i,n),this.contents=void 0===e?null:this.createNode(e,{replacer:r})}add(e){us(this.contents)&&this.contents.add(e)}addIn(e,t){us(this.contents)&&this.contents.addIn(e,t)}createNode(e,{flow:t,keepUndefined:n,onTagObj:r,replacer:s,tag:i}={}){if("function"==typeof s)e=s.call({"":e},"",e);else if(Array.isArray(s)){const e=e=>"number"==typeof e||e instanceof String||e instanceof Number,t=s.filter(e).map(String);t.length>0&&(s=s.concat(t))}"boolean"!=typeof n&&(n=!!this.options.keepUndefined);const o=[],a=Kn(e,i,{keepUndefined:n,onAlias(e){const t=new Fn(e);return o.push(t),t},onTagObj:r,prevObjects:new Map,replacer:s,schema:this.schema});for(const e of o){e.source=e.source.node;let t=this.anchors.getName(e.source);t||(t=this.anchors.newName(),this.anchors.map[t]=e.source)}return t&&In(a)&&(a.flow=!0),a}createPair(e,t,n={}){const r=this.createNode(e,n),s=this.createNode(t,n);return new ur(r,s)}delete(e){return!!us(this.contents)&&this.contents.delete(e)}deleteIn(e){return or(e)?null!=this.contents&&(this.contents=null,!0):!!us(this.contents)&&this.contents.deleteIn(e)}get(e,t){return In(this.contents)?this.contents.get(e,t):void 0}getIn(e,t){return or(e)?!t&&Tn(this.contents)?this.contents.value:this.contents:In(this.contents)?this.contents.getIn(e,t):void 0}has(e){return!!In(this.contents)&&this.contents.has(e)}hasIn(e){return or(e)?void 0!==this.contents:!!In(this.contents)&&this.contents.hasIn(e)}set(e,t){null==this.contents?this.contents=ir(this.schema,[e],t):us(this.contents)&&this.contents.set(e,t)}setIn(e,t){or(e)?this.contents=t:null==this.contents?this.contents=ir(this.schema,Array.from(e),t):us(this.contents)&&this.contents.setIn(e,t)}setSchema(e,t){let n;switch(String(e)){case"1.1":this.directives.yaml.version="1.1",n=Object.assign({merge:!0,resolveKnownTags:!1,schema:"yaml-1.1"},t);break;case"1.2":this.directives.yaml.version="1.2",n=Object.assign({merge:!1,resolveKnownTags:!0,schema:"core"},t);break;default:{const t=JSON.stringify(e);throw new Error(`Expected '1.1' or '1.2' as version, but found: ${t}`)}}this.schema=new as(n)}toJS({json:e,jsonArg:t,mapAsMap:n,maxAliasCount:r,onAnchor:s,reviver:i}={}){const o=Object.values(this.anchors.map).map((e=>[e,{alias:[],aliasCount:0,count:1}])),a=o.length>0?new Map(o):null,c={anchors:a,doc:this,keep:!e,mapAsMap:!0===n,mapKeyWarned:!1,maxAliasCount:"number"==typeof r?r:100,stringify:sr},l=Dn(this.contents,t||"",c);if("function"==typeof s&&a)for(const{count:e,res:t}of a.values())s(t,e);return"function"==typeof i?cs(i,{"":l},"",l):l}toJSON(e,t){return this.toJS({json:!0,jsonArg:e,mapAsMap:!1,onAnchor:t})}toString(e={}){if(this.errors.length>0)throw new Error("Document with errors cannot be stringified");if("indent"in e&&(!Number.isInteger(e.indent)||Number(e.indent)<=0)){const t=JSON.stringify(e.indent);throw new Error(`"indent" option must be a positive integer, not ${t}`)}const t=[];let n=!0===e.directives;if(!1!==e.directives){const e=this.directives.toString(this);e?(t.push(e),n=!0):this.directives.marker&&(n=!0)}n&&t.push("---"),this.commentBefore&&(1!==t.length&&t.unshift(""),t.unshift(this.commentBefore.replace(/^/gm,"#")));const r=rr(this,e);let s=!1,i=null;if(this.contents){An(this.contents)&&(this.contents.spaceBefore&&n&&t.push(""),this.contents.commentBefore&&t.push(this.contents.commentBefore.replace(/^/gm,"#")),r.forceBlockIndent=!!this.comment,i=this.contents.comment);const e=i?void 0:()=>s=!0;let o=sr(this.contents,r,(()=>i=null),e);i&&(o=Yn(o,"",i)),"|"!==o[0]&&">"!==o[0]||"---"!==t[t.length-1]?t.push(o):t[t.length-1]=`--- ${o}`}else t.push(sr(this.contents,r));return this.comment&&(s&&!i||""===t[t.length-1]||t.push(""),t.push(this.comment.replace(/^/gm,"#"))),t.join("\n")+"\n"}}function us(e){if(In(e))return!0;throw new Error("Expected a YAML collection as document contents")}class hs extends Error{constructor(e,t,n){if(!n)throw new Error(`Invalid arguments for new ${e}`);super(),this.name=e,this.message=n,this.offset=t}}class ds extends hs{constructor(e,t){super("YAMLParseError",e,t)}}class fs extends hs{constructor(e,t){super("YAMLWarning",e,t)}}function ps(e,t,n,r,s,i){let o=0,a=!1,c=n,l=n,u="",h=!1,d=!1,f="",p="",m="",g=null,y=null;for(const n of t){switch(n.type){case"space":c&&"doc-start"!==r&&"\t"===n.source[0]&&i(s+o,"Tabs are not allowed as indentation"),l=!0;break;case"comment":{e.options.strict&&!l&&i(s+o,"Comments must be separated from other tokens by white space characters");const t=n.source.substring(1);h?u+=f+t:u=t,h=!0,f="";break}case"newline":c&&!h&&(a=!0),c=!0,d=!0,l=!0,f+=n.source;break;case"anchor":p&&i(s+o,"A node can have at most one anchor"),p=n.source.substring(1),null===y&&(y=s+o),c=!1,l=!1;break;case"tag":{m&&i(s+o,"A node can have at most one tag");const t=e.directives.tagName(n.source,(e=>i(s,e)));t&&(m=t),null===y&&(y=s+o),c=!1,l=!1;break}case r:g={indent:n.indent,offset:s+o},c=!1,l=!1;break;default:i(s+o,`Unexpected ${n.type} token`),c=!1,l=!1}n.source&&(o+=n.source.length)}return{found:g,spaceBefore:a,comment:u,hasNewline:d,anchor:p,tagName:m,length:o,start:null!=y?y:s+o}}function ms(e){if(!e)return null;switch(e.type){case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":return e.source.includes("\n");case"flow-collection":for(const t of e.items)switch(t.type){case"newline":return!0;case"alias":case"scalar":case"double-quoted-scalar":case"single-quoted-scalar":case"flow-collection":if(ms(t))return!0}return!1;default:return!0}}const gs="All mapping items must start at the same column";function ys(e,t,n,r){let s="";if(e){let i=!1,o=!1,a="";for(const{source:c,type:l}of e){switch(l){case"space":i=!0;break;case"comment":{n&&!i&&r(t,"Comments must be separated from other tokens by white space characters");const e=c.substring(1);o?s+=a+e:s=e,o=!0,a="";break}case"newline":o&&(a+=c),i=!0;break;default:r(t,`Unexpected ${l} at node end`)}t+=c.length}}return{comment:s,offset:t}}function vs(e){const t=e.split(/[ \t]*\r?\n[ \t]*/);let n=t[0],r=" ";for(let e=1;e<t.length-1;++e){const s=t[e];""===s?"\n"===r?n+=r:r="\n":(n+=r+s,r=" ")}return t.length>1&&(n+=r+t[t.length-1]),n}function bs(e,t){let n="",r=e[t+1];for(;!(" "!==r&&"\t"!==r&&"\n"!==r&&"\r"!==r||"\r"===r&&"\n"!==e[t+2]);)"\n"===r&&(n+="\n"),r=e[(t+=1)+1];return n||(n=" "),{fold:n,offset:t}}const ws={0:"\0",a:"",b:"\b",e:"",f:"\f",n:"\n",r:"\r",t:"\t",v:"\v",N:"",_:" ",L:"\u2028",P:"\u2029"," ":" ",'"':'"',"/":"/","\\":"\\","\t":"\t"};function ks(e,t,n,r){const s=e.substr(t,n),i=s.length===n&&/^[0-9a-fA-F]+$/.test(s)?parseInt(s,16):NaN;if(isNaN(i)){const s=e.substr(t-2,n+2);return r(t-2,`Invalid escape sequence ${s}`),s}return String.fromCodePoint(i)}function xs(e,t,n,r,s){const{offset:i}=t,{value:o,type:a,comment:c,length:l}="block-scalar"===t.type?function(e,t,n){const r=function({offset:e,props:t},n,r){if("block-scalar-header"!==t[0].type)return r(e,"Block scalar header not found"),null;const{source:s}=t[0],i=s[0];let o=0,a="",c=-1;for(let t=1;t<s.length;++t){const n=s[t];if(a||"-"!==n&&"+"!==n){const r=Number(n);!o&&r?o=r:-1===c&&(c=e+t)}else a=n}-1!==c&&r(c,`Block scalar header includes extra characters: ${s}`);let l=!1,u="",h=s.length;for(let s=1;s<t.length;++s){const i=t[s];switch(i.type){case"space":l=!0;case"newline":h+=i.source.length;break;case"comment":n&&!l&&r(e+h,"Comments must be separated from other tokens by white space characters"),h+=i.source.length,u=i.source.substring(1);break;case"error":r(e+h,i.message),h+=i.source.length;break;default:{r(e+h,`Unexpected token in block scalar header: ${i.type}`);const t=i.source;t&&"string"==typeof t&&(h+=t.length)}}}return{mode:i,indent:o,chomp:a,comment:u,length:h}}(e,t,n);if(!r)return{value:"",type:null,comment:"",length:0};const s=">"===r.mode?Un.BLOCK_FOLDED:Un.BLOCK_LITERAL,i=e.source?function(e){const t=e.split(/\n( *)/),n=t[0],r=n.match(/^( *)/),s=[r&&r[1]?[r[1],n.slice(r[1].length)]:["",n]];for(let e=1;e<t.length;e+=2)s.push([t[e],t[e+1]]);return s}(e.source):[];let o=i.length;for(let e=i.length-1;e>=0;--e){const t=i[e][1];if(""!==t&&"\r"!==t)break;o=e}if(!e.source||0===o){const t="+"===r.chomp?i.map((e=>e[0])).join("\n"):"";let n=r.length;return e.source&&(n+=e.source.length),{value:t,type:s,comment:r.comment,length:n}}let a=e.indent+r.indent,c=e.offset+r.length,l=0;for(let e=0;e<o;++e){const[t,s]=i[e];if(""!==s&&"\r"!==s){if(t.length<a){const e="Block scalars with more-indented leading empty lines must use an explicit indentation indicator";n(c+t.length,e)}0===r.indent&&(a=t.length),l=e;break}0===r.indent&&t.length>a&&(a=t.length),c+=t.length+s.length+1}let u="",h="",d=!1;for(let e=0;e<l;++e)u+=i[e][0].slice(a)+"\n";for(let e=l;e<o;++e){let[t,o]=i[e];c+=t.length+o.length+1;const l="\r"===o[o.length-1];if(l&&(o=o.slice(0,-1)),o&&t.length<a){const e="Block scalar lines must not be less indented than their "+(r.indent?"explicit indentation indicator":"first line");n(c-o.length-(l?2:1),e),t=""}s===Un.BLOCK_LITERAL?(u+=h+t.slice(a)+o,h="\n"):t.length>a||"\t"===o[0]?(" "===h?h="\n":d||"\n"!==h||(h="\n\n"),u+=h+t.slice(a)+o,h="\n",d=!0):""===o?"\n"===h?u+="\n":h="\n":(u+=h+o,h=" ",d=!1)}switch(r.chomp){case"-":break;case"+":for(let e=o;e<i.length;++e)u+="\n"+i[e][0].slice(a);"\n"!==u[u.length-1]&&(u+="\n");break;default:u+="\n"}return{value:u,type:s,comment:r.comment,length:r.length+e.source.length}}(t,e.options.strict,s):function({offset:e,type:t,source:n,end:r},s,i){let o,a;const c=(t,n)=>i(e+t,n);switch(t){case"scalar":o=Un.PLAIN,a=function(e,t){switch(e[0]){case"\t":t(0,"Plain value cannot start with a tab character");break;case"|":case">":t(0,`Plain value cannot start with block scalar indicator ${e[0]}`);break;case"@":case"`":t(0,`Plain value cannot start with reserved character ${e[0]}`)}return vs(e.trim())}(n,c);break;case"single-quoted-scalar":o=Un.QUOTE_SINGLE,a=function(e,t){return"'"===e[e.length-1]&&1!==e.length||t(e.length,"Missing closing 'quote"),vs(e.slice(1,-1)).replace(/''/g,"'")}(n,c);break;case"double-quoted-scalar":o=Un.QUOTE_DOUBLE,a=function(e,t){let n="";for(let r=1;r<e.length-1;++r){const s=e[r];if("\r"!==s||"\n"!==e[r+1])if("\n"===s){const{fold:t,offset:s}=bs(e,r);n+=t,r=s}else if("\\"===s){let s=e[++r];const i=ws[s];if(i)n+=i;else if("\n"===s)for(s=e[r+1];" "===s||"\t"===s;)s=e[1+ ++r];else if("x"===s||"u"===s||"U"===s){const i={x:2,u:4,U:8}[s];n+=ks(e,r+1,i,t),r+=i}else{const s=e.substr(r-1,2);t(r-1,`Invalid escape sequence ${s}`),n+=s}}else if(" "===s||"\t"===s){const t=r;let i=e[r+1];for(;" "===i||"\t"===i;)i=e[1+ ++r];"\n"!==i&&(n+=r>t?e.slice(t,r+1):s)}else n+=s}return'"'===e[e.length-1]&&1!==e.length||t(e.length,'Missing closing "quote'),n}(n,c);break;default:return i(e,`Expected a flow scalar value, but found: ${t}`),{value:"",type:null,comment:"",length:n.length}}const l=ys(r,0,s,c);return{value:a,type:o,comment:l.comment,length:n.length+l.offset}}(t,e.options.strict,s),u=r?function(e,t,n,r){var s;if("!"===n)return Ss(e);const i=[];for(const t of e.tags)if(!t.collection&&t.tag===n){if(!t.default||!t.test)return t;i.push(t)}for(const e of i)if(null===(s=e.test)||void 0===s?void 0:s.test(t))return e;const o=e.knownTags[n];return o&&!o.collection?(e.tags.push(Object.assign({},o,{default:!1,test:void 0})),o):(r(0,`Unresolved tag: ${n}`,"tag:yaml.org,2002:str"!==n),Ss(e))}(e.schema,o,r,s):function(e,t,n){var r;if(n)for(const n of e.tags)if(n.default&&(null===(r=n.test)||void 0===r?void 0:r.test(t)))return n;return Ss(e)}(e.schema,o,"scalar"===t.type);let h;try{const t=u?u.resolve(o,(e=>s(i,e)),e.options):o;h=Tn(t)?t:new Un(t)}catch(e){s(i,e.message),h=new Un(o)}return h.range=[i,i+l],h.source=o,a&&(h.type=a),r&&(h.tag=r),(null==u?void 0:u.format)&&(h.format=u.format),c&&(h.comment=c),n&&e.anchors.setAnchor(h,n),h}const Ss=e=>e.tags.find((e=>!e.collection&&"tag:yaml.org,2002:str"===e.tag));function Es(e,t,n){if(t){null===n&&(n=t.length);for(let r=n-1;r>=0;--r){let n=t[r];switch(n.type){case"space":case"comment":case"newline":e-=n.source.length;continue}for(n=t[++r];"space"===(null==n?void 0:n.type);)e+=n.source.length,n=t[++r];break}}return e}const Ns={composeNode:Ts,composeEmptyNode:Os};function Ts(e,t,n,r){const{spaceBefore:s,comment:i,anchor:o,tagName:a}=n;let c;switch(t.type){case"alias":c=function(e,{offset:t,source:n,end:r},s){const i=n.substring(1),o=e.anchors.getNode(i);o||s(t,`Aliased anchor not found: ${i}`);const a=new Fn(o),c=ys(r,t+n.length,e.options.strict,s);return a.range=[t,c.offset],c.comment&&(a.comment=c.comment),a}(e,t,r),(o||a)&&r(t.offset,"An alias node must not specify any properties");break;case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"block-scalar":c=xs(e,t,o,a,r);break;case"block-map":case"block-seq":case"flow-collection":c=function(e,t,n,r,s,i){let o;switch(n.type){case"block-map":o=function({composeNode:e,composeEmptyNode:t},n,{indent:r,items:s,offset:i},o,a){var c;const l=i,u=new yr(n.schema);o&&n.anchors.setAnchor(u,o);for(const{start:o,key:l,sep:h,value:d}of s){const s=ps(n,o,!0,"explicit-key-ind",i,a),f=!s.found;if(f){if(l&&("block-seq"===l.type?a(i,"A block sequence may not be used as an implicit map key"):"indent"in l&&l.indent!==r&&a(i,gs)),!s.anchor&&!s.tagName&&!h){s.comment&&(u.comment?u.comment+="\n"+s.comment:u.comment=s.comment);continue}}else(null===(c=s.found)||void 0===c?void 0:c.indent)!==r&&a(i,gs);i+=s.length,f&&ms(l)&&a(i,"Implicit keys need to be on a single line");const p=i,m=l?e(n,l,s,a):t(n,i,o,null,s,a);i=m.range[1];const g=ps(n,h||[],!l||"block-scalar"===l.type,"map-value-ind",i,a);if(i+=g.length,g.found){f&&("block-map"!==(null==d?void 0:d.type)||g.hasNewline||a(i,"Nested mappings are not allowed in compact mappings"),n.options.strict&&s.start<g.found.offset-1024&&a(i,"The : indicator must be at most 1024 chars after the start of an implicit block mapping key"));const r=d?e(n,d,g,a):t(n,i,h,null,g,a);i=r.range[1],u.items.push(new ur(m,r))}else f&&a(p,"Implicit map keys need to be followed by map values"),g.comment&&(m.comment?m.comment+="\n"+g.comment:m.comment=g.comment),u.items.push(new ur(m))}return u.range=[l,i],u}(e,t,n,r,i);break;case"block-seq":o=function({composeNode:e,composeEmptyNode:t},n,{items:r,offset:s},i,o){const a=s,c=new dr(n.schema);i&&n.anchors.setAnchor(c,i);for(const{start:i,value:a}of r){const r=ps(n,i,!0,"seq-item-ind",s,o);if(s+=r.length,!r.found){if(!(r.anchor||r.tagName||a)){r.comment&&(c.comment=r.comment);continue}o(s,a&&"block-seq"===a.type?"All sequence items must start at the same column":"Sequence item without - indicator")}const l=a?e(n,a,r,o):t(n,s,i,null,r,o);s=l.range[1],c.items.push(l)}return c.range=[a,s],c}(e,t,n,r,i);break;case"flow-collection":o=function({composeNode:e,composeEmptyNode:t},n,r,s,i){const o="{"===r.start.source,a=o?new yr(n.schema):new dr(n.schema);a.flow=!0,s&&n.anchors.setAnchor(a,s);let c=null,l=null,u=!1,h="",d=!1,f=!1,p="",m="",g="",y=r.offset+1,v=!1,b=!1,w=!1,k=!1,x=null;function S(){const e={spaceBefore:u,comment:h,anchor:m,tagName:g};return u=!1,h="",f=!1,p="",m="",g="",e}function E(e){if(l?f&&(l.comment=h):l=t(n,y,r.items,e,S(),i),o||b)a.items.push(c?new ur(c,l):new ur(l));else{const e=a;if(c){const t=new yr(n.schema);t.flow=!0,t.items.push(new ur(c,l)),e.items.push(t)}else e.items.push(l)}}for(let s=0;s<r.items.length;++s){const N=r.items[s];let T=!0;switch(N.type){case"space":d=!0;break;case"comment":{n.options.strict&&!d&&i(y,"Comments must be separated from other tokens by white space characters");const e=N.source.substring(1);f?h+=p+e:h=e,v=!1,f=!0,p="";break}case"newline":if(v&&!f&&(u=!0),w){if(f){let e=a.items[a.items.length-1];Nn(e)&&(e=e.value||e.key),An(e)?e.comment=h:i(y,"Error adding trailing comment to node"),h="",f=!1}w=!1}else p+=N.source,o||c||!l||(k=!0);v=!0,d=!0;break;case"anchor":m&&i(y,"A node can have at most one anchor"),m=N.source.substring(1),v=!1,w=!1,d=!1;break;case"tag":{g&&i(y,"A node can have at most one tag");const e=n.directives.tagName(N.source,(e=>i(y,e)));e&&(g=e),v=!1,w=!1,d=!1;break}case"explicit-key-ind":(m||g)&&i(y,"Anchors and tags must be after the ? indicator"),b=!0,v=!1,w=!1,d=!1;break;case"map-value-ind":if(c){if(l){i(y,"Missing {} around pair used as mapping key");const e=new yr(n.schema);e.flow=!0,e.items.push(new ur(c,l)),e.range=[c.range[0],l.range[1]],c=e,l=null}}else if(l){if(n.options.strict){const e="Implicit keys of flow sequence pairs need to be on a single line";if(k)i(y,e);else if(x){ms(x)&&i(y,e);const t="offset"in x&&x.offset;"number"==typeof t&&t<y-1024&&i(y,"The : indicator must be at most 1024 chars after the start of an implicit flow sequence key"),x=null}}c=l,l=null}else c=t(n,y,r.items,s,S(),i);f&&(c.comment=h,h="",f=!1),b=!1,w=!1,d=!1;break;case"comma":c||l||m||g||b?E(s):i(y,"Unexpected , in flow "+(o?"map":"sequence")),c=null,l=null,b=!1,w=!0,d=!1,k=!1,x=null;break;case"block-map":case"block-seq":i(y,"Block collections are not allowed within flow collections");default:l&&i(y,"Missing , between flow collection items"),o||c||b||(x=N),l=e(n,N,S(),i),y=l.range[1],v=!1,T=!1,w=!1,d=!1}T&&(y+=N.source.length)}(c||l||m||g||b)&&E(r.items.length);const N=o?"}":"]",[T,...O]=r.end;if(T&&T.source===N||i(y,`Expected flow ${o?"map":"sequence"} to end with ${N}`),T&&(y+=T.source.length),O.length>0){const e=ys(O,y,n.options.strict,i);e.comment&&(a.comment=h),y=e.offset}return a.range=[r.offset,y],a}(e,t,n,r,i)}if(!s)return o;const a=o.constructor;if("!"===s||s===a.tagName)return o.tag=a.tagName,o;const c=En(o)?"map":"seq";let l=t.schema.tags.find((e=>e.collection===c&&e.tag===s));if(!l){const e=t.schema.knownTags[s];if(!e||e.collection!==c)return i(o.range[0],`Unresolved tag: ${s}`,!0),o.tag=s,o;t.schema.tags.push(Object.assign({},e,{default:!1})),l=e}const u=l.resolve(o,(e=>i(o.range[0],e)),t.options),h=An(u)?u:new Un(u);return h.range=o.range,h.tag=s,(null==l?void 0:l.format)&&(h.format=l.format),h}(Ns,e,t,o,a,r);break;default:throw console.log(t),new Error(`Unsupporten token type: ${t.type}`)}return s&&(c.spaceBefore=!0),i&&("scalar"===t.type&&""===t.source?c.comment=i:c.commentBefore=i),c}function Os(e,t,n,r,{spaceBefore:s,comment:i,anchor:o,tagName:a},c){const l=xs(e,{type:"scalar",offset:Es(t,n,r),indent:-1,source:""},o,a,c);return s&&(l.spaceBefore=!0),i&&(l.comment=i),l}function Is(e){let t="",n=!1,r=!1;for(let s=0;s<e.length;++s){const i=e[s];switch(i[0]){case"#":t+=(""===t?"":r?"\n\n":"\n")+i.substring(1),n=!0,r=!1;break;case"%":"#"!==e[s+1][0]&&(s+=1),n=!1;break;default:n||(r=!0),n=!1}}return{comment:t,afterEmptyLine:r}}class As{constructor(e,t={}){this.doc=null,this.atDirectives=!1,this.prelude=[],this.errors=[],this.warnings=[],this.onError=(e,t,n)=>{n?this.warnings.push(new fs(e,t)):this.errors.push(new ds(e,t))},this.next=e=>{switch(e.type){case"directive":this.directives.add(e.source,this.onError),this.prelude.push(e.source),this.atDirectives=!0;break;case"document":{const t=function(e,t,{offset:n,start:r,value:s,end:i},o){const a=Object.assign({directives:t},e),c=new ls(void 0,a),l=ps(c,r,!0,"doc-start",n,o);l.found&&(c.directives.marker=!0),c.contents=s?Ts(c,s,l,o):Os(c,n+l.length,r,null,l,o);const u=ys(i,c.contents.range[1],!1,o);return u.comment&&(c.comment=u.comment),c.range=[n,u.offset],c}(this.options,this.directives,e,this.onError);this.decorate(t,!1),this.doc&&this.onDocument(this.doc),this.doc=t,this.atDirectives=!1;break}case"byte-order-mark":case"space":break;case"comment":case"newline":this.prelude.push(e.source);break;case"error":{const t=e.source?`${e.message}: ${JSON.stringify(e.source)}`:e.message,n=new ds(-1,t);this.atDirectives||!this.doc?this.errors.push(n):this.doc.errors.push(n);break}case"doc-end":{if(!this.doc){const t="Unexpected doc-end without preceding document";this.errors.push(new ds(e.offset,t));break}const t=ys(e.end,e.offset+e.source.length,this.doc.options.strict,this.onError);if(this.decorate(this.doc,!0),t.comment){const e=this.doc.comment;this.doc.comment=e?`${e}\n${t.comment}`:t.comment}this.doc.range[1]=t.offset;break}default:this.errors.push(new ds(-1,`Unsupported token ${e.type}`))}},this.directives=new Bn({version:(null==t?void 0:t.version)||hr.version}),this.onDocument=e,this.options=t}decorate(e,t){const{comment:n,afterEmptyLine:r}=Is(this.prelude);if(n){const s=e.contents;if(t)e.comment=e.comment?`${e.comment}\n${n}`:n;else if(r||e.directives.marker||!s)e.commentBefore=n;else if(In(s)&&!s.flow&&s.items.length>0){const e=s.items[0],t=e.commentBefore;e.commentBefore=t?`${n}\n${t}`:n}else{const e=s.commentBefore;s.commentBefore=e?`${n}\n${e}`:n}}t?(Array.prototype.push.apply(e.errors,this.errors),Array.prototype.push.apply(e.warnings,this.warnings)):(e.errors=this.errors,e.warnings=this.warnings),this.prelude=[],this.errors=[],this.warnings=[]}streamInfo(){return{comment:Is(this.prelude).comment,directives:this.directives,errors:this.errors,warnings:this.warnings}}end(e=!1,t=-1){if(this.doc)this.decorate(this.doc,!0),this.onDocument(this.doc),this.doc=null;else if(e){const e=Object.assign({directives:this.directives},this.options),n=new ls(void 0,e);this.atDirectives&&this.onError(t,"Missing directives-end indicator line"),n.range=[0,t],this.decorate(n,!1),this.onDocument(n)}}}class _s{constructor(){this.lineStarts=[],this.addNewLine=e=>this.lineStarts.push(e),this.linePos=e=>{let t=0,n=this.lineStarts.length;for(;t<n;){const r=t+n>>1;this.lineStarts[r]<e?t=r+1:n=r}return this.lineStarts[t]===e?{line:t+1,col:1}:0===t?{line:0,col:e}:{line:t,col:e-this.lineStarts[t-1]+1}}}}function Ls(e){switch(e){case void 0:case" ":case"\n":case"\r":case"\t":return!0;default:return!1}}const js=[",","[","]","{","}"],$s=[" ",",","[","]","{","}","\n","\r","\t"],Cs=e=>!e||$s.includes(e);class Ps{constructor(e){this.atEnd=!1,this.blockScalarIndent=-1,this.blockScalarKeep=!1,this.buffer="",this.flowKey=!1,this.flowLevel=0,this.indentNext=0,this.indentValue=0,this.next=null,this.pos=0,this.push=e}lex(e,t){e&&(this.buffer=this.buffer?this.buffer+e:e),this.atEnd=!t;let n=this.next||"stream";for(;n&&(t||this.hasChars(1));)n=this.parseNext(n)}atLineEnd(){let e=this.pos,t=this.buffer[e];for(;" "===t||"\t"===t;)t=this.buffer[++e];return!t||"#"===t||"\n"===t||"\r"===t&&"\n"===this.buffer[e+1]}charAt(e){return this.buffer[this.pos+e]}continueScalar(e){let t=this.buffer[e];if(this.indentNext>0){let n=0;for(;" "===t;)t=this.buffer[++n+e];if("\r"===t){const t=this.buffer[n+e+1];if("\n"===t||!t&&!this.atEnd)return e+n+1}return"\n"===t||n>=this.indentNext||!t&&!this.atEnd?e+n:-1}if("-"===t||"."===t){const t=this.buffer.substr(e,3);if(("---"===t||"..."===t)&&Ls(this.buffer[e+3]))return-1}return e}getLine(){let e=this.buffer.indexOf("\n",this.pos);return-1===e?this.atEnd?this.buffer.substring(this.pos):null:("\r"===this.buffer[e-1]&&(e-=1),this.buffer.substring(this.pos,e))}hasChars(e){return this.pos+e<=this.buffer.length}setNext(e){return this.buffer=this.buffer.substring(this.pos),this.pos=0,this.next=e,null}peek(e){return this.buffer.substr(this.pos,e)}parseNext(e){switch(e){case"stream":return this.parseStream();case"line-start":return this.parseLineStart();case"block-start":return this.parseBlockStart();case"doc":return this.parseDocument();case"flow":return this.parseFlowCollection();case"quoted-scalar":return this.parseQuotedScalar();case"block-scalar":return this.parseBlockScalar();case"plain-scalar":return this.parsePlainScalar()}}parseStream(){let e=this.getLine();if(null===e)return this.setNext("stream");if("\ufeff"===e[0]&&(this.pushCount(1),e=e.substring(1)),"%"===e[0]){let t=e.length;const n=e.indexOf("#");if(-1!==n){const r=e[n-1];" "!==r&&"\t"!==r||(t=n-1)}for(;;){const n=e[t-1];if(" "!==n&&"\t"!==n)break;t-=1}const r=this.pushCount(t)+this.pushSpaces(!0);return this.pushCount(e.length-r),this.pushNewline(),"stream"}if(this.atLineEnd()){const t=this.pushSpaces(!0);return this.pushCount(e.length-t),this.pushNewline(),"stream"}return this.push(""),this.parseLineStart()}parseLineStart(){const e=this.charAt(0);if(!e&&!this.atEnd)return this.setNext("line-start");if("-"===e||"."===e){if(!this.atEnd&&!this.hasChars(4))return this.setNext("line-start");const e=this.peek(3);if("---"===e&&Ls(this.charAt(3)))return this.pushCount(3),this.indentValue=0,this.indentNext=0,"doc";if("..."===e&&Ls(this.charAt(3)))return this.pushCount(3),"stream"}return this.indentValue=this.pushSpaces(!1),this.indentNext>this.indentValue&&!Ls(this.charAt(1))&&(this.indentNext=this.indentValue),this.parseBlockStart()}parseBlockStart(){const[e,t]=this.peek(2);if(!t&&!this.atEnd)return this.setNext("block-start");if(("-"===e||"?"===e||":"===e)&&Ls(t)){const e=this.pushCount(1)+this.pushSpaces(!0);return this.indentNext=this.indentValue+1,this.indentValue+=e,this.parseBlockStart()}return"doc"}parseDocument(){this.pushSpaces(!0);const e=this.getLine();if(null===e)return this.setNext("doc");let t=this.pushIndicators();switch(e[t]){case"#":this.pushCount(e.length-t);case void 0:return this.pushNewline(),this.parseLineStart();case"{":case"[":return this.pushCount(1),this.flowKey=!1,this.flowLevel=1,"flow";case"}":case"]":return this.pushCount(1),"doc";case"*":return this.pushUntil(Cs),"doc";case'"':case"'":return this.parseQuotedScalar();case"|":case">":return t+=this.parseBlockScalarHeader(),t+=this.pushSpaces(!0),this.pushCount(e.length-t),this.pushNewline(),this.parseBlockScalar();default:return this.parsePlainScalar()}}parseFlowCollection(){let e,t,n=-1;do{e=this.pushNewline(),t=this.pushSpaces(!0),e>0&&(this.indentValue=n=t)}while(e+t>0);const r=this.getLine();if(null===r)return this.setNext("flow");if((-1!==n&&n<this.indentNext||0===n&&(r.startsWith("---")||r.startsWith("..."))&&Ls(r[3]))&&(n!==this.indentNext-1||1!==this.flowLevel||"]"!==r[0]&&"}"!==r[0]))return this.flowLevel=0,this.push(""),this.parseLineStart();let s=0;for(;","===r[s];)s+=this.pushCount(1)+this.pushSpaces(!0);switch(s+=this.pushIndicators(),r[s]){case void 0:return"flow";case"#":return this.pushCount(r.length-s),"flow";case"{":case"[":return this.pushCount(1),this.flowKey=!1,this.flowLevel+=1,"flow";case"}":case"]":return this.pushCount(1),this.flowKey=!0,this.flowLevel-=1,this.flowLevel?"flow":"doc";case"*":return this.pushUntil(Cs),"flow";case'"':case"'":return this.flowKey=!0,this.parseQuotedScalar();case":":{const e=this.charAt(1);if(this.flowKey||Ls(e)||","===e)return this.pushCount(1),this.pushSpaces(!0),"flow"}default:return this.flowKey=!1,this.parsePlainScalar()}}parseQuotedScalar(){const e=this.charAt(0);let t=this.buffer.indexOf(e,this.pos+1);if("'"===e)for(;-1!==t&&"'"===this.buffer[t+1];)t=this.buffer.indexOf("'",t+2);else for(;-1!==t;){let e=0;for(;"\\"===this.buffer[t-1-e];)e+=1;if(e%2==0)break;t=this.buffer.indexOf('"',t+1)}let n=this.buffer.indexOf("\n",this.pos);if(-1!==n&&n<t){for(;-1!==n&&n<t;){const e=this.continueScalar(n+1);if(-1===e)break;n=this.buffer.indexOf("\n",e)}-1!==n&&n<t&&(t=n-1)}if(-1===t){if(!this.atEnd)return this.setNext("quoted-scalar");t=this.buffer.length}return this.pushToIndex(t+1,!1),this.flowLevel?"flow":"doc"}parseBlockScalarHeader(){this.blockScalarIndent=-1,this.blockScalarKeep=!1;let e=this.pos;for(;;){const t=this.buffer[++e];if("+"===t)this.blockScalarKeep=!0;else if(t>"0"&&t<="9")this.blockScalarIndent=Number(t)-1;else if("-"!==t)break}return this.pushUntil((e=>Ls(e)||"#"===e))}parseBlockScalar(){let e,t=this.pos-1,n=0;e:for(let r=this.pos;e=this.buffer[r];++r)switch(e){case" ":n+=1;break;case"\n":t=r,n=0;break;case"\r":{const e=this.buffer[r+1];if(!e&&!this.atEnd)return this.setNext("block-scalar");if("\n"===e)break}default:break e}if(!e&&!this.atEnd)return this.setNext("block-scalar");if(n>=this.indentNext){-1===this.blockScalarIndent?this.indentNext=n:this.indentNext+=this.blockScalarIndent;do{const e=this.continueScalar(t+1);if(-1===e)break;t=this.buffer.indexOf("\n",e)}while(-1!==t);if(-1===t){if(!this.atEnd)return this.setNext("block-scalar");t=this.buffer.length}}if(!this.blockScalarKeep)for(;;){let e=t-1,n=this.buffer[e];for("\r"===n&&(n=this.buffer[--e]);" "===n||"\t"===n;)n=this.buffer[--e];if(!("\n"===n&&e>=this.pos))break;t=e}return this.push(""),this.pushToIndex(t+1,!0),this.parseLineStart()}parsePlainScalar(){const e=this.flowLevel>0;let t,n=this.pos-1,r=this.pos-1;for(;t=this.buffer[++r];)if(":"===t){const t=this.buffer[r+1];if(Ls(t)||e&&","===t)break;n=r}else if(Ls(t)){const s=this.buffer[r+1];if("#"===s||e&&js.includes(s))break;if("\r"===t&&("\n"===s?(r+=1,t="\n"):n=r),"\n"===t){const e=this.continueScalar(r+1);if(-1===e)break;r=Math.max(r,e-2)}}else{if(e&&js.includes(t))break;n=r}return t||this.atEnd?(this.push(""),this.pushToIndex(n+1,!0),e?"flow":"doc"):this.setNext("plain-scalar")}pushCount(e){return e>0?(this.push(this.buffer.substr(this.pos,e)),this.pos+=e,e):0}pushToIndex(e,t){const n=this.buffer.slice(this.pos,e);return n?(this.push(n),this.pos+=n.length,n.length):(t&&this.push(""),0)}pushIndicators(){switch(this.charAt(0)){case"!":if("<"===this.charAt(1))return this.pushVerbatimTag()+this.pushSpaces(!0)+this.pushIndicators();case"&":return this.pushUntil(Cs)+this.pushSpaces(!0)+this.pushIndicators();case":":case"?":case"-":if(Ls(this.charAt(1)))return 0===this.flowLevel&&(this.indentNext=this.indentValue+1),this.pushCount(1)+this.pushSpaces(!0)+this.pushIndicators()}return 0}pushVerbatimTag(){let e=this.pos+2,t=this.buffer[e];for(;!Ls(t)&&">"!==t;)t=this.buffer[++e];return this.pushToIndex(">"===t?e+1:e,!1)}pushNewline(){const e=this.buffer[this.pos];return"\n"===e?this.pushCount(1):"\r"===e&&"\n"===this.charAt(1)?this.pushCount(2):0}pushSpaces(e){let t,n=this.pos-1;do{t=this.buffer[++n]}while(" "===t||e&&"\t"===t);const r=n-this.pos;return r>0&&(this.push(this.buffer.substr(this.pos,r)),this.pos=n),r}pushUntil(e){let t=this.pos,n=this.buffer[t];for(;!e(n);)n=this.buffer[++t];return this.pushToIndex(t,!1)}}function Rs(e,t){for(let n=0;n<e.length;++n)if(e[n].type===t)return!0;return!1}function Bs(e){for(let t=0;t<e.length;++t)switch(e[t].type){case"space":case"comment":case"newline":break;default:return!0}return!1}function Ds(e){let t=!1;for(let n=0;n<e.length;++n)switch(e[n].type){case"space":break;case"comment":t=!0;break;case"newline":if(!t)return!1;break;default:return!1}if(t)for(let t=e.length-1;t>=0;--t)switch(e[t].type){case"space":break;case"newline":return!0;default:return!1}return!1}function Fs(e){switch(e.type){case"document":return e.start;case"block-map":{const t=e.items[e.items.length-1];return t.sep||t.start}case"block-seq":return e.items[e.items.length-1].start;default:return[]}}function Ms(e){var t;if(0===e.length)return[];let n=e.length;e:for(;--n>=0;)switch(e[n].type){case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":case"newline":break e}for(;"space"===(null===(t=e[++n])||void 0===t?void 0:t.type););return e.splice(n,e.length)}class qs{constructor(e,t){this.atNewLine=!0,this.atScalar=!1,this.indent=0,this.offset=0,this.onKeyLine=!1,this.stack=[],this.source="",this.type="",this.next=e=>{if(this.source=e,this.atScalar)return this.atScalar=!1,this.step(),void(this.offset+=e.length);const t=function(e){switch(e){case"\ufeff":return"byte-order-mark";case"":return"doc-mode";case"":return"flow-error-end";case"":return"scalar";case"---":return"doc-start";case"...":return"doc-end";case"":case"\n":case"\r\n":return"newline";case"-":return"seq-item-ind";case"?":return"explicit-key-ind";case":":return"map-value-ind";case"{":return"flow-map-start";case"}":return"flow-map-end";case"[":return"flow-seq-start";case"]":return"flow-seq-end";case",":return"comma"}switch(e[0]){case" ":case"\t":return"space";case"#":return"comment";case"%":return"directive-line";case"*":return"alias";case"&":return"anchor";case"!":return"tag";case"'":return"single-quoted-scalar";case'"':return"double-quoted-scalar";case"|":case">":return"block-scalar-header"}return null}(e);if(t)if("scalar"===t)this.atNewLine=!1,this.atScalar=!0,this.type="scalar";else{switch(this.type=t,this.step(),t){case"newline":this.atNewLine=!0,this.indent=0,this.onNewLine&&this.onNewLine(this.offset+e.length);break;case"space":this.atNewLine&&" "===e[0]&&(this.indent+=e.length);break;case"explicit-key-ind":case"map-value-ind":case"seq-item-ind":this.atNewLine&&(this.indent+=e.length);break;case"doc-mode":return;default:this.atNewLine=!1}this.offset+=e.length}else{const t=`Not a YAML token: ${e}`;this.pop({type:"error",offset:this.offset,message:t,source:e}),this.offset+=e.length}},this.lexer=new Ps(this.next),this.push=e,this.onNewLine=t}parse(e,t=!1){this.onNewLine&&0===this.offset&&this.onNewLine(0),this.lexer.lex(e,t),t||this.end()}end(){for(;this.stack.length>0;)this.pop()}get sourceToken(){return{type:this.type,indent:this.indent,source:this.source}}step(){const e=this.peek(1);if("doc-end"!==this.type||e&&"doc-end"===e.type){if(!e)return this.stream();switch(e.type){case"document":return this.document(e);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.scalar(e);case"block-scalar":return this.blockScalar(e);case"block-map":return this.blockMap(e);case"block-seq":return this.blockSequence(e);case"flow-collection":return this.flowCollection(e);case"doc-end":return this.documentEnd(e)}this.pop()}else{for(;this.stack.length>0;)this.pop();this.stack.push({type:"doc-end",offset:this.offset,source:this.source})}}peek(e){return this.stack[this.stack.length-e]}pop(e){const t=e||this.stack.pop();if(t)if(0===this.stack.length)this.push(t);else{const e=this.peek(1);switch("block-scalar"!==t.type&&"flow-collection"!==t.type||(t.indent="indent"in e?e.indent:-1),e.type){case"document":e.value=t;break;case"block-scalar":e.props.push(t);break;case"block-map":{const n=e.items[e.items.length-1];if(n.value)return e.items.push({start:[],key:t,sep:[]}),void(this.onKeyLine=!0);if(!n.sep)return Object.assign(n,{key:t,sep:[]}),void(this.onKeyLine=!Rs(n.start,"explicit-key-ind"));n.value=t;break}case"block-seq":{const n=e.items[e.items.length-1];n.value?e.items.push({start:[],value:t}):n.value=t;break}case"flow-collection":e.items.push(t);break;default:this.pop(),this.pop(t)}if(!("document"!==e.type&&"block-map"!==e.type&&"block-seq"!==e.type||"block-map"!==t.type&&"block-seq"!==t.type)){const n=t.items[t.items.length-1];n&&!n.sep&&!n.value&&n.start.length>0&&!Bs(n.start)&&(0===t.indent||n.start.every((e=>"comment"!==e.type||e.indent<t.indent)))&&("document"===e.type?e.end=n.start:e.items.push({start:n.start}),t.items.splice(-1,1))}}else{const e="Tried to pop an empty stack";this.push({type:"error",source:"",message:e})}}stream(){switch(this.type){case"directive-line":return void this.push({type:"directive",source:this.source});case"byte-order-mark":case"space":case"comment":case"newline":return void this.push(this.sourceToken);case"doc-mode":case"doc-start":{const e={type:"document",offset:this.offset,start:[]};return"doc-start"===this.type&&e.start.push(this.sourceToken),void this.stack.push(e)}}this.push({type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML stream`,source:this.source})}document(e){if(e.value)return this.lineEnd(e);switch(this.type){case"doc-start":return void(Bs(e.start)?(this.pop(),this.step()):e.start.push(this.sourceToken));case"anchor":case"tag":case"space":case"comment":case"newline":return void e.start.push(this.sourceToken)}const t=this.startBlockValue(e);t?this.stack.push(t):this.push({type:"error",offset:this.offset,message:`Unexpected ${this.type} token in YAML document`,source:this.source})}scalar(e){if("map-value-ind"===this.type){const t=Ms(Fs(this.peek(2)));let n;e.end?(n=e.end,n.push(this.sourceToken),delete e.end):n=[this.sourceToken];const r={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:t,key:e,sep:n}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=r}else this.lineEnd(e)}blockScalar(e){switch(this.type){case"space":case"comment":case"newline":return void e.props.push(this.sourceToken);case"scalar":if(e.source=this.source,this.atNewLine=!0,this.indent=0,this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}this.pop();break;default:this.pop(),this.step()}}blockMap(e){var t;const n=e.items[e.items.length-1];switch(this.type){case"newline":if(this.onKeyLine=!1,!n.sep&&Ds(n.start)){const r=e.items[e.items.length-2],s=null===(t=null==r?void 0:r.value)||void 0===t?void 0:t.end;if(Array.isArray(s))return Array.prototype.push.apply(s,n.start),void(n.start=[this.sourceToken])}case"space":case"comment":return void(n.value?e.items.push({start:[this.sourceToken]}):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken))}if(this.indent>=e.indent){const t=!this.onKeyLine&&this.indent===e.indent&&(n.sep||Bs(n.start));switch(this.type){case"anchor":case"tag":return void(t||n.value?(e.items.push({start:[this.sourceToken]}),this.onKeyLine=!0):n.sep?n.sep.push(this.sourceToken):n.start.push(this.sourceToken));case"explicit-key-ind":return n.sep||Rs(n.start,"explicit-key-ind")?t||n.value?e.items.push({start:[this.sourceToken]}):this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]}):n.start.push(this.sourceToken),void(this.onKeyLine=!0);case"map-value-ind":if(n.sep)if(n.value||t&&!Rs(n.start,"explicit-key-ind"))e.items.push({start:[],key:null,sep:[this.sourceToken]});else if(Rs(n.sep,"map-value-ind"))this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[],key:null,sep:[this.sourceToken]}]});else if(Rs(n.start,"explicit-key-ind")&&function(e){switch(null==e?void 0:e.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":case"flow-collection":return!0;default:return!1}}(n.key)&&!Rs(n.sep,"newline")){const e=Ms(n.start),t=n.key,r=n.sep;r.push(this.sourceToken),delete n.key,delete n.sep,this.stack.push({type:"block-map",offset:this.offset,indent:this.indent,items:[{start:e,key:t,sep:r}]})}else n.sep.push(this.sourceToken);else Object.assign(n,{key:null,sep:[this.sourceToken]});return void(this.onKeyLine=!0);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":{const r=this.flowScalar(this.type);return void(t||n.value?(e.items.push({start:[],key:r,sep:[]}),this.onKeyLine=!0):n.sep?this.stack.push(r):(Object.assign(n,{key:r,sep:[]}),this.onKeyLine=!0))}default:{const r=this.startBlockValue(e);if(r)return t&&"block-seq"!==r.type&&Rs(n.start,"explicit-key-ind")&&e.items.push({start:[]}),void this.stack.push(r)}}}this.pop(),this.step()}blockSequence(e){var t;const n=e.items[e.items.length-1];switch(this.type){case"newline":if(!n.value&&Ds(n.start)){const r=e.items[e.items.length-2],s=null===(t=null==r?void 0:r.value)||void 0===t?void 0:t.end;if(Array.isArray(s))return Array.prototype.push.apply(s,n.start),void(n.start=[this.sourceToken])}case"space":case"comment":return void(n.value?e.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken));case"anchor":case"tag":if(n.value||this.indent<=e.indent)break;return void n.start.push(this.sourceToken);case"seq-item-ind":if(this.indent!==e.indent)break;return void(n.value||Rs(n.start,"seq-item-ind")?e.items.push({start:[this.sourceToken]}):n.start.push(this.sourceToken))}if(this.indent>e.indent){const t=this.startBlockValue(e);if(t)return this.stack.push(t)}this.pop(),this.step()}flowCollection(e){if("flow-error-end"===this.type){let e;do{this.pop(),e=this.peek(1)}while(e&&"flow-collection"===e.type)}else if(0===e.end.length){switch(this.type){case"space":case"comment":case"newline":case"comma":case"explicit-key-ind":case"map-value-ind":case"anchor":case"tag":return void e.items.push(this.sourceToken);case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return void e.items.push(this.flowScalar(this.type));case"flow-map-end":case"flow-seq-end":return void e.end.push(this.sourceToken)}const t=this.startBlockValue(e);if(t)return this.stack.push(t);this.pop(),this.step()}else{const t=this.peek(2);if("block-map"!==t.type||"map-value-ind"!==this.type&&("newline"!==this.type||t.items[t.items.length-1].sep))if("map-value-ind"===this.type&&"flow-collection"!==t.type){const n=Ms(Fs(t)),r=e.end.splice(1,e.end.length);r.push(this.sourceToken);const s={type:"block-map",offset:e.offset,indent:e.indent,items:[{start:n,key:e,sep:r}]};this.onKeyLine=!0,this.stack[this.stack.length-1]=s}else this.lineEnd(e);else this.pop(),this.step()}}flowScalar(e){if(this.onNewLine){let e=this.source.indexOf("\n")+1;for(;0!==e;)this.onNewLine(this.offset+e),e=this.source.indexOf("\n",e)+1}return{type:e,offset:this.offset,indent:this.indent,source:this.source}}startBlockValue(e){switch(this.type){case"alias":case"scalar":case"single-quoted-scalar":case"double-quoted-scalar":return this.flowScalar(this.type);case"block-scalar-header":return{type:"block-scalar",offset:this.offset,indent:this.indent,props:[this.sourceToken]};case"flow-map-start":case"flow-seq-start":return{type:"flow-collection",offset:this.offset,indent:this.indent,start:this.sourceToken,items:[],end:[]};case"seq-item-ind":return{type:"block-seq",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"explicit-key-ind":return this.onKeyLine=!0,{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:[this.sourceToken]}]};case"map-value-ind":{this.onKeyLine=!0;const t=Ms(Fs(e));return{type:"block-map",offset:this.offset,indent:this.indent,items:[{start:t,key:null,sep:[this.sourceToken]}]}}}return null}documentEnd(e){"doc-mode"!==this.type&&(e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&this.pop())}lineEnd(e){switch(this.type){case"comma":case"doc-start":case"doc-end":case"flow-seq-end":case"flow-map-end":case"map-value-ind":this.pop(),this.step();break;case"newline":this.onKeyLine=!1;default:e.end?e.end.push(this.sourceToken):e.end=[this.sourceToken],"newline"===this.type&&this.pop()}}}class Us extends h{constructor(e,t,n){super(e),this.text=n,this.actorName=t}apply(e){const t=e.actors[this.actorName]||e.actors.default,n=(null==t?void 0:t.textColor)||e.actors.default.textColor;let r;this.actorName!==o&&(r={name:t.name||this.actorName,color:t.nameTagColor||e.actors.default.nameTagColor});const s={type:"adv",nameTag:r,textNodes:[{text:this.text,characterDelay:20,color:n}]},i=Object.assign(Object.assign({},e.animatableState),{text:s}),a=!(e.commands[e.commandIndex+1]instanceof v);return Object.assign(Object.assign({},e),{animatableState:i,stopAfterRender:a})}}class Ws{constructor(e){this.location=e}}class Ks extends Ws{constructor(e,t){super(e),this.value=t}evaluate(e){return!!this.value.evaluate(e)}}class Ys extends Ws{constructor(e,t,n,r){super(e),this.operator=t,this.left=n,this.right=r}evaluate(e){const t=this.left.evaluate(e),n=this.right.evaluate(e);return this.operator(t,n)}}const Vs=(e,t)=>e===t,Zs=(e,t)=>e!==t,zs=(e,t)=>e<t,Gs=(e,t)=>e<=t,Js=(e,t)=>e>t,Hs=(e,t)=>e>=t,Qs={"==":Vs,eq:Vs,"!=":Zs,neq:Zs,"<":zs,lt:zs,"<=":Gs,lte:Gs,">":Js,gt:Js,">=":Hs,gte:Hs};class Xs extends Ws{constructor(e,t){super(e),this.expr=t}evaluate(e){return!this.expr.evaluate(e)}}class ei extends Ws{constructor(e,t){super(e),this.exprs=t}evaluate(e){for(const t of this.exprs)if(!1===t.evaluate(e))return!1;return!0}}class ti extends Ws{constructor(e,t){super(e),this.exprs=t}evaluate(e){for(const t of this.exprs)if(!0===t.evaluate(e))return!0;return!1}}const ni=(e,t)=>{let n,r,s;if(Array.isArray(e))return 3!==e.length?new f("Boolean expression seq must have 3 items",t,d.WARNING):O(e[0])?(n=new w(e[0]),"string"!=typeof e[1]?new f("Operator must be a string",t,d.WARNING):(r=e[1],O(e[2])?(s=new w(e[2]),r in Qs?new Ys(t,Qs[r],n,s):new f(`Unrecognized operand ${r}`,t,d.WARNING)):new f("Right operand must be a string, number or boolean",t,d.WARNING))):new f("Left operand must be a string, number or boolean",t,d.WARNING);if("string"==typeof e||"number"==typeof e||"boolean"==typeof e)return new Ks(t,new w(e));let i=ri(e,"not");if(null!==i){const e=ni(i,t);return e instanceof f?e:new Xs(t,e)}if(i=ri(e,"and"),null!==i){const e=si(i,t);return e instanceof f?e:new ei(t,e)}if(i=ri(e,"or"),null!==i){const e=si(i,t);return e instanceof f?e:new ti(t,e)}return new f("Invalid boolean expression",t,d.WARNING)};function ri(e,t){return g(e,t)?e[t]:null}function si(e,t){const n=[];if(Array.isArray(e))for(const r of e){const e=ni(r,t);if(e instanceof f)return e;n.push(e)}return n}class ii extends h{constructor(e,t,n){super(e),this.targetLabel=t,this.condition=n}apply(e){const t=Object.assign({},e);if(void 0===e.labels[this.targetLabel])throw new Error("Target label does not exist.");return(void 0===this.condition||this.condition.evaluate(e))&&(t.commandIndex=e.labels[this.targetLabel]),t.stopAfterRender=!1,t}}m("jump",((e,t)=>{if("string"==typeof e)return new ii(t,e);let n,r;return"object"!=typeof e||null===e?new f("Target label must be a string or map.",t,d.WARNING):g(e,"to")?"string"!=typeof e.to?new f('Value of "to" must be a string',t,d.WARNING):(n=e.to,g(e,"if")?(r=ni(e.if,t),r instanceof f?r:new ii(t,n,r)):new f('map form of jump command must have key "if"',t,d.WARNING)):new f('map form of jump command must have key "of"',t,d.WARNING)}));class oi extends h{constructor(e,t){super(e),this.name=t}apply(e){return Object.assign(Object.assign({},e),{stopAfterRender:!1})}}m("label",((e,t)=>"string"==typeof e?new oi(t,e):new f("Label must be a string.",t,d.WARNING)));const ai=(e,t)=>{if(Tn(e)&&"string"==typeof e.value)return new Us(ui(e,t),o,e.value)},ci=(e,t)=>{if(En(e)&&1===e.items.length&&Nn(e.items[0])){const n=e.items[0];if(Tn(n.key)&&"string"==typeof n.key.value&&An(n.value)){const r=n.key.value,s=p[r];if(void 0!==s){const r=ui(e,t);return s(n.value.toJSON(),r)}if(r[0]===r[0].toLowerCase())return new f(`${r} is not a recognized command.`,ui(e,t),d.WARNING)}}},li=(e,t)=>{if(En(e)&&1===e.items.length&&Nn(e.items[0])){const n=ui(e,t),r=e.items[0];if(Tn(r.key)&&"string"==typeof r.key.value){const e=r.key.value;if(e[0]!==e[0].toLowerCase())return Tn(r.value)&&"string"==typeof r.value.value?new Us(n,e,r.value.value):new f("Value of Say command must be a string.",n,d.WARNING)}}},ui=(e,t)=>{var n,r;const s=t.linePos((null===(n=e.range)||void 0===n?void 0:n[1])||0),i=1===s.col?s.line-1:s.line;return{startLine:t.linePos((null===(r=e.range)||void 0===r?void 0:r[0])||0).line,endLine:i}},hi=(e,t)=>{let n=Object.assign({},t),r=[];const s=[],i=new _s,o=new As((e=>s.push(e)),{});new qs(o.next,i.addNewLine).parse(e),o.end(),console.dir(s[0]);for(const e of s[0].warnings){const t=i.linePos(e.offset).line;r.push(new f("YAML parse warning: "+e.message,{startLine:t,endLine:t},d.WARNING))}for(const e of s[0].errors){const t=i.linePos(e.offset).line;r.push(new f("YAML parse error: "+e.message,{startLine:t,endLine:t},d.ERROR))}const a=s[0].get("story",!0);if(void 0===a)r.push(new f("story missing.",{startLine:1,endLine:1},d.ERROR));else if(!On(a)&&An(a))r.push(new f("story must be a sequence",ui(a,i),d.ERROR));else if(On(a)){const[e,t]=((e,t)=>{const n=[],r=[],s=[ai,ci,li];for(let i of e.items){if(xn(i)){const e=i.source,t=Object.assign({},i.source),n=Symbol.for("yaml.node.type");t[n]=e[n],t.range=i.range,i=t}let e=!1;for(const o of s){const s=o(i,t);if(s instanceof h){n.push(s),e=!0;break}if(s instanceof f){r.push(s),e=!0;break}}if(!e&&An(i)){const e=new f("Unrecognized item. A command should be a string or a single-keyed map.",ui(i,t),d.WARNING);r.push(e)}}return[n,r]})(a,i);r=r.concat(t),n.commands=e}return n=function(e){const t=Object.assign({},e),n={};return e.commands.forEach(((e,t)=>{if(e instanceof oi){const r=e.name;if(void 0!==n[r])throw new Error(`Label ${r} already exists in story.`);n[r]=t}})),t.labels=n,t}(n),console.dir(n),[n,r]},di="function"==typeof atob,fi="function"==typeof Buffer,pi=(e=>{let t={};return e.forEach(((e,n)=>t[e]=n)),t})(("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder,Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="))),mi=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,gi=String.fromCharCode.bind(String),yi="function"==typeof Uint8Array.from?Uint8Array.from.bind(Uint8Array):e=>new Uint8Array(Array.prototype.slice.call(e,0)),vi=e=>e.replace(/[^A-Za-z0-9\+\/]/g,""),bi=di?e=>atob(vi(e)):fi?e=>Buffer.from(e,"base64").toString("binary"):e=>{if(e=e.replace(/\s+/g,""),!mi.test(e))throw new TypeError("malformed base64.");e+="==".slice(2-(3&e.length));let t,n,r,s="";for(let i=0;i<e.length;)t=pi[e.charAt(i++)]<<18|pi[e.charAt(i++)]<<12|(n=pi[e.charAt(i++)])<<6|(r=pi[e.charAt(i++)]),s+=64===n?gi(t>>16&255):64===r?gi(t>>16&255,t>>8&255):gi(t>>16&255,t>>8&255,255&t);return s},wi=fi?e=>yi(Buffer.from(e,"base64")):e=>yi(bi(e).split("").map((e=>e.charCodeAt(0)))),ki=e=>vi(e.replace(/[-_]/g,(e=>"-"==e?"+":"/"))),xi=e=>wi(ki(e));var Si;const Ei=Object.assign(Object.assign({},xt),{actors:{default:{textColor:"white",nameTagColor:"white"},[o]:{textColor:"#60baff"},A1:{name:"Actor",nameTagColor:"purple",sprites:["idle.png","2.png"]},A2:{name:"Actor2",nameTagColor:"orange",sprites:["idle.png","2.png"]}},backgrounds:["a.png","b.png"],audioAssets:["bgm/map01.ogg","bgm/dayl_preview.ogg","sfx/bigthump.ogg"]});let Ni;try{Ni=function(e){const t="vn-test",n=window.localStorage.getItem(t);if(null===n)throw new Error("Could not load save data for "+t);return JSON.parse(n)}()}catch(e){Ni=void 0}const Ti=new class{constructor(t,n){var r;this.state=void 0===t?xt:t,this.path=e.emptyPath(),this.startingState=this.state,this.saves=null!==(r=null==n?void 0:n.saves)&&void 0!==r?r:[],n&&(this.state.seenCommands=bt.fromJSON(n.seenCommands))}advance(){const e=u.advance(this.state);this.state.stopAfterRender&&e!==this.state&&(this.path=this.path.advance()),this.state=e}advanceUntilStop(){const e=u.advanceUntilStop(this.state);this.state.stopAfterRender&&e!==this.state&&(this.path=this.path.advance()),this.state=e}makeDecision(e){const t=u.makeDecision(e,this.state);t!==this.state&&(this.path=this.path.makeDecision(e)),this.state=t}goToCommandDirect(e){this.state=u.goToCommandDirect(e,this.state),this.path=this.path.goToCommand(e)}undo(){this.path=this.path.undo(1),this.state=u.fromPath(this.startingState,this.path)}isNextCommandSeen(){return this.state.seenCommands.contains(this.state.commandIndex)}saveToSlot(e){const t={path:this.path.toShorthandPath(),timestamp:(new Date).getTime()};this.saves[e]=t}loadFromSlot(e){const t=this.saves[e];if(void 0===t)throw new Error("No save at slot "+e);const[n,r]=u.fromShorthandPath(this.startingState,t.path.slice(0,-1),t.path.slice(-1)[0]);this.state=n,this.path=r}loadState(t){this.state=t,this.startingState=t,this.path=e.emptyPath()}getGlobalSaveData(){return{seenCommands:this.state.seenCommands.toJSON(),saves:this.saves}}}(Ei,Ni);window.vnPlayer=Ti;const Oi=document.getElementById("vn-div-container"),Ii=document.getElementById("vn-div"),Ai=new class{constructor(e,t){var n,r,s;this.onRenderCallbacks=[],this.onFinishedCallbacks=[],this.consecutiveCommands=0,this.SKIP_DELAY=50,this.ignoreInputs=!1,this.skipMode=!1,this.finished=!0,this.root=e,this.menuDiv=document.createElement("div"),this.menuDiv.classList.add("vn-menu-container"),this.menuDiv.addEventListener("click",(e=>{e.stopPropagation()})),this.player=t,this.committedState=null,this.root.addEventListener("click",(e=>{this.skipMode&&(this.skipMode=!1,e.stopPropagation())}),{capture:!0}),this.root.addEventListener("click",(()=>{this.advance()})),document.addEventListener("keydown",this.handleKeyDownEvent.bind(this)),null===(n=this.root.querySelector(".vn-action-back"))||void 0===n||n.addEventListener("click",(e=>{e.stopPropagation(),this.undo()})),null===(r=this.root.querySelector(".vn-action-skip"))||void 0===r||r.addEventListener("click",(e=>{e.stopPropagation(),this.enterSkipMode()})),null===(s=this.root.querySelector(".vn-action-menu"))||void 0===s||s.addEventListener("click",(e=>{e.stopPropagation(),this.showMenu(hn)})),this.imageLoader=new Vt,this.audioLoader=new sn,this.textBoxRenderer=new Et(this.root),this.decisionRenderer=new Wt(this.root,this),this.spriteRenderer=new Zt(this.root,this,this.imageLoader),this.backgroundRenderer=new en(this.root,this,this.imageLoader),this.audioRenderer=new on(this,this.audioLoader),this.arrow=document.createElement("div"),this.arrow.classList.add("vn-arrow","vn-anim-bounce"),this.root.appendChild(this.arrow),this.render(!0)}render(e){this.ignoreInputs=!1;const t=this.player.state;this.onRenderCallbacks.forEach((e=>e())),this.finished=!1,this.arrow.style.display="none";const n=[],r=null===this.committedState?null:this.committedState.animatableState.text;n.push(this.textBoxRenderer.render(r,t.animatableState.text,e)),n.push(this.decisionRenderer.render(t.decision,e)),n.push(this.spriteRenderer.render(t.animatableState.sprites,e)),n.push(this.backgroundRenderer.render(t.animatableState.background,e)),n.push(this.audioRenderer.render(t.animatableState.audio)),this.committedState=t,Promise.all(n).then((()=>{var t,n,r;if(null===(null===(t=this.committedState)||void 0===t?void 0:t.decision)&&(this.arrow.style.display=""),this.player.isNextCommandSeen()&&null===this.player.state.decision?null===(r=this.root.querySelector(".vn-action-skip"))||void 0===r||r.classList.remove("vn-action-disabled"):null===(n=this.root.querySelector(".vn-action-skip"))||void 0===n||n.classList.add("vn-action-disabled"),this.finished=!0,this.onFinishedCallbacks.forEach((e=>e())),this.consecutiveCommands>1e4)throw alert("Seems like we're stuck in an infinite loop"),new Error("Got stuck in infinite loop while rendering");this.player.state.stopAfterRender||(this.consecutiveCommands++,this.player.advance(),this.render(e))}))}showMenu(e){this.menuDiv.innerHTML="",e(this.menuDiv,this),this.root.appendChild(this.menuDiv)}closeMenu(){this.root.removeChild(this.menuDiv),this.menuDiv.innerHTML=""}advance(){this.ignoreInputs||(this.consecutiveCommands=0,this.finished?(this.player.advance(),this.render(!0)):this.render(!1),an("test",this.player.getGlobalSaveData()))}makeDecision(e){this.consecutiveCommands=0,this.player.makeDecision(e),this.render(!0)}undo(){this.consecutiveCommands=0,this.player.undo(),this.render(!1)}skip(){this.player.isNextCommandSeen()?(this.player.advanceUntilStop(),this.render(!1)):(this.player.advanceUntilStop(),this.render(!0),this.skipMode=!1),null!==this.player.state.decision&&(this.skipMode=!1),this.skipMode&&setTimeout(this.skip.bind(this),this.SKIP_DELAY)}enterSkipMode(){this.skipMode||this.player.isNextCommandSeen()&&null===this.player.state.decision&&(this.skipMode=!0,setTimeout(this.skip.bind(this),this.SKIP_DELAY))}getSaves(){return this.player.saves}saveToSlot(e){this.player.saveToSlot(e),an("test",this.player.getGlobalSaveData())}loadFromSlot(e){this.player.loadFromSlot(e),this.render(!1)}deleteSave(e){this.player.saves.splice(e,1)}getCommittedState(){return this.committedState}handleScrollWheelEvent(e){e.preventDefault(),this.ignoreInputs||(e.deltaY>0?this.player.goToCommandDirect(this.player.state.commandIndex+1):e.deltaY<0&&this.player.goToCommandDirect(this.player.state.commandIndex-1),this.render(!1))}handleKeyDownEvent(e){"PageUp"===e.key&&(e.preventDefault(),this.undo())}loadAssets(){const e=this.player.state;for(const t in e.actors){const n=e.actors[t].sprites;if(void 0!==n)for(const e of n){const n="sprites/"+t+"/"+e;this.imageLoader.registerAsset(n)}}for(const t of e.backgrounds){const e="backgrounds/"+t;this.imageLoader.registerAsset(e)}for(const t of e.audioAssets){const e="audio/"+t;this.audioLoader.registerAsset(e)}return Promise.all([this.imageLoader.loadAll(),this.audioLoader.loadAll()])}}(Ii,Ti);window.vnDomRenderer=Ai;const _i=new URLSearchParams(location.search);function Li(e){const[t,n]=hi(e,Ti.state);Ti.loadState(t),Ai.loadAssets()}function ji(){const e=Oi.clientWidth,t=Ii.clientWidth,n=Oi.clientHeight,r=Ii.clientHeight;let s;e/n>t/r?(s=n/r,Oi.style.paddingLeft=(e-t*s)/2+"px"):(s=e/t,Oi.style.paddingTop=(n-r*s)/2+"px");const i=`scale(${s})`;Ii.style.margin="initial",Ii.style.transform=i,Ii.style.transformOrigin="top left"}_i.has("vn")?function(e){var t,n,r,s;t=this,n=void 0,s=function*(){var t;const n=(t=xi(e),new ReadableStream({start(e){e.enqueue(t),e.close()}})).pipeThrough(new DecompressionStream("gzip"));Li(yield new Response(n).text())},new((r=void 0)||(r=Promise))((function(e,i){function o(e){try{c(s.next(e))}catch(e){i(e)}}function a(e){try{c(s.throw(e))}catch(e){i(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}c((s=s.apply(t,n||[])).next())}))}(_i.get("vn")):Li('\nanchor: &anchor\n  A1: "This is a YAML anchor"\n\nstory:\n  - set: [$a, =, 0]\n  - textbox: close\n  - bg:\n      image: a.png\n      transition: blinds\n      duration: 2000\n      pan:\n        from: [0,0,100,100]\n        to: [0,0,2000,2000]\n        duration: 10000\n  - Hello, This is WebVn - A fast visual novel engine for the modern web.\n  - The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog. The quick brown fox jumps over the lazy dog.\n  - bgm:\n      audio: "bgm/map01.ogg"\n      loop: false\n  - bg:\n      image: b.png\n      transition: fade\n      duration: 2000\n      pan:\n        from: [0,0,100,100]\n        to: [0,0,1000,1000]\n        duration: 10000\n  - "Wait for audio to stop"\n  - bgm: "bgm/map01.ogg"\n  - Looping audio\n  - bgm: "bgm/dayl_preview.ogg"\n  - Another song...\n  - bgm: stop\n  - And now... Actors!\n  - label: loop\n  - show:\n      actor: A1\n      sprite: idle.png\n  - A1: Here I am\n  - show:\n      actor: A1\n      sprite: 2.png\n      x: .2\n  - A1: Just talking...\n  - bgm: "bgm/dayl_preview.ogg"\n  - bgPan:\n      to: [20,20,500,500]\n      duration: 2000\n  - show:\n      actor: A2\n      sprite: idle.png\n      x: 0\n      y: 0\n      anchorX: 0\n      anchorY: 0\n  - A2: And here I come\n  - set: [$a, +=, 1]\n  - show:\n      actor: A2\n      sprite: idle.png\n      x: 1\n      y: 1\n      anchorX: 1\n      anchorY: 1\n  - A2: Whee!\n  - A2: Bye\n  - hide: A2\n  - Bye bye, actors\n  - hide: A1\n  - jump:\n      to: loop\n      if: [$a, ==, 1]\n  - ugh: this is an unregonized command\n  - textbox: close\n  - *anchor\n  - bgm: stop\n  - bg:\n      image: "#000000"\n      transition: blinds\n      duration: 1000\n  - bg:\n      image: "b.png"\n      transition: blinds\n      duration: 1000\n  - What decision are you going to make?\n  - decision:\n    - "asd: asd (quoted string)":\n        jump: asd\n    - A bad one.:\n        jump: bad\n  - label: asd\n  - More YAML quoting tests...\n  - 2\n  - "2"\n  - no\n  - false\n  - "Quoted"\n  - |\n    This is a\n    Multiline\n    Node\n  - Rando: I\'m just some random dude\n  - A1: But I\'m a defined actor\n  - textbox: close\n  - jump: loop\n  - label: bad\n  - sfx: "sfx/bigthump.ogg"\n  - bg:\n      image: "#ffffff"\n      transition: fade\n      duration: 200\n  - bg:\n      image: "b.png"\n      transition: fade\n      duration: 200\n  - That was a bad choice.\n  - And here we go again...\n  - jump: loop\n'),null===(Si=document.getElementById("vn-btn-fullscreen"))||void 0===Si||Si.addEventListener("click",(()=>{var e;null===(e=document.getElementById("vn-div-container"))||void 0===e||e.requestFullscreen({navigationUI:"hide"}).then((()=>{screen.orientation.lock("landscape"),window.setTimeout(ji,500)}))})),document.addEventListener("fullscreenchange",(()=>{null===document.fullscreenElement&&(Oi.style.paddingLeft="",Oi.style.paddingTop="",Ii.style.margin="",Ii.style.transform="",Ii.style.transformOrigin="")}))})()})();